			idx++
			return true
		})
	}

	// Merge consecutive same-role turns: Gemini API requires strict user/model alternation.
	// When the translated conversation has consecutive turns with the same role (e.g. two
	// "model" turns in a row), merge their parts arrays into a single turn.
	contents = gjson.GetBytes(rawJSON, "request.contents")
	if contents.Exists() && contents.IsArray() {
		mergedContents := `{"contents":[]}`
		prevRole := ""
		mergedIdx := -1
		contents.ForEach(func(_, value gjson.Result) bool {
			role := value.Get("role").String()
			if role == prevRole && mergedIdx >= 0 {
