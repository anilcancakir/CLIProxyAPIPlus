=== RUN   TestRunSetupJSONResponseShape
--- PASS: TestRunSetupJSONResponseShape (0.00s)
=== RUN   TestRunDoctorJSONFailureShape
--- PASS: TestRunDoctorJSONFailureShape (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/cliproxyctl	0.316s
?   	github.com/router-for-me/CLIProxyAPI/v6/cmd/server	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/examples/custom-provider	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/examples/http-request	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/examples/translator	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/access	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/access/config_access	[no test files]
=== RUN   TestAmpProviderModelRoutes
=== RUN   TestAmpProviderModelRoutes/openai_root_models
time="2026-02-28T16:18:52+03:00" level=info msg="Kiro OAuth Web routes registered at /v0/oauth/kiro/*"
time="2026-02-28T16:18:52+03:00" level=info msg="200 |            0s |       192.0.2.1 | GET     \"/api/provider/openai/models\"" request_id=722ab40c
=== RUN   TestAmpProviderModelRoutes/groq_root_models
time="2026-02-28T16:18:52+03:00" level=info msg="Kiro OAuth Web routes registered at /v0/oauth/kiro/*"
time="2026-02-28T16:18:52+03:00" level=info msg="200 |            0s |       192.0.2.1 | GET     \"/api/provider/groq/models\"" request_id=39912a8f
=== RUN   TestAmpProviderModelRoutes/openai_models
time="2026-02-28T16:18:52+03:00" level=info msg="Kiro OAuth Web routes registered at /v0/oauth/kiro/*"
time="2026-02-28T16:18:52+03:00" level=info msg="200 |            0s |       192.0.2.1 | GET     \"/api/provider/openai/v1/models\"" request_id=6fdc14aa
=== RUN   TestAmpProviderModelRoutes/anthropic_models
time="2026-02-28T16:18:52+03:00" level=info msg="Kiro OAuth Web routes registered at /v0/oauth/kiro/*"
time="2026-02-28T16:18:52+03:00" level=info msg="200 |            0s |       192.0.2.1 | GET     \"/api/provider/anthropic/v1/models\"" request_id=a59191ab
=== RUN   TestAmpProviderModelRoutes/google_models_v1
time="2026-02-28T16:18:52+03:00" level=info msg="Kiro OAuth Web routes registered at /v0/oauth/kiro/*"
time="2026-02-28T16:18:52+03:00" level=info msg="200 |            0s |       192.0.2.1 | GET     \"/api/provider/google/v1/models\"" request_id=ac9f7210
=== RUN   TestAmpProviderModelRoutes/google_models_v1beta
time="2026-02-28T16:18:52+03:00" level=info msg="Kiro OAuth Web routes registered at /v0/oauth/kiro/*"
time="2026-02-28T16:18:52+03:00" level=info msg="200 |            0s |       192.0.2.1 | GET     \"/api/provider/google/v1beta/models\"" request_id=c183ad18
--- PASS: TestAmpProviderModelRoutes (0.03s)
    --- PASS: TestAmpProviderModelRoutes/openai_root_models (0.01s)
    --- PASS: TestAmpProviderModelRoutes/groq_root_models (0.00s)
    --- PASS: TestAmpProviderModelRoutes/openai_models (0.00s)
    --- PASS: TestAmpProviderModelRoutes/anthropic_models (0.00s)
    --- PASS: TestAmpProviderModelRoutes/google_models_v1 (0.00s)
    --- PASS: TestAmpProviderModelRoutes/google_models_v1beta (0.01s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/api	0.592s
=== RUN   TestAPICall_CBOR_Support
=== RUN   TestAPICall_CBOR_Support/JSON_request_and_response
=== RUN   TestAPICall_CBOR_Support/CBOR_request_and_response
    api_tools_cbor_test.go:102: CBOR response decoded successfully: status_code=200
=== RUN   TestAPICall_CBOR_Support/CBOR_encoding_and_decoding_consistency
--- PASS: TestAPICall_CBOR_Support (1.23s)
    --- PASS: TestAPICall_CBOR_Support/JSON_request_and_response (0.55s)
    --- PASS: TestAPICall_CBOR_Support/CBOR_request_and_response (0.68s)
    --- PASS: TestAPICall_CBOR_Support/CBOR_encoding_and_decoding_consistency (0.00s)
=== RUN   TestResolveTokenForAuth_Antigravity_RefreshesExpiredToken
--- PASS: TestResolveTokenForAuth_Antigravity_RefreshesExpiredToken (0.00s)
=== RUN   TestResolveTokenForAuth_Antigravity_SkipsRefreshWhenTokenValid
--- PASS: TestResolveTokenForAuth_Antigravity_SkipsRefreshWhenTokenValid (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/api/handlers/management	1.924s
=== RUN   TestShouldLogRequest_ManagementPathsSkipped
--- PASS: TestShouldLogRequest_ManagementPathsSkipped (0.00s)
=== RUN   TestNewResponseWriterWrapper_InitializesCorrectly
--- PASS: TestNewResponseWriterWrapper_InitializesCorrectly (0.00s)
=== RUN   TestResponseWriterWrapper_ShouldBufferResponseBody_LogOnErrorOnly
--- PASS: TestResponseWriterWrapper_ShouldBufferResponseBody_LogOnErrorOnly (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/api/middleware	0.415s
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/api/modules	[no test files]
=== RUN   TestAmpModule_Name
--- PASS: TestAmpModule_Name (0.00s)
=== RUN   TestAmpModule_New
--- PASS: TestAmpModule_New (0.00s)
=== RUN   TestAmpModule_Register_WithUpstream
time="2026-02-28T16:18:53+03:00" level=info msg="amp upstream proxy enabled for: http://127.0.0.1:58174"
--- PASS: TestAmpModule_Register_WithUpstream (0.00s)
=== RUN   TestAmpModule_Register_WithoutUpstream
--- PASS: TestAmpModule_Register_WithoutUpstream (0.00s)
=== RUN   TestAmpModule_Register_InvalidUpstream
--- PASS: TestAmpModule_Register_InvalidUpstream (0.00s)
=== RUN   TestAmpModule_OnConfigUpdated_CacheInvalidation
--- PASS: TestAmpModule_OnConfigUpdated_CacheInvalidation (0.00s)
=== RUN   TestAmpModule_OnConfigUpdated_NotEnabled
--- PASS: TestAmpModule_OnConfigUpdated_NotEnabled (0.00s)
=== RUN   TestAmpModule_OnConfigUpdated_URLRemoved
--- PASS: TestAmpModule_OnConfigUpdated_URLRemoved (0.00s)
=== RUN   TestAmpModule_OnConfigUpdated_NonMultiSourceSecret
--- PASS: TestAmpModule_OnConfigUpdated_NonMultiSourceSecret (0.00s)
=== RUN   TestAmpModule_AuthMiddleware_Fallback
time="2026-02-28T16:18:53+03:00" level=warning msg="amp module: no auth middleware provided, allowing all requests"
--- PASS: TestAmpModule_AuthMiddleware_Fallback (0.00s)
=== RUN   TestAmpModule_SecretSource_FromConfig
time="2026-02-28T16:18:53+03:00" level=info msg="amp upstream proxy enabled for: http://127.0.0.1:58175"
--- PASS: TestAmpModule_SecretSource_FromConfig (0.00s)
=== RUN   TestAmpModule_ProviderAliasesAlwaysRegistered
=== RUN   TestAmpModule_ProviderAliasesAlwaysRegistered/with_upstream
time="2026-02-28T16:18:53+03:00" level=info msg="amp upstream proxy enabled for: http://example.com"
=== RUN   TestAmpModule_ProviderAliasesAlwaysRegistered/without_upstream
--- PASS: TestAmpModule_ProviderAliasesAlwaysRegistered (0.00s)
    --- PASS: TestAmpModule_ProviderAliasesAlwaysRegistered/with_upstream (0.00s)
    --- PASS: TestAmpModule_ProviderAliasesAlwaysRegistered/without_upstream (0.00s)
=== RUN   TestAmpModule_hasUpstreamAPIKeysChanged_DetectsRemovedKeyWithDuplicateInput
--- PASS: TestAmpModule_hasUpstreamAPIKeysChanged_DetectsRemovedKeyWithDuplicateInput (0.00s)
=== RUN   TestAmpModule_hasUpstreamAPIKeysChanged_IgnoresEmptyAndWhitespaceKeys
--- PASS: TestAmpModule_hasUpstreamAPIKeysChanged_IgnoresEmptyAndWhitespaceKeys (0.00s)
=== RUN   TestFallbackHandler_ModelMapping_PreservesThinkingSuffixAndRewritesResponse
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
--- PASS: TestFallbackHandler_ModelMapping_PreservesThinkingSuffixAndRewritesResponse (0.00s)
=== RUN   TestCreateGeminiBridgeHandler_ActionParameterExtraction
=== RUN   TestCreateGeminiBridgeHandler_ActionParameterExtraction/no_mapping_uses_url_model
=== RUN   TestCreateGeminiBridgeHandler_ActionParameterExtraction/mapped_model_replaces_url_model
=== RUN   TestCreateGeminiBridgeHandler_ActionParameterExtraction/mapping_preserves_method
--- PASS: TestCreateGeminiBridgeHandler_ActionParameterExtraction (0.00s)
    --- PASS: TestCreateGeminiBridgeHandler_ActionParameterExtraction/no_mapping_uses_url_model (0.00s)
    --- PASS: TestCreateGeminiBridgeHandler_ActionParameterExtraction/mapped_model_replaces_url_model (0.00s)
    --- PASS: TestCreateGeminiBridgeHandler_ActionParameterExtraction/mapping_preserves_method (0.00s)
=== RUN   TestCreateGeminiBridgeHandler_InvalidPath
--- PASS: TestCreateGeminiBridgeHandler_InvalidPath (0.00s)
=== RUN   TestNewModelMapper
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 2 mapping(s)"
--- PASS: TestNewModelMapper (0.00s)
=== RUN   TestNewModelMapper_Empty
--- PASS: TestNewModelMapper_Empty (0.00s)
=== RUN   TestModelMapper_MapModel_NoProvider
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
--- PASS: TestModelMapper_MapModel_NoProvider (0.00s)
=== RUN   TestModelMapper_MapModel_WithProvider
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
--- PASS: TestModelMapper_MapModel_WithProvider (0.00s)
=== RUN   TestModelMapper_MapModel_TargetWithThinkingSuffix
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
--- PASS: TestModelMapper_MapModel_TargetWithThinkingSuffix (0.00s)
=== RUN   TestModelMapper_MapModel_CaseInsensitive
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
--- PASS: TestModelMapper_MapModel_CaseInsensitive (0.00s)
=== RUN   TestModelMapper_MapModel_NotFound
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
--- PASS: TestModelMapper_MapModel_NotFound (0.00s)
=== RUN   TestModelMapper_MapModel_EmptyInput
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
--- PASS: TestModelMapper_MapModel_EmptyInput (0.00s)
=== RUN   TestModelMapper_UpdateMappings
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 2 mapping(s)"
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
--- PASS: TestModelMapper_UpdateMappings (0.00s)
=== RUN   TestModelMapper_UpdateMappings_SkipsInvalid
time="2026-02-28T16:18:53+03:00" level=warning msg="amp model mapping: skipping invalid mapping (from=\"\", to=\"model-b\")"
time="2026-02-28T16:18:53+03:00" level=warning msg="amp model mapping: skipping invalid mapping (from=\"model-a\", to=\"\")"
time="2026-02-28T16:18:53+03:00" level=warning msg="amp model mapping: skipping invalid mapping (from=\"\", to=\"model-b\")"
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
--- PASS: TestModelMapper_UpdateMappings_SkipsInvalid (0.00s)
=== RUN   TestModelMapper_GetMappings_ReturnsCopy
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
--- PASS: TestModelMapper_GetMappings_ReturnsCopy (0.00s)
=== RUN   TestModelMapper_Regex_MatchBaseWithoutParens
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 regex mapping(s)"
--- PASS: TestModelMapper_Regex_MatchBaseWithoutParens (0.00s)
=== RUN   TestModelMapper_Regex_ExactPrecedence
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 regex mapping(s)"
--- PASS: TestModelMapper_Regex_ExactPrecedence (0.00s)
=== RUN   TestModelMapper_Regex_InvalidPattern_Skipped
time="2026-02-28T16:18:53+03:00" level=warning msg="amp model mapping: invalid regex \"(\": error parsing regexp: missing closing ): `(?i)(`"
--- PASS: TestModelMapper_Regex_InvalidPattern_Skipped (0.00s)
=== RUN   TestModelMapper_Regex_CaseInsensitive
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 regex mapping(s)"
--- PASS: TestModelMapper_Regex_CaseInsensitive (0.00s)
=== RUN   TestModelMapper_SuffixPreservation
=== RUN   TestModelMapper_SuffixPreservation/numeric_suffix_preserved
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
=== RUN   TestModelMapper_SuffixPreservation/level_suffix_preserved
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
=== RUN   TestModelMapper_SuffixPreservation/no_suffix_unchanged
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
=== RUN   TestModelMapper_SuffixPreservation/config_suffix_takes_priority
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
=== RUN   TestModelMapper_SuffixPreservation/regex_with_suffix_preserved
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 regex mapping(s)"
=== RUN   TestModelMapper_SuffixPreservation/auto_suffix_preserved
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
=== RUN   TestModelMapper_SuffixPreservation/none_suffix_preserved
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
=== RUN   TestModelMapper_SuffixPreservation/case_insensitive_base_lookup_with_suffix
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
=== RUN   TestModelMapper_SuffixPreservation/empty_suffix_filtered_out
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
=== RUN   TestModelMapper_SuffixPreservation/incomplete_suffix_treated_as_no_suffix
time="2026-02-28T16:18:53+03:00" level=info msg="amp model mapping: loaded 1 mapping(s)"
--- PASS: TestModelMapper_SuffixPreservation (0.00s)
    --- PASS: TestModelMapper_SuffixPreservation/numeric_suffix_preserved (0.00s)
    --- PASS: TestModelMapper_SuffixPreservation/level_suffix_preserved (0.00s)
    --- PASS: TestModelMapper_SuffixPreservation/no_suffix_unchanged (0.00s)
    --- PASS: TestModelMapper_SuffixPreservation/config_suffix_takes_priority (0.00s)
    --- PASS: TestModelMapper_SuffixPreservation/regex_with_suffix_preserved (0.00s)
    --- PASS: TestModelMapper_SuffixPreservation/auto_suffix_preserved (0.00s)
    --- PASS: TestModelMapper_SuffixPreservation/none_suffix_preserved (0.00s)
    --- PASS: TestModelMapper_SuffixPreservation/case_insensitive_base_lookup_with_suffix (0.00s)
    --- PASS: TestModelMapper_SuffixPreservation/empty_suffix_filtered_out (0.00s)
    --- PASS: TestModelMapper_SuffixPreservation/incomplete_suffix_treated_as_no_suffix (0.00s)
=== RUN   TestCreateReverseProxy_ValidURL
--- PASS: TestCreateReverseProxy_ValidURL (0.00s)
=== RUN   TestCreateReverseProxy_InvalidURL
--- PASS: TestCreateReverseProxy_InvalidURL (0.00s)
=== RUN   TestModifyResponse_GzipScenarios
=== RUN   TestModifyResponse_GzipScenarios/decompresses_valid_gzip_no_header
=== RUN   TestModifyResponse_GzipScenarios/skips_when_ce_present
=== RUN   TestModifyResponse_GzipScenarios/passes_truncated_unchanged
time="2026-02-28T16:18:53+03:00" level=warning msg="amp proxy: gzip decompress error: unexpected EOF"
=== RUN   TestModifyResponse_GzipScenarios/passes_corrupted_unchanged
time="2026-02-28T16:18:53+03:00" level=warning msg="amp proxy: gzip header detected but decompress failed: unexpected EOF"
=== RUN   TestModifyResponse_GzipScenarios/non_gzip_unchanged
=== RUN   TestModifyResponse_GzipScenarios/empty_body
=== RUN   TestModifyResponse_GzipScenarios/single_byte_body
=== RUN   TestModifyResponse_GzipScenarios/skips_non_2xx_status
time="2026-02-28T16:18:53+03:00" level=warning msg="amp upstream responded with client error [404]"
--- PASS: TestModifyResponse_GzipScenarios (0.00s)
    --- PASS: TestModifyResponse_GzipScenarios/decompresses_valid_gzip_no_header (0.00s)
    --- PASS: TestModifyResponse_GzipScenarios/skips_when_ce_present (0.00s)
    --- PASS: TestModifyResponse_GzipScenarios/passes_truncated_unchanged (0.00s)
    --- PASS: TestModifyResponse_GzipScenarios/passes_corrupted_unchanged (0.00s)
    --- PASS: TestModifyResponse_GzipScenarios/non_gzip_unchanged (0.00s)
    --- PASS: TestModifyResponse_GzipScenarios/empty_body (0.00s)
    --- PASS: TestModifyResponse_GzipScenarios/single_byte_body (0.00s)
    --- PASS: TestModifyResponse_GzipScenarios/skips_non_2xx_status (0.00s)
=== RUN   TestModifyResponse_UpdatesContentLengthHeader
--- PASS: TestModifyResponse_UpdatesContentLengthHeader (0.00s)
=== RUN   TestModifyResponse_SkipsStreamingResponses
=== RUN   TestModifyResponse_SkipsStreamingResponses/sse_skips_decompression
--- PASS: TestModifyResponse_SkipsStreamingResponses (0.00s)
    --- PASS: TestModifyResponse_SkipsStreamingResponses/sse_skips_decompression (0.00s)
=== RUN   TestModifyResponse_DecompressesChunkedJSON
=== RUN   TestModifyResponse_DecompressesChunkedJSON/chunked_json_decompresses
--- PASS: TestModifyResponse_DecompressesChunkedJSON (0.00s)
    --- PASS: TestModifyResponse_DecompressesChunkedJSON/chunked_json_decompresses (0.00s)
=== RUN   TestReverseProxy_InjectsHeaders
--- PASS: TestReverseProxy_InjectsHeaders (0.00s)
=== RUN   TestReverseProxy_EmptySecret
--- PASS: TestReverseProxy_EmptySecret (0.00s)
=== RUN   TestReverseProxy_StripsClientCredentialsFromHeadersAndQuery
--- PASS: TestReverseProxy_StripsClientCredentialsFromHeadersAndQuery (0.00s)
=== RUN   TestReverseProxy_InjectsMappedSecret_FromRequestContext
--- PASS: TestReverseProxy_InjectsMappedSecret_FromRequestContext (0.00s)
=== RUN   TestReverseProxy_MappedSecret_FallsBackToDefault
--- PASS: TestReverseProxy_MappedSecret_FallsBackToDefault (0.00s)
=== RUN   TestReverseProxy_ErrorHandler
time="2026-02-28T16:18:53+03:00" level=error msg="amp upstream proxy error [network_error] for GET /any: dial tcp 127.0.0.1:1: connect: connection refused"
--- PASS: TestReverseProxy_ErrorHandler (0.00s)
=== RUN   TestReverseProxy_ErrorHandler_ContextCanceled
--- PASS: TestReverseProxy_ErrorHandler_ContextCanceled (0.00s)
=== RUN   TestReverseProxy_FullRoundTrip_Gzip
--- PASS: TestReverseProxy_FullRoundTrip_Gzip (0.00s)
=== RUN   TestReverseProxy_FullRoundTrip_PlainJSON
--- PASS: TestReverseProxy_FullRoundTrip_PlainJSON (0.00s)
=== RUN   TestIsStreamingResponse
=== RUN   TestIsStreamingResponse/sse
=== RUN   TestIsStreamingResponse/chunked_not_streaming
=== RUN   TestIsStreamingResponse/normal_json
=== RUN   TestIsStreamingResponse/empty
--- PASS: TestIsStreamingResponse (0.00s)
    --- PASS: TestIsStreamingResponse/sse (0.00s)
    --- PASS: TestIsStreamingResponse/chunked_not_streaming (0.00s)
    --- PASS: TestIsStreamingResponse/normal_json (0.00s)
    --- PASS: TestIsStreamingResponse/empty (0.00s)
=== RUN   TestFilterBetaFeatures
=== RUN   TestFilterBetaFeatures/Remove_context-1m_from_middle
=== RUN   TestFilterBetaFeatures/Remove_context-1m_from_start
=== RUN   TestFilterBetaFeatures/Remove_context-1m_from_end
=== RUN   TestFilterBetaFeatures/Feature_not_present
=== RUN   TestFilterBetaFeatures/Only_feature_to_remove
=== RUN   TestFilterBetaFeatures/Empty_header
=== RUN   TestFilterBetaFeatures/Header_with_spaces
--- PASS: TestFilterBetaFeatures (0.00s)
    --- PASS: TestFilterBetaFeatures/Remove_context-1m_from_middle (0.00s)
    --- PASS: TestFilterBetaFeatures/Remove_context-1m_from_start (0.00s)
    --- PASS: TestFilterBetaFeatures/Remove_context-1m_from_end (0.00s)
    --- PASS: TestFilterBetaFeatures/Feature_not_present (0.00s)
    --- PASS: TestFilterBetaFeatures/Only_feature_to_remove (0.00s)
    --- PASS: TestFilterBetaFeatures/Empty_header (0.00s)
    --- PASS: TestFilterBetaFeatures/Header_with_spaces (0.00s)
=== RUN   TestRewriteModelInResponse_TopLevel
--- PASS: TestRewriteModelInResponse_TopLevel (0.00s)
=== RUN   TestRewriteModelInResponse_ResponseModel
--- PASS: TestRewriteModelInResponse_ResponseModel (0.00s)
=== RUN   TestRewriteModelInResponse_ResponseCreated
--- PASS: TestRewriteModelInResponse_ResponseCreated (0.00s)
=== RUN   TestRewriteModelInResponse_NoModelField
--- PASS: TestRewriteModelInResponse_NoModelField (0.00s)
=== RUN   TestRewriteModelInResponse_EmptyOriginalModel
--- PASS: TestRewriteModelInResponse_EmptyOriginalModel (0.00s)
=== RUN   TestRewriteStreamChunk_SSEWithResponseModel
--- PASS: TestRewriteStreamChunk_SSEWithResponseModel (0.00s)
=== RUN   TestRewriteStreamChunk_MultipleEvents
--- PASS: TestRewriteStreamChunk_MultipleEvents (0.00s)
=== RUN   TestRewriteStreamChunk_MessageModel
--- PASS: TestRewriteStreamChunk_MessageModel (0.00s)
=== RUN   TestRegisterManagementRoutes
=== RUN   TestRegisterManagementRoutes//api/internal
=== RUN   TestRegisterManagementRoutes//api/internal/some/path
=== RUN   TestRegisterManagementRoutes//api/user
=== RUN   TestRegisterManagementRoutes//api/user/profile
=== RUN   TestRegisterManagementRoutes//api/auth
=== RUN   TestRegisterManagementRoutes//api/auth/login
=== RUN   TestRegisterManagementRoutes//api/meta
=== RUN   TestRegisterManagementRoutes//api/telemetry
=== RUN   TestRegisterManagementRoutes//api/threads
=== RUN   TestRegisterManagementRoutes//threads/
=== RUN   TestRegisterManagementRoutes//threads.rss
=== RUN   TestRegisterManagementRoutes//api/otel
=== RUN   TestRegisterManagementRoutes//api/tab
=== RUN   TestRegisterManagementRoutes//api/tab/some/path
=== RUN   TestRegisterManagementRoutes//auth
=== RUN   TestRegisterManagementRoutes//auth/cli-login
=== RUN   TestRegisterManagementRoutes//auth/callback
=== RUN   TestRegisterManagementRoutes//api/provider/google/v1beta1/models
=== RUN   TestRegisterManagementRoutes//api/provider/google/v1beta1/models#01
--- PASS: TestRegisterManagementRoutes (0.01s)
    --- PASS: TestRegisterManagementRoutes//api/internal (0.00s)
    --- PASS: TestRegisterManagementRoutes//api/internal/some/path (0.00s)
    --- PASS: TestRegisterManagementRoutes//api/user (0.00s)
    --- PASS: TestRegisterManagementRoutes//api/user/profile (0.00s)
    --- PASS: TestRegisterManagementRoutes//api/auth (0.00s)
    --- PASS: TestRegisterManagementRoutes//api/auth/login (0.00s)
    --- PASS: TestRegisterManagementRoutes//api/meta (0.00s)
    --- PASS: TestRegisterManagementRoutes//api/telemetry (0.00s)
    --- PASS: TestRegisterManagementRoutes//api/threads (0.00s)
    --- PASS: TestRegisterManagementRoutes//threads/ (0.00s)
    --- PASS: TestRegisterManagementRoutes//threads.rss (0.00s)
    --- PASS: TestRegisterManagementRoutes//api/otel (0.00s)
    --- PASS: TestRegisterManagementRoutes//api/tab (0.00s)
    --- PASS: TestRegisterManagementRoutes//api/tab/some/path (0.00s)
    --- PASS: TestRegisterManagementRoutes//auth (0.00s)
    --- PASS: TestRegisterManagementRoutes//auth/cli-login (0.00s)
    --- PASS: TestRegisterManagementRoutes//auth/callback (0.00s)
    --- PASS: TestRegisterManagementRoutes//api/provider/google/v1beta1/models (0.00s)
    --- PASS: TestRegisterManagementRoutes//api/provider/google/v1beta1/models#01 (0.00s)
=== RUN   TestRegisterProviderAliases_AllProvidersRegistered
=== RUN   TestRegisterProviderAliases_AllProvidersRegistered//api/provider/openai/models
=== RUN   TestRegisterProviderAliases_AllProvidersRegistered//api/provider/anthropic/models
=== RUN   TestRegisterProviderAliases_AllProvidersRegistered//api/provider/google/models
=== RUN   TestRegisterProviderAliases_AllProvidersRegistered//api/provider/groq/models
=== RUN   TestRegisterProviderAliases_AllProvidersRegistered//api/provider/openai/chat/completions
=== RUN   TestRegisterProviderAliases_AllProvidersRegistered//api/provider/anthropic/v1/messages
=== RUN   TestRegisterProviderAliases_AllProvidersRegistered//api/provider/google/v1beta/models
--- PASS: TestRegisterProviderAliases_AllProvidersRegistered (0.00s)
    --- PASS: TestRegisterProviderAliases_AllProvidersRegistered//api/provider/openai/models (0.00s)
    --- PASS: TestRegisterProviderAliases_AllProvidersRegistered//api/provider/anthropic/models (0.00s)
    --- PASS: TestRegisterProviderAliases_AllProvidersRegistered//api/provider/google/models (0.00s)
    --- PASS: TestRegisterProviderAliases_AllProvidersRegistered//api/provider/groq/models (0.00s)
    --- PASS: TestRegisterProviderAliases_AllProvidersRegistered//api/provider/openai/chat/completions (0.00s)
    --- PASS: TestRegisterProviderAliases_AllProvidersRegistered//api/provider/anthropic/v1/messages (0.00s)
    --- PASS: TestRegisterProviderAliases_AllProvidersRegistered//api/provider/google/v1beta/models (0.00s)
=== RUN   TestRegisterProviderAliases_DynamicModelsHandler
=== RUN   TestRegisterProviderAliases_DynamicModelsHandler/openai
=== RUN   TestRegisterProviderAliases_DynamicModelsHandler/anthropic
=== RUN   TestRegisterProviderAliases_DynamicModelsHandler/google
=== RUN   TestRegisterProviderAliases_DynamicModelsHandler/groq
=== RUN   TestRegisterProviderAliases_DynamicModelsHandler/cerebras
--- PASS: TestRegisterProviderAliases_DynamicModelsHandler (0.00s)
    --- PASS: TestRegisterProviderAliases_DynamicModelsHandler/openai (0.00s)
    --- PASS: TestRegisterProviderAliases_DynamicModelsHandler/anthropic (0.00s)
    --- PASS: TestRegisterProviderAliases_DynamicModelsHandler/google (0.00s)
    --- PASS: TestRegisterProviderAliases_DynamicModelsHandler/groq (0.00s)
    --- PASS: TestRegisterProviderAliases_DynamicModelsHandler/cerebras (0.00s)
=== RUN   TestRegisterProviderAliases_V1Routes
=== RUN   TestRegisterProviderAliases_V1Routes//api/provider/openai/v1/models
=== RUN   TestRegisterProviderAliases_V1Routes//api/provider/openai/v1/chat/completions
=== RUN   TestRegisterProviderAliases_V1Routes//api/provider/openai/v1/completions
=== RUN   TestRegisterProviderAliases_V1Routes//api/provider/anthropic/v1/messages
=== RUN   TestRegisterProviderAliases_V1Routes//api/provider/anthropic/v1/messages/count_tokens
--- PASS: TestRegisterProviderAliases_V1Routes (0.00s)
    --- PASS: TestRegisterProviderAliases_V1Routes//api/provider/openai/v1/models (0.00s)
    --- PASS: TestRegisterProviderAliases_V1Routes//api/provider/openai/v1/chat/completions (0.00s)
    --- PASS: TestRegisterProviderAliases_V1Routes//api/provider/openai/v1/completions (0.00s)
    --- PASS: TestRegisterProviderAliases_V1Routes//api/provider/anthropic/v1/messages (0.00s)
    --- PASS: TestRegisterProviderAliases_V1Routes//api/provider/anthropic/v1/messages/count_tokens (0.00s)
=== RUN   TestRegisterProviderAliases_V1BetaRoutes
=== RUN   TestRegisterProviderAliases_V1BetaRoutes//api/provider/google/v1beta/models
=== RUN   TestRegisterProviderAliases_V1BetaRoutes//api/provider/google/v1beta/models/generateContent
--- PASS: TestRegisterProviderAliases_V1BetaRoutes (0.00s)
    --- PASS: TestRegisterProviderAliases_V1BetaRoutes//api/provider/google/v1beta/models (0.00s)
    --- PASS: TestRegisterProviderAliases_V1BetaRoutes//api/provider/google/v1beta/models/generateContent (0.00s)
=== RUN   TestRegisterProviderAliases_NoAuthMiddleware
--- PASS: TestRegisterProviderAliases_NoAuthMiddleware (0.00s)
=== RUN   TestLocalhostOnlyMiddleware_PreventsSpoofing
=== RUN   TestLocalhostOnlyMiddleware_PreventsSpoofing/spoofed_header_remote_connection
time="2026-02-28T16:18:53+03:00" level=warning msg="amp management: non-localhost connection from 192.168.1.100:12345 attempted access, denying"
=== RUN   TestLocalhostOnlyMiddleware_PreventsSpoofing/real_localhost_ipv4
=== RUN   TestLocalhostOnlyMiddleware_PreventsSpoofing/real_localhost_ipv6
=== RUN   TestLocalhostOnlyMiddleware_PreventsSpoofing/remote_ipv4
time="2026-02-28T16:18:53+03:00" level=warning msg="amp management: non-localhost connection from 203.0.113.42:8080 attempted access, denying"
=== RUN   TestLocalhostOnlyMiddleware_PreventsSpoofing/remote_ipv6
time="2026-02-28T16:18:53+03:00" level=warning msg="amp management: non-localhost connection from [2001:db8::1]:9090 attempted access, denying"
=== RUN   TestLocalhostOnlyMiddleware_PreventsSpoofing/spoofed_localhost_ipv6
time="2026-02-28T16:18:53+03:00" level=warning msg="amp management: non-localhost connection from 203.0.113.42:8080 attempted access, denying"
--- PASS: TestLocalhostOnlyMiddleware_PreventsSpoofing (0.00s)
    --- PASS: TestLocalhostOnlyMiddleware_PreventsSpoofing/spoofed_header_remote_connection (0.00s)
    --- PASS: TestLocalhostOnlyMiddleware_PreventsSpoofing/real_localhost_ipv4 (0.00s)
    --- PASS: TestLocalhostOnlyMiddleware_PreventsSpoofing/real_localhost_ipv6 (0.00s)
    --- PASS: TestLocalhostOnlyMiddleware_PreventsSpoofing/remote_ipv4 (0.00s)
    --- PASS: TestLocalhostOnlyMiddleware_PreventsSpoofing/remote_ipv6 (0.00s)
    --- PASS: TestLocalhostOnlyMiddleware_PreventsSpoofing/spoofed_localhost_ipv6 (0.00s)
=== RUN   TestLocalhostOnlyMiddleware_HotReload
time="2026-02-28T16:18:53+03:00" level=warning msg="amp management: non-localhost connection from 192.168.1.100:12345 attempted access, denying"
time="2026-02-28T16:18:53+03:00" level=warning msg="amp management: non-localhost connection from 192.168.1.100:12345 attempted access, denying"
--- PASS: TestLocalhostOnlyMiddleware_HotReload (0.00s)
=== RUN   TestMultiSourceSecret_PrecedenceOrder
=== RUN   TestMultiSourceSecret_PrecedenceOrder/config_wins
=== RUN   TestMultiSourceSecret_PrecedenceOrder/env_wins_when_no_cfg
=== RUN   TestMultiSourceSecret_PrecedenceOrder/file_when_no_cfg_env
=== RUN   TestMultiSourceSecret_PrecedenceOrder/empty_cfg_trims_then_env
=== RUN   TestMultiSourceSecret_PrecedenceOrder/empty_env_then_file
=== RUN   TestMultiSourceSecret_PrecedenceOrder/missing_file_returns_empty
=== RUN   TestMultiSourceSecret_PrecedenceOrder/all_empty_returns_empty
--- PASS: TestMultiSourceSecret_PrecedenceOrder (0.00s)
    --- PASS: TestMultiSourceSecret_PrecedenceOrder/config_wins (0.00s)
    --- PASS: TestMultiSourceSecret_PrecedenceOrder/env_wins_when_no_cfg (0.00s)
    --- PASS: TestMultiSourceSecret_PrecedenceOrder/file_when_no_cfg_env (0.00s)
    --- PASS: TestMultiSourceSecret_PrecedenceOrder/empty_cfg_trims_then_env (0.00s)
    --- PASS: TestMultiSourceSecret_PrecedenceOrder/empty_env_then_file (0.00s)
    --- PASS: TestMultiSourceSecret_PrecedenceOrder/missing_file_returns_empty (0.00s)
    --- PASS: TestMultiSourceSecret_PrecedenceOrder/all_empty_returns_empty (0.00s)
=== RUN   TestMultiSourceSecret_CacheBehavior
--- PASS: TestMultiSourceSecret_CacheBehavior (0.06s)
=== RUN   TestMultiSourceSecret_FileHandling
=== RUN   TestMultiSourceSecret_FileHandling/missing_file_no_error
=== RUN   TestMultiSourceSecret_FileHandling/invalid_json
=== RUN   TestMultiSourceSecret_FileHandling/missing_key_in_json
=== RUN   TestMultiSourceSecret_FileHandling/empty_key_value
--- PASS: TestMultiSourceSecret_FileHandling (0.00s)
    --- PASS: TestMultiSourceSecret_FileHandling/missing_file_no_error (0.00s)
    --- PASS: TestMultiSourceSecret_FileHandling/invalid_json (0.00s)
    --- PASS: TestMultiSourceSecret_FileHandling/missing_key_in_json (0.00s)
    --- PASS: TestMultiSourceSecret_FileHandling/empty_key_value (0.00s)
=== RUN   TestMultiSourceSecret_Concurrency
--- PASS: TestMultiSourceSecret_Concurrency (0.00s)
=== RUN   TestStaticSecretSource
=== RUN   TestStaticSecretSource/returns_provided_key
=== RUN   TestStaticSecretSource/trims_whitespace
=== RUN   TestStaticSecretSource/empty_string
--- PASS: TestStaticSecretSource (0.00s)
    --- PASS: TestStaticSecretSource/returns_provided_key (0.00s)
    --- PASS: TestStaticSecretSource/trims_whitespace (0.00s)
    --- PASS: TestStaticSecretSource/empty_string (0.00s)
=== RUN   TestMultiSourceSecret_CacheEmptyResult
--- PASS: TestMultiSourceSecret_CacheEmptyResult (0.11s)
=== RUN   TestMappedSecretSource_UsesMappingFromContext
--- PASS: TestMappedSecretSource_UsesMappingFromContext (0.00s)
=== RUN   TestMappedSecretSource_DuplicateClientKey_FirstWins
time="2026-02-28T16:18:53+03:00" level=warning msg="amp upstream-api-keys: client API key appears in multiple entries; using first mapping."
--- PASS: TestMappedSecretSource_DuplicateClientKey_FirstWins (0.00s)
=== RUN   TestMappedSecretSource_DuplicateClientKey_LogsWarning
time="2026-02-28T16:18:53+03:00" level=warning msg="amp upstream-api-keys: client API key appears in multiple entries; using first mapping."
--- PASS: TestMappedSecretSource_DuplicateClientKey_LogsWarning (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/api/modules/amp	0.926s
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/auth	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/auth/antigravity	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/auth/claude	[no test files]
=== RUN   TestRefreshTokensWithRetry_ReturnsErrorAfterMaxRetries
time="2026-02-28T16:18:53+03:00" level=warning msg="Token refresh attempt 1 failed: token refresh failed with status 400: {\"error\":\"internal_server_error\"}"
time="2026-02-28T16:18:54+03:00" level=warning msg="Token refresh attempt 2 failed: token refresh failed with status 400: {\"error\":\"internal_server_error\"}"
--- PASS: TestRefreshTokensWithRetry_ReturnsErrorAfterMaxRetries (1.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/auth/codex	1.829s
=== RUN   TestFetchUserInfo_ReturnsLogin
--- PASS: TestFetchUserInfo_ReturnsLogin (0.00s)
=== RUN   TestFetchUserInfo_EmptyToken
--- PASS: TestFetchUserInfo_EmptyToken (0.00s)
=== RUN   TestFetchUserInfo_EmptyLogin
--- PASS: TestFetchUserInfo_EmptyLogin (0.00s)
=== RUN   TestFetchUserInfo_HTTPError
--- PASS: TestFetchUserInfo_HTTPError (0.00s)
=== RUN   TestCopilotTokenStorage_BasicFields
--- PASS: TestCopilotTokenStorage_BasicFields (0.00s)
=== RUN   TestCopilotAuthBundle_Fields
--- PASS: TestCopilotAuthBundle_Fields (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/auth/copilot	0.968s
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/auth/empty	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/auth/gemini	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/auth/iflow	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/auth/kilo	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/auth/kimi	[no test files]
=== RUN   TestExtractEmailFromJWT
=== RUN   TestExtractEmailFromJWT/Empty_token
=== RUN   TestExtractEmailFromJWT/Invalid_token_format
=== RUN   TestExtractEmailFromJWT/Invalid_token_-_not_base64
=== RUN   TestExtractEmailFromJWT/Valid_JWT_with_email
=== RUN   TestExtractEmailFromJWT/JWT_without_email_but_with_preferred_username
=== RUN   TestExtractEmailFromJWT/JWT_with_email-like_sub
=== RUN   TestExtractEmailFromJWT/JWT_without_any_email_fields
--- PASS: TestExtractEmailFromJWT (0.00s)
    --- PASS: TestExtractEmailFromJWT/Empty_token (0.00s)
    --- PASS: TestExtractEmailFromJWT/Invalid_token_format (0.00s)
    --- PASS: TestExtractEmailFromJWT/Invalid_token_-_not_base64 (0.00s)
    --- PASS: TestExtractEmailFromJWT/Valid_JWT_with_email (0.00s)
    --- PASS: TestExtractEmailFromJWT/JWT_without_email_but_with_preferred_username (0.00s)
    --- PASS: TestExtractEmailFromJWT/JWT_with_email-like_sub (0.00s)
    --- PASS: TestExtractEmailFromJWT/JWT_without_any_email_fields (0.00s)
=== RUN   TestSanitizeEmailForFilename
=== RUN   TestSanitizeEmailForFilename/Empty_email
=== RUN   TestSanitizeEmailForFilename/Simple_email
=== RUN   TestSanitizeEmailForFilename/Email_with_space
=== RUN   TestSanitizeEmailForFilename/Email_with_special_chars
=== RUN   TestSanitizeEmailForFilename/Email_with_multiple_special_chars
=== RUN   TestSanitizeEmailForFilename/Path_traversal_attempt
=== RUN   TestSanitizeEmailForFilename/Path_traversal_with_backslash
=== RUN   TestSanitizeEmailForFilename/Null_byte_injection_attempt
=== RUN   TestSanitizeEmailForFilename/URL-encoded_slash
=== RUN   TestSanitizeEmailForFilename/URL-encoded_backslash
=== RUN   TestSanitizeEmailForFilename/URL-encoded_dot
=== RUN   TestSanitizeEmailForFilename/URL-encoded_null
=== RUN   TestSanitizeEmailForFilename/Double_URL-encoding_attack
=== RUN   TestSanitizeEmailForFilename/Mixed_case_URL-encoding
--- PASS: TestSanitizeEmailForFilename (0.00s)
    --- PASS: TestSanitizeEmailForFilename/Empty_email (0.00s)
    --- PASS: TestSanitizeEmailForFilename/Simple_email (0.00s)
    --- PASS: TestSanitizeEmailForFilename/Email_with_space (0.00s)
    --- PASS: TestSanitizeEmailForFilename/Email_with_special_chars (0.00s)
    --- PASS: TestSanitizeEmailForFilename/Email_with_multiple_special_chars (0.00s)
    --- PASS: TestSanitizeEmailForFilename/Path_traversal_attempt (0.00s)
    --- PASS: TestSanitizeEmailForFilename/Path_traversal_with_backslash (0.00s)
    --- PASS: TestSanitizeEmailForFilename/Null_byte_injection_attempt (0.00s)
    --- PASS: TestSanitizeEmailForFilename/URL-encoded_slash (0.00s)
    --- PASS: TestSanitizeEmailForFilename/URL-encoded_backslash (0.00s)
    --- PASS: TestSanitizeEmailForFilename/URL-encoded_dot (0.00s)
    --- PASS: TestSanitizeEmailForFilename/URL-encoded_null (0.00s)
    --- PASS: TestSanitizeEmailForFilename/Double_URL-encoding_attack (0.00s)
    --- PASS: TestSanitizeEmailForFilename/Mixed_case_URL-encoding (0.00s)
=== RUN   TestExtractIDCIdentifier
=== RUN   TestExtractIDCIdentifier/Empty_URL
=== RUN   TestExtractIDCIdentifier/Standard_IDC_URL_with_d-_prefix
=== RUN   TestExtractIDCIdentifier/IDC_URL_with_company_name
=== RUN   TestExtractIDCIdentifier/IDC_URL_with_simple_name
=== RUN   TestExtractIDCIdentifier/IDC_URL_without_https
=== RUN   TestExtractIDCIdentifier/IDC_URL_with_subdomain_only
=== RUN   TestExtractIDCIdentifier/Builder_ID_URL
--- PASS: TestExtractIDCIdentifier (0.00s)
    --- PASS: TestExtractIDCIdentifier/Empty_URL (0.00s)
    --- PASS: TestExtractIDCIdentifier/Standard_IDC_URL_with_d-_prefix (0.00s)
    --- PASS: TestExtractIDCIdentifier/IDC_URL_with_company_name (0.00s)
    --- PASS: TestExtractIDCIdentifier/IDC_URL_with_simple_name (0.00s)
    --- PASS: TestExtractIDCIdentifier/IDC_URL_without_https (0.00s)
    --- PASS: TestExtractIDCIdentifier/IDC_URL_with_subdomain_only (0.00s)
    --- PASS: TestExtractIDCIdentifier/Builder_ID_URL (0.00s)
=== RUN   TestGenerateTokenFileName
=== RUN   TestGenerateTokenFileName/IDC_with_email
=== RUN   TestGenerateTokenFileName/IDC_without_email_but_with_startUrl
=== RUN   TestGenerateTokenFileName/IDC_with_company_name_in_startUrl
=== RUN   TestGenerateTokenFileName/IDC_without_email_and_without_startUrl
=== RUN   TestGenerateTokenFileName/Builder_ID_with_email
=== RUN   TestGenerateTokenFileName/Builder_ID_without_email
=== RUN   TestGenerateTokenFileName/Social_auth_with_email
=== RUN   TestGenerateTokenFileName/Empty_auth_method
=== RUN   TestGenerateTokenFileName/Email_with_special_characters
--- PASS: TestGenerateTokenFileName (0.00s)
    --- PASS: TestGenerateTokenFileName/IDC_with_email (0.00s)
    --- PASS: TestGenerateTokenFileName/IDC_without_email_but_with_startUrl (0.00s)
    --- PASS: TestGenerateTokenFileName/IDC_with_company_name_in_startUrl (0.00s)
    --- PASS: TestGenerateTokenFileName/IDC_without_email_and_without_startUrl (0.00s)
    --- PASS: TestGenerateTokenFileName/Builder_ID_with_email (0.00s)
    --- PASS: TestGenerateTokenFileName/Builder_ID_without_email (0.00s)
    --- PASS: TestGenerateTokenFileName/Social_auth_with_email (0.00s)
    --- PASS: TestGenerateTokenFileName/Empty_auth_method (0.00s)
    --- PASS: TestGenerateTokenFileName/Email_with_special_characters (0.00s)
=== RUN   TestParseProfileARN
=== RUN   TestParseProfileARN/Empty_ARN
=== RUN   TestParseProfileARN/Invalid_format_-_too_few_parts
time="2026-02-28T16:18:54+03:00" level=warning msg="invalid ARN format: arn:aws:codewhisperer"
=== RUN   TestParseProfileARN/Invalid_prefix_-_not_arn
=== RUN   TestParseProfileARN/Invalid_service_-_not_codewhisperer
=== RUN   TestParseProfileARN/Invalid_region_-_no_hyphen
=== RUN   TestParseProfileARN/Empty_partition
=== RUN   TestParseProfileARN/Empty_region
=== RUN   TestParseProfileARN/Valid_ARN_-_us-east-1
=== RUN   TestParseProfileARN/Valid_ARN_-_ap-southeast-1
=== RUN   TestParseProfileARN/Valid_ARN_-_eu-west-1
=== RUN   TestParseProfileARN/Valid_ARN_-_aws-cn_partition
=== RUN   TestParseProfileARN/Valid_ARN_-_resource_without_slash
=== RUN   TestParseProfileARN/Valid_ARN_-_resource_with_colon
--- PASS: TestParseProfileARN (0.00s)
    --- PASS: TestParseProfileARN/Empty_ARN (0.00s)
    --- PASS: TestParseProfileARN/Invalid_format_-_too_few_parts (0.00s)
    --- PASS: TestParseProfileARN/Invalid_prefix_-_not_arn (0.00s)
    --- PASS: TestParseProfileARN/Invalid_service_-_not_codewhisperer (0.00s)
    --- PASS: TestParseProfileARN/Invalid_region_-_no_hyphen (0.00s)
    --- PASS: TestParseProfileARN/Empty_partition (0.00s)
    --- PASS: TestParseProfileARN/Empty_region (0.00s)
    --- PASS: TestParseProfileARN/Valid_ARN_-_us-east-1 (0.00s)
    --- PASS: TestParseProfileARN/Valid_ARN_-_ap-southeast-1 (0.00s)
    --- PASS: TestParseProfileARN/Valid_ARN_-_eu-west-1 (0.00s)
    --- PASS: TestParseProfileARN/Valid_ARN_-_aws-cn_partition (0.00s)
    --- PASS: TestParseProfileARN/Valid_ARN_-_resource_without_slash (0.00s)
    --- PASS: TestParseProfileARN/Valid_ARN_-_resource_with_colon (0.00s)
=== RUN   TestExtractRegionFromProfileArn
=== RUN   TestExtractRegionFromProfileArn/Empty_ARN
=== RUN   TestExtractRegionFromProfileArn/Invalid_ARN
time="2026-02-28T16:18:54+03:00" level=warning msg="invalid ARN format: invalid-arn"
=== RUN   TestExtractRegionFromProfileArn/Valid_ARN_-_us-east-1
=== RUN   TestExtractRegionFromProfileArn/Valid_ARN_-_ap-southeast-1
=== RUN   TestExtractRegionFromProfileArn/Valid_ARN_-_eu-central-1
=== RUN   TestExtractRegionFromProfileArn/Non-codewhisperer_ARN
--- PASS: TestExtractRegionFromProfileArn (0.00s)
    --- PASS: TestExtractRegionFromProfileArn/Empty_ARN (0.00s)
    --- PASS: TestExtractRegionFromProfileArn/Invalid_ARN (0.00s)
    --- PASS: TestExtractRegionFromProfileArn/Valid_ARN_-_us-east-1 (0.00s)
    --- PASS: TestExtractRegionFromProfileArn/Valid_ARN_-_ap-southeast-1 (0.00s)
    --- PASS: TestExtractRegionFromProfileArn/Valid_ARN_-_eu-central-1 (0.00s)
    --- PASS: TestExtractRegionFromProfileArn/Non-codewhisperer_ARN (0.00s)
=== RUN   TestGetKiroAPIEndpoint
=== RUN   TestGetKiroAPIEndpoint/Empty_region_-_defaults_to_us-east-1
=== RUN   TestGetKiroAPIEndpoint/us-east-1
=== RUN   TestGetKiroAPIEndpoint/us-west-2
=== RUN   TestGetKiroAPIEndpoint/ap-southeast-1
=== RUN   TestGetKiroAPIEndpoint/eu-west-1
=== RUN   TestGetKiroAPIEndpoint/cn-north-1
--- PASS: TestGetKiroAPIEndpoint (0.00s)
    --- PASS: TestGetKiroAPIEndpoint/Empty_region_-_defaults_to_us-east-1 (0.00s)
    --- PASS: TestGetKiroAPIEndpoint/us-east-1 (0.00s)
    --- PASS: TestGetKiroAPIEndpoint/us-west-2 (0.00s)
    --- PASS: TestGetKiroAPIEndpoint/ap-southeast-1 (0.00s)
    --- PASS: TestGetKiroAPIEndpoint/eu-west-1 (0.00s)
    --- PASS: TestGetKiroAPIEndpoint/cn-north-1 (0.00s)
=== RUN   TestGetKiroAPIEndpointFromProfileArn
=== RUN   TestGetKiroAPIEndpointFromProfileArn/Empty_ARN_-_defaults_to_us-east-1
=== RUN   TestGetKiroAPIEndpointFromProfileArn/Invalid_ARN_-_defaults_to_us-east-1
time="2026-02-28T16:18:54+03:00" level=warning msg="invalid ARN format: invalid-arn"
=== RUN   TestGetKiroAPIEndpointFromProfileArn/Valid_ARN_-_us-east-1
=== RUN   TestGetKiroAPIEndpointFromProfileArn/Valid_ARN_-_ap-southeast-1
=== RUN   TestGetKiroAPIEndpointFromProfileArn/Valid_ARN_-_eu-central-1
--- PASS: TestGetKiroAPIEndpointFromProfileArn (0.00s)
    --- PASS: TestGetKiroAPIEndpointFromProfileArn/Empty_ARN_-_defaults_to_us-east-1 (0.00s)
    --- PASS: TestGetKiroAPIEndpointFromProfileArn/Invalid_ARN_-_defaults_to_us-east-1 (0.00s)
    --- PASS: TestGetKiroAPIEndpointFromProfileArn/Valid_ARN_-_us-east-1 (0.00s)
    --- PASS: TestGetKiroAPIEndpointFromProfileArn/Valid_ARN_-_ap-southeast-1 (0.00s)
    --- PASS: TestGetKiroAPIEndpointFromProfileArn/Valid_ARN_-_eu-central-1 (0.00s)
=== RUN   TestGetCodeWhispererLegacyEndpoint
=== RUN   TestGetCodeWhispererLegacyEndpoint/Empty_region_-_defaults_to_us-east-1
=== RUN   TestGetCodeWhispererLegacyEndpoint/us-east-1
=== RUN   TestGetCodeWhispererLegacyEndpoint/us-west-2
=== RUN   TestGetCodeWhispererLegacyEndpoint/ap-northeast-1
--- PASS: TestGetCodeWhispererLegacyEndpoint (0.00s)
    --- PASS: TestGetCodeWhispererLegacyEndpoint/Empty_region_-_defaults_to_us-east-1 (0.00s)
    --- PASS: TestGetCodeWhispererLegacyEndpoint/us-east-1 (0.00s)
    --- PASS: TestGetCodeWhispererLegacyEndpoint/us-west-2 (0.00s)
    --- PASS: TestGetCodeWhispererLegacyEndpoint/ap-northeast-1 (0.00s)
=== RUN   TestExtractRegionFromMetadata
=== RUN   TestExtractRegionFromMetadata/Nil_metadata_-_defaults_to_us-east-1
=== RUN   TestExtractRegionFromMetadata/Empty_metadata_-_defaults_to_us-east-1
=== RUN   TestExtractRegionFromMetadata/Priority_1:_api_region_override
=== RUN   TestExtractRegionFromMetadata/Priority_2:_profile_arn_when_api_region_is_empty
=== RUN   TestExtractRegionFromMetadata/Priority_2:_profile_arn_when_api_region_is_missing
=== RUN   TestExtractRegionFromMetadata/Fallback:_default_when_profile_arn_is_invalid
time="2026-02-28T16:18:54+03:00" level=warning msg="invalid ARN format: invalid-arn"
=== RUN   TestExtractRegionFromMetadata/Fallback:_default_when_profile_arn_is_empty
=== RUN   TestExtractRegionFromMetadata/OIDC_region_is_NOT_used_for_API_region
=== RUN   TestExtractRegionFromMetadata/api_region_takes_precedence_over_OIDC_region
=== RUN   TestExtractRegionFromMetadata/Non-string_api_region_is_ignored
=== RUN   TestExtractRegionFromMetadata/Non-string_profile_arn_is_ignored
--- PASS: TestExtractRegionFromMetadata (0.00s)
    --- PASS: TestExtractRegionFromMetadata/Nil_metadata_-_defaults_to_us-east-1 (0.00s)
    --- PASS: TestExtractRegionFromMetadata/Empty_metadata_-_defaults_to_us-east-1 (0.00s)
    --- PASS: TestExtractRegionFromMetadata/Priority_1:_api_region_override (0.00s)
    --- PASS: TestExtractRegionFromMetadata/Priority_2:_profile_arn_when_api_region_is_empty (0.00s)
    --- PASS: TestExtractRegionFromMetadata/Priority_2:_profile_arn_when_api_region_is_missing (0.00s)
    --- PASS: TestExtractRegionFromMetadata/Fallback:_default_when_profile_arn_is_invalid (0.00s)
    --- PASS: TestExtractRegionFromMetadata/Fallback:_default_when_profile_arn_is_empty (0.00s)
    --- PASS: TestExtractRegionFromMetadata/OIDC_region_is_NOT_used_for_API_region (0.00s)
    --- PASS: TestExtractRegionFromMetadata/api_region_takes_precedence_over_OIDC_region (0.00s)
    --- PASS: TestExtractRegionFromMetadata/Non-string_api_region_is_ignored (0.00s)
    --- PASS: TestExtractRegionFromMetadata/Non-string_profile_arn_is_ignored (0.00s)
=== RUN   TestNewCooldownManager
--- PASS: TestNewCooldownManager (0.00s)
=== RUN   TestSetCooldown
--- PASS: TestSetCooldown (0.00s)
=== RUN   TestIsInCooldown_NotSet
--- PASS: TestIsInCooldown_NotSet (0.00s)
=== RUN   TestIsInCooldown_Expired
--- PASS: TestIsInCooldown_Expired (0.01s)
=== RUN   TestGetRemainingCooldown
--- PASS: TestGetRemainingCooldown (0.00s)
=== RUN   TestGetRemainingCooldown_NotSet
--- PASS: TestGetRemainingCooldown_NotSet (0.00s)
=== RUN   TestGetRemainingCooldown_Expired
--- PASS: TestGetRemainingCooldown_Expired (0.01s)
=== RUN   TestGetCooldownReason
--- PASS: TestGetCooldownReason (0.00s)
=== RUN   TestGetCooldownReason_NotSet
--- PASS: TestGetCooldownReason_NotSet (0.00s)
=== RUN   TestClearCooldown
--- PASS: TestClearCooldown (0.00s)
=== RUN   TestClearCooldown_NonExistent
--- PASS: TestClearCooldown_NonExistent (0.00s)
=== RUN   TestCleanupExpired
--- PASS: TestCleanupExpired (0.01s)
=== RUN   TestCalculateCooldownFor429_FirstRetry
--- PASS: TestCalculateCooldownFor429_FirstRetry (0.00s)
=== RUN   TestCalculateCooldownFor429_Exponential
--- PASS: TestCalculateCooldownFor429_Exponential (0.00s)
=== RUN   TestCalculateCooldownFor429_MaxCap
--- PASS: TestCalculateCooldownFor429_MaxCap (0.00s)
=== RUN   TestCalculateCooldownUntilNextDay
--- PASS: TestCalculateCooldownUntilNextDay (0.00s)
=== RUN   TestCooldownManager_ConcurrentAccess
--- PASS: TestCooldownManager_ConcurrentAccess (0.00s)
=== RUN   TestCooldownReasonConstants
--- PASS: TestCooldownReasonConstants (0.00s)
=== RUN   TestDefaultConstants
--- PASS: TestDefaultConstants (0.00s)
=== RUN   TestSetCooldown_OverwritesPrevious
--- PASS: TestSetCooldown_OverwritesPrevious (0.00s)
=== RUN   TestNewFingerprintManager
--- PASS: TestNewFingerprintManager (0.00s)
=== RUN   TestGetFingerprint_NewToken
--- PASS: TestGetFingerprint_NewToken (0.00s)
=== RUN   TestGetFingerprint_SameTokenReturnsSameFingerprint
--- PASS: TestGetFingerprint_SameTokenReturnsSameFingerprint (0.00s)
=== RUN   TestGetFingerprint_DifferentTokens
--- PASS: TestGetFingerprint_DifferentTokens (0.00s)
=== RUN   TestBuildUserAgent
--- PASS: TestBuildUserAgent (0.00s)
=== RUN   TestGetFingerprint_OSVersionMatchesOSType
--- PASS: TestGetFingerprint_OSVersionMatchesOSType (0.00s)
=== RUN   TestGenerateFromConfig_OSTypeFromRuntimeGOOS
--- PASS: TestGenerateFromConfig_OSTypeFromRuntimeGOOS (0.00s)
=== RUN   TestFingerprintManager_ConcurrentAccess
--- PASS: TestFingerprintManager_ConcurrentAccess (0.01s)
=== RUN   TestKiroHashStability
--- PASS: TestKiroHashStability (0.00s)
=== RUN   TestKiroHashFormat
--- PASS: TestKiroHashFormat (0.00s)
=== RUN   TestGlobalFingerprintManager
--- PASS: TestGlobalFingerprintManager (0.00s)
=== RUN   TestSetOIDCHeaders
--- PASS: TestSetOIDCHeaders (0.00s)
=== RUN   TestBuildURL
=== RUN   TestBuildURL/no_query_params
=== RUN   TestBuildURL/empty_query_params
=== RUN   TestBuildURL/single_query_param
=== RUN   TestBuildURL/multiple_query_params
=== RUN   TestBuildURL/omit_empty_params
--- PASS: TestBuildURL (0.00s)
    --- PASS: TestBuildURL/no_query_params (0.00s)
    --- PASS: TestBuildURL/empty_query_params (0.00s)
    --- PASS: TestBuildURL/single_query_param (0.00s)
    --- PASS: TestBuildURL/multiple_query_params (0.00s)
    --- PASS: TestBuildURL/omit_empty_params (0.00s)
=== RUN   TestBuildUserAgentFormat
--- PASS: TestBuildUserAgentFormat (0.00s)
=== RUN   TestBuildAmzUserAgentFormat
--- PASS: TestBuildAmzUserAgentFormat (0.00s)
=== RUN   TestSetRuntimeHeaders
--- PASS: TestSetRuntimeHeaders (0.00s)
=== RUN   TestSDKVersionsAreValid
--- PASS: TestSDKVersionsAreValid (0.00s)
=== RUN   TestKiroVersionsAreValid
--- PASS: TestKiroVersionsAreValid (0.00s)
=== RUN   TestNodeVersionsAreValid
--- PASS: TestNodeVersionsAreValid (0.00s)
=== RUN   TestFingerprintManager_SetConfig
--- PASS: TestFingerprintManager_SetConfig (0.00s)
=== RUN   TestFingerprintManager_SetConfig_PartialFields
--- PASS: TestFingerprintManager_SetConfig_PartialFields (0.00s)
=== RUN   TestFingerprintManager_SetConfig_ClearsCache
--- PASS: TestFingerprintManager_SetConfig_ClearsCache (0.00s)
=== RUN   TestGenerateAccountKey
=== RUN   TestGenerateAccountKey/Empty_seed
=== RUN   TestGenerateAccountKey/Simple_seed
=== RUN   TestGenerateAccountKey/Same_seed_produces_same_result
=== RUN   TestGenerateAccountKey/Different_seeds_produce_different_results
--- PASS: TestGenerateAccountKey (0.00s)
    --- PASS: TestGenerateAccountKey/Empty_seed (0.00s)
    --- PASS: TestGenerateAccountKey/Simple_seed (0.00s)
    --- PASS: TestGenerateAccountKey/Same_seed_produces_same_result (0.00s)
    --- PASS: TestGenerateAccountKey/Different_seeds_produce_different_results (0.00s)
=== RUN   TestGetAccountKey
=== RUN   TestGetAccountKey/Priority_1:_clientID_when_both_provided
=== RUN   TestGetAccountKey/Priority_2:_refreshToken_when_clientID_is_empty
=== RUN   TestGetAccountKey/Priority_3:_random_when_both_empty
=== RUN   TestGetAccountKey/clientID_only
=== RUN   TestGetAccountKey/refreshToken_only
--- PASS: TestGetAccountKey (0.00s)
    --- PASS: TestGetAccountKey/Priority_1:_clientID_when_both_provided (0.00s)
    --- PASS: TestGetAccountKey/Priority_2:_refreshToken_when_clientID_is_empty (0.00s)
    --- PASS: TestGetAccountKey/Priority_3:_random_when_both_empty (0.00s)
    --- PASS: TestGetAccountKey/clientID_only (0.00s)
    --- PASS: TestGetAccountKey/refreshToken_only (0.00s)
=== RUN   TestGetAccountKey_Deterministic
--- PASS: TestGetAccountKey_Deterministic (0.00s)
=== RUN   TestFingerprintDeterministic
--- PASS: TestFingerprintDeterministic (0.00s)
=== RUN   TestNewTokenScorer
--- PASS: TestNewTokenScorer (0.00s)
=== RUN   TestRecordRequest_Success
--- PASS: TestRecordRequest_Success (0.00s)
=== RUN   TestRecordRequest_Failure
--- PASS: TestRecordRequest_Failure (0.00s)
=== RUN   TestRecordRequest_MixedResults
--- PASS: TestRecordRequest_MixedResults (0.00s)
=== RUN   TestRecordRequest_ConsecutiveFailures
--- PASS: TestRecordRequest_ConsecutiveFailures (0.00s)
=== RUN   TestSetQuotaRemaining
--- PASS: TestSetQuotaRemaining (0.00s)
=== RUN   TestGetMetrics_NonExistent
--- PASS: TestGetMetrics_NonExistent (0.00s)
=== RUN   TestGetMetrics_ReturnsCopy
--- PASS: TestGetMetrics_ReturnsCopy (0.00s)
=== RUN   TestCalculateScore_NewToken
--- PASS: TestCalculateScore_NewToken (0.00s)
=== RUN   TestCalculateScore_PerfectToken
--- PASS: TestCalculateScore_PerfectToken (0.10s)
=== RUN   TestCalculateScore_FailedToken
--- PASS: TestCalculateScore_FailedToken (0.00s)
=== RUN   TestCalculateScore_FailPenalty
--- PASS: TestCalculateScore_FailPenalty (0.00s)
=== RUN   TestSelectBestToken_Empty
--- PASS: TestSelectBestToken_Empty (0.00s)
=== RUN   TestSelectBestToken_SingleToken
--- PASS: TestSelectBestToken_SingleToken (0.00s)
=== RUN   TestSelectBestToken_MultipleTokens
--- PASS: TestSelectBestToken_MultipleTokens (0.05s)
=== RUN   TestResetMetrics
--- PASS: TestResetMetrics (0.00s)
=== RUN   TestResetAllMetrics
--- PASS: TestResetAllMetrics (0.00s)
=== RUN   TestTokenScorer_ConcurrentAccess
--- PASS: TestTokenScorer_ConcurrentAccess (0.00s)
=== RUN   TestAvgLatencyCalculation
--- PASS: TestAvgLatencyCalculation (0.00s)
=== RUN   TestLastUsedUpdated
--- PASS: TestLastUsedUpdated (0.00s)
=== RUN   TestDefaultQuotaForNewToken
--- PASS: TestDefaultQuotaForNewToken (0.00s)
=== RUN   TestNewRateLimiter
--- PASS: TestNewRateLimiter (0.00s)
=== RUN   TestNewRateLimiterWithConfig
--- PASS: TestNewRateLimiterWithConfig (0.00s)
=== RUN   TestNewRateLimiterWithConfig_PartialConfig
--- PASS: TestNewRateLimiterWithConfig_PartialConfig (0.00s)
=== RUN   TestGetTokenState_NonExistent
--- PASS: TestGetTokenState_NonExistent (0.00s)
=== RUN   TestIsTokenAvailable_NewToken
--- PASS: TestIsTokenAvailable_NewToken (0.00s)
=== RUN   TestMarkTokenFailed
--- PASS: TestMarkTokenFailed (0.00s)
=== RUN   TestMarkTokenSuccess
--- PASS: TestMarkTokenSuccess (0.00s)
=== RUN   TestCheckAndMarkSuspended_Suspended
--- PASS: TestCheckAndMarkSuspended_Suspended (0.00s)
=== RUN   TestCheckAndMarkSuspended_NotSuspended
--- PASS: TestCheckAndMarkSuspended_NotSuspended (0.00s)
=== RUN   TestIsTokenAvailable_Suspended
--- PASS: TestIsTokenAvailable_Suspended (0.00s)
=== RUN   TestClearTokenState
--- PASS: TestClearTokenState (0.00s)
=== RUN   TestResetSuspension
--- PASS: TestResetSuspension (0.00s)
=== RUN   TestResetSuspension_NonExistent
--- PASS: TestResetSuspension_NonExistent (0.00s)
=== RUN   TestCalculateBackoff_ZeroFailCount
--- PASS: TestCalculateBackoff_ZeroFailCount (0.00s)
=== RUN   TestCalculateBackoff_Exponential
--- PASS: TestCalculateBackoff_Exponential (0.00s)
=== RUN   TestCalculateBackoff_MaxCap
--- PASS: TestCalculateBackoff_MaxCap (0.00s)
=== RUN   TestGetTokenState_ReturnsCopy
--- PASS: TestGetTokenState_ReturnsCopy (0.00s)
=== RUN   TestRateLimiter_ConcurrentAccess
--- PASS: TestRateLimiter_ConcurrentAccess (0.00s)
=== RUN   TestCalculateInterval_WithinRange
--- PASS: TestCalculateInterval_WithinRange (0.00s)
=== RUN   TestTryListAvailableProfiles_UsesClientIDForAccountKey
--- PASS: TestTryListAvailableProfiles_UsesClientIDForAccountKey (0.00s)
=== RUN   TestTryListAvailableProfiles_UsesRefreshTokenWhenClientIDMissing
--- PASS: TestTryListAvailableProfiles_UsesRefreshTokenWhenClientIDMissing (0.00s)
=== RUN   TestRegisterClientForAuthCodeWithIDC
--- PASS: TestRegisterClientForAuthCodeWithIDC (0.00s)
=== RUN   TestBuildAuthorizationURL
--- PASS: TestBuildAuthorizationURL (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/auth/kiro	1.074s
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/auth/qwen	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/auth/vertex	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/browser	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/buildinfo	[no test files]
=== RUN   TestCacheSignature_BasicStorageAndRetrieval
--- PASS: TestCacheSignature_BasicStorageAndRetrieval (0.00s)
=== RUN   TestCacheSignature_DifferentModelGroups
--- PASS: TestCacheSignature_DifferentModelGroups (0.00s)
=== RUN   TestCacheSignature_NotFound
--- PASS: TestCacheSignature_NotFound (0.00s)
=== RUN   TestCacheSignature_EmptyInputs
--- PASS: TestCacheSignature_EmptyInputs (0.00s)
=== RUN   TestCacheSignature_ShortSignatureRejected
--- PASS: TestCacheSignature_ShortSignatureRejected (0.00s)
=== RUN   TestClearSignatureCache_ModelGroup
--- PASS: TestClearSignatureCache_ModelGroup (0.00s)
=== RUN   TestClearSignatureCache_AllSessions
--- PASS: TestClearSignatureCache_AllSessions (0.00s)
=== RUN   TestHasValidSignature
=== RUN   TestHasValidSignature/valid_long_signature
=== RUN   TestHasValidSignature/exactly_50_chars
=== RUN   TestHasValidSignature/49_chars_-_invalid
=== RUN   TestHasValidSignature/empty_string
=== RUN   TestHasValidSignature/short_signature
=== RUN   TestHasValidSignature/gemini_sentinel
--- PASS: TestHasValidSignature (0.00s)
    --- PASS: TestHasValidSignature/valid_long_signature (0.00s)
    --- PASS: TestHasValidSignature/exactly_50_chars (0.00s)
    --- PASS: TestHasValidSignature/49_chars_-_invalid (0.00s)
    --- PASS: TestHasValidSignature/empty_string (0.00s)
    --- PASS: TestHasValidSignature/short_signature (0.00s)
    --- PASS: TestHasValidSignature/gemini_sentinel (0.00s)
=== RUN   TestCacheSignature_TextHashCollisionResistance
--- PASS: TestCacheSignature_TextHashCollisionResistance (0.00s)
=== RUN   TestCacheSignature_UnicodeText
--- PASS: TestCacheSignature_UnicodeText (0.00s)
=== RUN   TestCacheSignature_Overwrite
--- PASS: TestCacheSignature_Overwrite (0.00s)
=== RUN   TestCacheSignature_ExpirationLogic
--- PASS: TestCacheSignature_ExpirationLogic (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/cache	0.996s
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/cmd	[no test files]
=== RUN   TestMigrateOAuthModelAlias_SkipsIfNewFieldExists
=== PAUSE TestMigrateOAuthModelAlias_SkipsIfNewFieldExists
=== RUN   TestMigrateOAuthModelAlias_MigratesOldField
=== PAUSE TestMigrateOAuthModelAlias_MigratesOldField
=== RUN   TestMigrateOAuthModelAlias_ConvertsAntigravityModels
=== PAUSE TestMigrateOAuthModelAlias_ConvertsAntigravityModels
=== RUN   TestMigrateOAuthModelAlias_AddsDefaultIfNeitherExists
=== PAUSE TestMigrateOAuthModelAlias_AddsDefaultIfNeitherExists
=== RUN   TestMigrateOAuthModelAlias_PreservesOtherConfig
=== PAUSE TestMigrateOAuthModelAlias_PreservesOtherConfig
=== RUN   TestMigrateOAuthModelAlias_NonexistentFile
=== PAUSE TestMigrateOAuthModelAlias_NonexistentFile
=== RUN   TestMigrateOAuthModelAlias_EmptyFile
=== PAUSE TestMigrateOAuthModelAlias_EmptyFile
=== RUN   TestSanitizeOAuthModelAlias_PreservesForkFlag
--- PASS: TestSanitizeOAuthModelAlias_PreservesForkFlag (0.00s)
=== RUN   TestSanitizeOAuthModelAlias_AllowsMultipleAliasesForSameName
--- PASS: TestSanitizeOAuthModelAlias_AllowsMultipleAliasesForSameName (0.00s)
=== RUN   TestSanitizeOAuthModelAlias_InjectsDefaultKiroAliases
--- PASS: TestSanitizeOAuthModelAlias_InjectsDefaultKiroAliases (0.00s)
=== RUN   TestSanitizeOAuthModelAlias_InjectsDefaultGitHubCopilotAliases
--- PASS: TestSanitizeOAuthModelAlias_InjectsDefaultGitHubCopilotAliases (0.00s)
=== RUN   TestSanitizeOAuthModelAlias_DoesNotOverrideUserKiroAliases
--- PASS: TestSanitizeOAuthModelAlias_DoesNotOverrideUserKiroAliases (0.00s)
=== RUN   TestSanitizeOAuthModelAlias_DoesNotOverrideUserGitHubCopilotAliases
--- PASS: TestSanitizeOAuthModelAlias_DoesNotOverrideUserGitHubCopilotAliases (0.00s)
=== RUN   TestSanitizeOAuthModelAlias_DoesNotReinjectAfterExplicitDeletion
--- PASS: TestSanitizeOAuthModelAlias_DoesNotReinjectAfterExplicitDeletion (0.00s)
=== RUN   TestSanitizeOAuthModelAlias_GitHubCopilotDoesNotReinjectAfterExplicitDeletion
--- PASS: TestSanitizeOAuthModelAlias_GitHubCopilotDoesNotReinjectAfterExplicitDeletion (0.00s)
=== RUN   TestSanitizeOAuthModelAlias_DoesNotReinjectAfterExplicitDeletionEmpty
--- PASS: TestSanitizeOAuthModelAlias_DoesNotReinjectAfterExplicitDeletionEmpty (0.00s)
=== RUN   TestSanitizeOAuthModelAlias_InjectsDefaultKiroWhenEmpty
--- PASS: TestSanitizeOAuthModelAlias_InjectsDefaultKiroWhenEmpty (0.00s)
=== CONT  TestMigrateOAuthModelAlias_SkipsIfNewFieldExists
--- PASS: TestMigrateOAuthModelAlias_SkipsIfNewFieldExists (0.00s)
=== CONT  TestMigrateOAuthModelAlias_EmptyFile
=== CONT  TestMigrateOAuthModelAlias_AddsDefaultIfNeitherExists
--- PASS: TestMigrateOAuthModelAlias_EmptyFile (0.00s)
=== CONT  TestMigrateOAuthModelAlias_ConvertsAntigravityModels
=== CONT  TestMigrateOAuthModelAlias_MigratesOldField
=== CONT  TestMigrateOAuthModelAlias_NonexistentFile
--- PASS: TestMigrateOAuthModelAlias_NonexistentFile (0.00s)
=== CONT  TestMigrateOAuthModelAlias_PreservesOtherConfig
--- PASS: TestMigrateOAuthModelAlias_PreservesOtherConfig (0.00s)
--- PASS: TestMigrateOAuthModelAlias_AddsDefaultIfNeitherExists (0.00s)
--- PASS: TestMigrateOAuthModelAlias_MigratesOldField (0.00s)
--- PASS: TestMigrateOAuthModelAlias_ConvertsAntigravityModels (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/config	1.176s
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/constant	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/interfaces	[no test files]
=== RUN   TestGinLogrusRecoveryRepanicsErrAbortHandler


[31m2026/02/28 16:18:55 [Recovery] 2026/02/28 - 16:18:55 panic recovered:
net/http: abort Handler
/Users/anilcan/Code/ai-help/repos/CLIProxyAPIPlus/internal/logging/gin_logger_test.go:18 (0x104f9b083)
	TestGinLogrusRecoveryRepanicsErrAbortHandler.func1: panic(http.ErrAbortHandler)
/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/context.go:185 (0x104f795f7)
	(*Context).Next: c.handlers[c.index](c)
/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/recovery.go:102 (0x104f795e0)
	CustomRecoveryWithWriter.func1: c.Next()
/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/context.go:185 (0x104f785d3)
	(*Context).Next: c.handlers[c.index](c)
/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/gin.go:644 (0x104f78114)
	(*Engine).handleHTTPRequest: c.Next()
/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/gin.go:600 (0x104f77ea3)
	(*Engine).ServeHTTP: engine.handleHTTPRequest(c)
/Users/anilcan/Code/ai-help/repos/CLIProxyAPIPlus/internal/logging/gin_logger_test.go:41 (0x104f9a48b)
	TestGinLogrusRecoveryRepanicsErrAbortHandler: engine.ServeHTTP(recorder, req)
/opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 (0x104e1f017)
	tRunner: fn(t)
/opt/homebrew/Cellar/go/1.25.6/libexec/src/runtime/asm_arm64.s:1268 (0x104d94a73)
	goexit: MOVD	R0, R0	// NOP
[0m
--- PASS: TestGinLogrusRecoveryRepanicsErrAbortHandler (0.00s)
=== RUN   TestGinLogrusRecoveryHandlesRegularPanic


[31m2026/02/28 16:18:55 [Recovery] 2026/02/28 - 16:18:55 panic recovered:
boom
/Users/anilcan/Code/ai-help/repos/CLIProxyAPIPlus/internal/logging/gin_logger_test.go:50 (0x104f9b03b)
	TestGinLogrusRecoveryHandlesRegularPanic.func1: panic("boom")
/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/context.go:185 (0x104f795f7)
	(*Context).Next: c.handlers[c.index](c)
/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/recovery.go:102 (0x104f795e0)
	CustomRecoveryWithWriter.func1: c.Next()
/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/context.go:185 (0x104f785d3)
	(*Context).Next: c.handlers[c.index](c)
/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/gin.go:644 (0x104f78114)
	(*Engine).handleHTTPRequest: c.Next()
/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/gin.go:600 (0x104f77ea3)
	(*Engine).ServeHTTP: engine.handleHTTPRequest(c)
/Users/anilcan/Code/ai-help/repos/CLIProxyAPIPlus/internal/logging/gin_logger_test.go:56 (0x104f9a847)
	TestGinLogrusRecoveryHandlesRegularPanic: engine.ServeHTTP(recorder, req)
/opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 (0x104e1f017)
	tRunner: fn(t)
/opt/homebrew/Cellar/go/1.25.6/libexec/src/runtime/asm_arm64.s:1268 (0x104d94a73)
	goexit: MOVD	R0, R0	// NOP
[0m
time="2026-02-28T16:18:55+03:00" level=error msg="recovered from panic" panic=boom path=/panic stack="goroutine 23 [running]:\nruntime/debug.Stack()\n\t/opt/homebrew/Cellar/go/1.25.6/libexec/src/runtime/debug/stack.go:26 +0x64\ngithub.com/router-for-me/CLIProxyAPI/v6/internal/logging.GinLogrusRecovery.func1(0x1400016fa00, {0x10507dce0, 0x1051032f0})\n\t/Users/anilcan/Code/ai-help/repos/CLIProxyAPIPlus/internal/logging/gin_logger.go:123 +0x118\ngithub.com/gin-gonic/gin.CustomRecoveryWithWriter.func1.1()\n\t/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/recovery.go:98 +0x54c\npanic({0x10507dce0?, 0x1051032f0?})\n\t/opt/homebrew/Cellar/go/1.25.6/libexec/src/runtime/panic.go:783 +0x120\ngithub.com/router-for-me/CLIProxyAPI/v6/internal/logging.TestGinLogrusRecoveryHandlesRegularPanic.func1(0x1057435a0?)\n\t/Users/anilcan/Code/ai-help/repos/CLIProxyAPIPlus/internal/logging/gin_logger_test.go:50 +0x2c\ngithub.com/gin-gonic/gin.(*Context).Next(...)\n\t/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/context.go:185\ngithub.com/gin-gonic/gin.CustomRecoveryWithWriter.func1(0x1400016fa00)\n\t/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/recovery.go:102 +0x68\ngithub.com/gin-gonic/gin.(*Context).Next(...)\n\t/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/context.go:185\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest(0x140000b5860, 0x1400016fa00)\n\t/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/gin.go:644 +0x6d4\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP(0x140000b5860, {0x1051072a8, 0x140003991c0}, 0x1400039d2c0)\n\t/Users/anilcan/go/pkg/mod/github.com/gin-gonic/gin@v1.10.1/gin.go:600 +0x154\ngithub.com/router-for-me/CLIProxyAPI/v6/internal/logging.TestGinLogrusRecoveryHandlesRegularPanic(0x140003a81c0)\n\t/Users/anilcan/Code/ai-help/repos/CLIProxyAPIPlus/internal/logging/gin_logger_test.go:56 +0x198\ntesting.tRunner(0x140003a81c0, 0x105101430)\n\t/opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0xc8\ncreated by testing.(*T).Run in goroutine 1\n\t/opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x364\n"
--- PASS: TestGinLogrusRecoveryHandlesRegularPanic (0.00s)
=== RUN   TestEnforceLogDirSizeLimitDeletesOldest
--- PASS: TestEnforceLogDirSizeLimitDeletesOldest (0.00s)
=== RUN   TestEnforceLogDirSizeLimitSkipsProtected
--- PASS: TestEnforceLogDirSizeLimitSkipsProtected (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/logging	1.200s
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/managementasset	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/misc	[no test files]
=== RUN   TestModelRegistryHook_OnModelsRegisteredCalled
--- PASS: TestModelRegistryHook_OnModelsRegisteredCalled (0.00s)
=== RUN   TestModelRegistryHook_OnModelsUnregisteredCalled
--- PASS: TestModelRegistryHook_OnModelsUnregisteredCalled (0.00s)
=== RUN   TestModelRegistryHook_DoesNotBlockRegisterClient
--- PASS: TestModelRegistryHook_DoesNotBlockRegisterClient (0.00s)
=== RUN   TestModelRegistryHook_PanicDoesNotAffectRegistry
--- PASS: TestModelRegistryHook_PanicDoesNotAffectRegistry (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/registry	1.247s
=== RUN   TestAntigravityBuildRequest_RenamesParametersJsonSchema
=== RUN   TestAntigravityBuildRequest_RenamesParametersJsonSchema/gemini-2.5-pro
=== RUN   TestAntigravityBuildRequest_RenamesParametersJsonSchema/claude-opus-4-6
--- PASS: TestAntigravityBuildRequest_RenamesParametersJsonSchema (0.00s)
    --- PASS: TestAntigravityBuildRequest_RenamesParametersJsonSchema/gemini-2.5-pro (0.00s)
    --- PASS: TestAntigravityBuildRequest_RenamesParametersJsonSchema/claude-opus-4-6 (0.00s)
=== RUN   TestAntigravityBuildRequest_RemovesSchemaKeyword
--- PASS: TestAntigravityBuildRequest_RemovesSchemaKeyword (0.00s)
=== RUN   TestModelInfoClone_MutatingReturnedSliceLeavesOriginalIntact
--- PASS: TestModelInfoClone_MutatingReturnedSliceLeavesOriginalIntact (0.00s)
=== RUN   TestModelInfoThinkingLevels_FieldAccessible
--- PASS: TestModelInfoThinkingLevels_FieldAccessible (0.00s)
=== RUN   TestEnsureCacheControl
=== RUN   TestEnsureCacheControl/String_System_Prompt
=== RUN   TestEnsureCacheControl/Array_System_Prompt
=== RUN   TestEnsureCacheControl/Tools_Caching
=== RUN   TestEnsureCacheControl/Independent_Cache_Breakpoints
=== RUN   TestEnsureCacheControl/Only_Tools_No_System
=== RUN   TestEnsureCacheControl/Many_Tools_(Claude_Code_Scenario)
    caching_verify_test.go:154: test passed: 50 tools - cache_control only on last tool
=== RUN   TestEnsureCacheControl/Empty_Tools_Array
=== RUN   TestEnsureCacheControl/Messages_Caching_Second-To-Last_User
=== RUN   TestEnsureCacheControl/Messages_Skip_When_Cache_Control_Exists
--- PASS: TestEnsureCacheControl (0.00s)
    --- PASS: TestEnsureCacheControl/String_System_Prompt (0.00s)
    --- PASS: TestEnsureCacheControl/Array_System_Prompt (0.00s)
    --- PASS: TestEnsureCacheControl/Tools_Caching (0.00s)
    --- PASS: TestEnsureCacheControl/Independent_Cache_Breakpoints (0.00s)
    --- PASS: TestEnsureCacheControl/Only_Tools_No_System (0.00s)
    --- PASS: TestEnsureCacheControl/Many_Tools_(Claude_Code_Scenario) (0.00s)
    --- PASS: TestEnsureCacheControl/Empty_Tools_Array (0.00s)
    --- PASS: TestEnsureCacheControl/Messages_Caching_Second-To-Last_User (0.00s)
    --- PASS: TestEnsureCacheControl/Messages_Skip_When_Cache_Control_Exists (0.00s)
=== RUN   TestCacheControlOrder
    caching_verify_test.go:257: cache order correct: tools -> system
--- PASS: TestCacheControlOrder (0.00s)
=== RUN   TestApplyClaudeToolPrefix
--- PASS: TestApplyClaudeToolPrefix (0.00s)
=== RUN   TestApplyClaudeToolPrefix_WithToolReference
--- PASS: TestApplyClaudeToolPrefix_WithToolReference (0.00s)
=== RUN   TestApplyClaudeToolPrefix_SkipsBuiltinTools
--- PASS: TestApplyClaudeToolPrefix_SkipsBuiltinTools (0.00s)
=== RUN   TestApplyClaudeToolPrefix_BuiltinToolSkipped
--- PASS: TestApplyClaudeToolPrefix_BuiltinToolSkipped (0.00s)
=== RUN   TestApplyClaudeToolPrefix_KnownBuiltinInHistoryOnly
--- PASS: TestApplyClaudeToolPrefix_KnownBuiltinInHistoryOnly (0.00s)
=== RUN   TestApplyClaudeToolPrefix_CustomToolsPrefixed
--- PASS: TestApplyClaudeToolPrefix_CustomToolsPrefixed (0.00s)
=== RUN   TestApplyClaudeToolPrefix_ToolChoiceBuiltin
--- PASS: TestApplyClaudeToolPrefix_ToolChoiceBuiltin (0.00s)
=== RUN   TestStripClaudeToolPrefixFromResponse
--- PASS: TestStripClaudeToolPrefixFromResponse (0.00s)
=== RUN   TestStripClaudeToolPrefixFromResponse_WithToolReference
--- PASS: TestStripClaudeToolPrefixFromResponse_WithToolReference (0.00s)
=== RUN   TestStripClaudeToolPrefixFromStreamLine
--- PASS: TestStripClaudeToolPrefixFromStreamLine (0.00s)
=== RUN   TestStripClaudeToolPrefixFromStreamLine_WithToolReference
--- PASS: TestStripClaudeToolPrefixFromStreamLine_WithToolReference (0.00s)
=== RUN   TestApplyClaudeToolPrefix_NestedToolReference
--- PASS: TestApplyClaudeToolPrefix_NestedToolReference (0.00s)
=== RUN   TestClaudeExecutor_ReusesUserIDAcrossModelsWhenCacheEnabled
    claude_executor_test.go:228: End-to-end test: Fake HTTP server started at http://127.0.0.1:58249
    claude_executor_test.go:250: Sending request for model: claude-3-5-sonnet
    claude_executor_test.go:222: HTTP Server received request: model=claude-3-5-sonnet, user_id=user_fada9c82a691e94b52b52ac3e6f1cf0ebe2ca67b417adee8ecb94074e13e6405_account__session_e9b697af-9241-4c74-9be3-1a76979d6ae0, url=/v1/messages?beta=true
    claude_executor_test.go:250: Sending request for model: claude-3-5-haiku
    claude_executor_test.go:222: HTTP Server received request: model=claude-3-5-haiku, user_id=user_fada9c82a691e94b52b52ac3e6f1cf0ebe2ca67b417adee8ecb94074e13e6405_account__session_e9b697af-9241-4c74-9be3-1a76979d6ae0, url=/v1/messages?beta=true
    claude_executor_test.go:268: user_id[0] (model=claude-3-5-sonnet): user_fada9c82a691e94b52b52ac3e6f1cf0ebe2ca67b417adee8ecb94074e13e6405_account__session_e9b697af-9241-4c74-9be3-1a76979d6ae0
    claude_executor_test.go:269: user_id[1] (model=claude-3-5-haiku): user_fada9c82a691e94b52b52ac3e6f1cf0ebe2ca67b417adee8ecb94074e13e6405_account__session_e9b697af-9241-4c74-9be3-1a76979d6ae0
    claude_executor_test.go:276:  End-to-end test passed: Same user_id (user_fada9c82a691e94b52b52ac3e6f1cf0ebe2ca67b417adee8ecb94074e13e6405_account__session_e9b697af-9241-4c74-9be3-1a76979d6ae0) was used for both models
--- PASS: TestClaudeExecutor_ReusesUserIDAcrossModelsWhenCacheEnabled (0.01s)
=== RUN   TestClaudeExecutor_GeneratesNewUserIDByDefault
--- PASS: TestClaudeExecutor_GeneratesNewUserIDByDefault (0.00s)
=== RUN   TestStripClaudeToolPrefixFromResponse_NestedToolReference
--- PASS: TestStripClaudeToolPrefixFromResponse_NestedToolReference (0.00s)
=== RUN   TestApplyClaudeToolPrefix_NestedToolReferenceWithStringContent
--- PASS: TestApplyClaudeToolPrefix_NestedToolReferenceWithStringContent (0.00s)
=== RUN   TestApplyClaudeToolPrefix_SkipsBuiltinToolReference
--- PASS: TestApplyClaudeToolPrefix_SkipsBuiltinToolReference (0.00s)
=== RUN   TestParseCodexRetryAfter
=== RUN   TestParseCodexRetryAfter/resets_in_seconds
=== RUN   TestParseCodexRetryAfter/prefers_resets_at
=== RUN   TestParseCodexRetryAfter/fallback_when_resets_at_is_past
=== RUN   TestParseCodexRetryAfter/non-429_status_code
=== RUN   TestParseCodexRetryAfter/non_usage_limit_reached_error_type
--- PASS: TestParseCodexRetryAfter (0.00s)
    --- PASS: TestParseCodexRetryAfter/resets_in_seconds (0.00s)
    --- PASS: TestParseCodexRetryAfter/prefers_resets_at (0.00s)
    --- PASS: TestParseCodexRetryAfter/fallback_when_resets_at_is_past (0.00s)
    --- PASS: TestParseCodexRetryAfter/non-429_status_code (0.00s)
    --- PASS: TestParseCodexRetryAfter/non_usage_limit_reached_error_type (0.00s)
=== RUN   TestGitHubCopilotNormalizeModel_StripsSuffix
=== PAUSE TestGitHubCopilotNormalizeModel_StripsSuffix
=== RUN   TestUseGitHubCopilotResponsesEndpoint_OpenAIResponseSource
=== PAUSE TestUseGitHubCopilotResponsesEndpoint_OpenAIResponseSource
=== RUN   TestUseGitHubCopilotResponsesEndpoint_CodexModel
=== PAUSE TestUseGitHubCopilotResponsesEndpoint_CodexModel
=== RUN   TestUseGitHubCopilotResponsesEndpoint_DefaultChat
=== PAUSE TestUseGitHubCopilotResponsesEndpoint_DefaultChat
=== RUN   TestNormalizeGitHubCopilotChatTools_KeepFunctionOnly
=== PAUSE TestNormalizeGitHubCopilotChatTools_KeepFunctionOnly
=== RUN   TestNormalizeGitHubCopilotChatTools_InvalidToolChoiceDowngradeToAuto
=== PAUSE TestNormalizeGitHubCopilotChatTools_InvalidToolChoiceDowngradeToAuto
=== RUN   TestNormalizeGitHubCopilotResponsesInput_MissingInputExtractedFromSystemAndMessages
=== PAUSE TestNormalizeGitHubCopilotResponsesInput_MissingInputExtractedFromSystemAndMessages
=== RUN   TestNormalizeGitHubCopilotResponsesInput_NonStringInputStringified
=== PAUSE TestNormalizeGitHubCopilotResponsesInput_NonStringInputStringified
=== RUN   TestNormalizeGitHubCopilotResponsesTools_FlattenFunctionTools
=== PAUSE TestNormalizeGitHubCopilotResponsesTools_FlattenFunctionTools
=== RUN   TestNormalizeGitHubCopilotResponsesTools_ClaudeFormatTools
=== PAUSE TestNormalizeGitHubCopilotResponsesTools_ClaudeFormatTools
=== RUN   TestNormalizeGitHubCopilotResponsesTools_FlattenToolChoiceFunctionObject
=== PAUSE TestNormalizeGitHubCopilotResponsesTools_FlattenToolChoiceFunctionObject
=== RUN   TestNormalizeGitHubCopilotResponsesTools_InvalidToolChoiceDowngradeToAuto
=== PAUSE TestNormalizeGitHubCopilotResponsesTools_InvalidToolChoiceDowngradeToAuto
=== RUN   TestTranslateGitHubCopilotResponsesNonStreamToClaude_TextMapping
=== PAUSE TestTranslateGitHubCopilotResponsesNonStreamToClaude_TextMapping
=== RUN   TestTranslateGitHubCopilotResponsesNonStreamToClaude_ToolUseMapping
=== PAUSE TestTranslateGitHubCopilotResponsesNonStreamToClaude_ToolUseMapping
=== RUN   TestTranslateGitHubCopilotResponsesStreamToClaude_TextLifecycle
=== PAUSE TestTranslateGitHubCopilotResponsesStreamToClaude_TextLifecycle
=== RUN   TestApplyHeaders_XInitiator_UserOnly
=== PAUSE TestApplyHeaders_XInitiator_UserOnly
=== RUN   TestApplyHeaders_XInitiator_AgentWithAssistantAndUserToolResult
=== PAUSE TestApplyHeaders_XInitiator_AgentWithAssistantAndUserToolResult
=== RUN   TestApplyHeaders_XInitiator_AgentWithToolRole
=== PAUSE TestApplyHeaders_XInitiator_AgentWithToolRole
=== RUN   TestApplyHeaders_GitHubAPIVersion
=== PAUSE TestApplyHeaders_GitHubAPIVersion
=== RUN   TestDetectVisionContent_WithImageURL
=== PAUSE TestDetectVisionContent_WithImageURL
=== RUN   TestDetectVisionContent_WithImageType
=== PAUSE TestDetectVisionContent_WithImageType
=== RUN   TestDetectVisionContent_NoVision
=== PAUSE TestDetectVisionContent_NoVision
=== RUN   TestDetectVisionContent_NoMessages
=== PAUSE TestDetectVisionContent_NoMessages
=== RUN   TestIFlowExecutorParseSuffix
=== RUN   TestIFlowExecutorParseSuffix/no_suffix
=== RUN   TestIFlowExecutorParseSuffix/glm_with_suffix
=== RUN   TestIFlowExecutorParseSuffix/minimax_no_suffix
=== RUN   TestIFlowExecutorParseSuffix/minimax_with_suffix
--- PASS: TestIFlowExecutorParseSuffix (0.00s)
    --- PASS: TestIFlowExecutorParseSuffix/no_suffix (0.00s)
    --- PASS: TestIFlowExecutorParseSuffix/glm_with_suffix (0.00s)
    --- PASS: TestIFlowExecutorParseSuffix/minimax_no_suffix (0.00s)
    --- PASS: TestIFlowExecutorParseSuffix/minimax_with_suffix (0.00s)
=== RUN   TestPreserveReasoningContentInMessages
=== RUN   TestPreserveReasoningContentInMessages/non-glm_model_passthrough
=== RUN   TestPreserveReasoningContentInMessages/glm_model_with_empty_messages
=== RUN   TestPreserveReasoningContentInMessages/glm_model_preserves_existing_reasoning_content
--- PASS: TestPreserveReasoningContentInMessages (0.00s)
    --- PASS: TestPreserveReasoningContentInMessages/non-glm_model_passthrough (0.00s)
    --- PASS: TestPreserveReasoningContentInMessages/glm_model_with_empty_messages (0.00s)
    --- PASS: TestPreserveReasoningContentInMessages/glm_model_preserves_existing_reasoning_content (0.00s)
=== RUN   TestNormalizeKimiToolMessageLinks_UsesCallIDFallback
--- PASS: TestNormalizeKimiToolMessageLinks_UsesCallIDFallback (0.00s)
=== RUN   TestNormalizeKimiToolMessageLinks_InferSinglePendingID
--- PASS: TestNormalizeKimiToolMessageLinks_InferSinglePendingID (0.00s)
=== RUN   TestNormalizeKimiToolMessageLinks_AmbiguousMissingIDIsNotInferred
time="2026-02-28T16:18:55+03:00" level=warning msg="kimi executor: tool messages missing tool_call_id with ambiguous candidates" ambiguous_tool_messages=1 pending_tool_calls=2
--- PASS: TestNormalizeKimiToolMessageLinks_AmbiguousMissingIDIsNotInferred (0.00s)
=== RUN   TestNormalizeKimiToolMessageLinks_PreservesExistingToolCallID
--- PASS: TestNormalizeKimiToolMessageLinks_PreservesExistingToolCallID (0.00s)
=== RUN   TestNormalizeKimiToolMessageLinks_InheritsPreviousReasoningForAssistantToolCalls
--- PASS: TestNormalizeKimiToolMessageLinks_InheritsPreviousReasoningForAssistantToolCalls (0.00s)
=== RUN   TestNormalizeKimiToolMessageLinks_InsertsFallbackReasoningWhenMissing
--- PASS: TestNormalizeKimiToolMessageLinks_InsertsFallbackReasoningWhenMissing (0.00s)
=== RUN   TestNormalizeKimiToolMessageLinks_UsesContentAsReasoningFallback
--- PASS: TestNormalizeKimiToolMessageLinks_UsesContentAsReasoningFallback (0.00s)
=== RUN   TestNormalizeKimiToolMessageLinks_ReplacesEmptyReasoningContent
--- PASS: TestNormalizeKimiToolMessageLinks_ReplacesEmptyReasoningContent (0.00s)
=== RUN   TestNormalizeKimiToolMessageLinks_PreservesExistingAssistantReasoning
--- PASS: TestNormalizeKimiToolMessageLinks_PreservesExistingAssistantReasoning (0.00s)
=== RUN   TestNormalizeKimiToolMessageLinks_RepairsIDsAndReasoningTogether
--- PASS: TestNormalizeKimiToolMessageLinks_RepairsIDsAndReasoningTogether (0.00s)
=== RUN   TestBuildKiroEndpointConfigs
=== RUN   TestBuildKiroEndpointConfigs/Empty_region_-_defaults_to_us-east-1
=== RUN   TestBuildKiroEndpointConfigs/us-east-1
=== RUN   TestBuildKiroEndpointConfigs/ap-southeast-1
=== RUN   TestBuildKiroEndpointConfigs/eu-west-1
--- PASS: TestBuildKiroEndpointConfigs (0.00s)
    --- PASS: TestBuildKiroEndpointConfigs/Empty_region_-_defaults_to_us-east-1 (0.00s)
    --- PASS: TestBuildKiroEndpointConfigs/us-east-1 (0.00s)
    --- PASS: TestBuildKiroEndpointConfigs/ap-southeast-1 (0.00s)
    --- PASS: TestBuildKiroEndpointConfigs/eu-west-1 (0.00s)
=== RUN   TestGetKiroEndpointConfigs_NilAuth
--- PASS: TestGetKiroEndpointConfigs_NilAuth (0.00s)
=== RUN   TestGetKiroEndpointConfigs_WithRegionFromProfileArn
--- PASS: TestGetKiroEndpointConfigs_WithRegionFromProfileArn (0.00s)
=== RUN   TestGetKiroEndpointConfigs_WithApiRegionOverride
--- PASS: TestGetKiroEndpointConfigs_WithApiRegionOverride (0.00s)
=== RUN   TestGetKiroEndpointConfigs_PreferredEndpoint
=== RUN   TestGetKiroEndpointConfigs_PreferredEndpoint/Prefer_codewhisperer
=== RUN   TestGetKiroEndpointConfigs_PreferredEndpoint/Prefer_ide_(alias_for_codewhisperer)
=== RUN   TestGetKiroEndpointConfigs_PreferredEndpoint/Prefer_amazonq
=== RUN   TestGetKiroEndpointConfigs_PreferredEndpoint/Prefer_q_(alias_for_amazonq)
=== RUN   TestGetKiroEndpointConfigs_PreferredEndpoint/Prefer_cli_(alias_for_amazonq)
=== RUN   TestGetKiroEndpointConfigs_PreferredEndpoint/Unknown_preference_-_no_reordering
=== RUN   TestGetKiroEndpointConfigs_PreferredEndpoint/Empty_preference_-_no_reordering
--- PASS: TestGetKiroEndpointConfigs_PreferredEndpoint (0.00s)
    --- PASS: TestGetKiroEndpointConfigs_PreferredEndpoint/Prefer_codewhisperer (0.00s)
    --- PASS: TestGetKiroEndpointConfigs_PreferredEndpoint/Prefer_ide_(alias_for_codewhisperer) (0.00s)
    --- PASS: TestGetKiroEndpointConfigs_PreferredEndpoint/Prefer_amazonq (0.00s)
    --- PASS: TestGetKiroEndpointConfigs_PreferredEndpoint/Prefer_q_(alias_for_amazonq) (0.00s)
    --- PASS: TestGetKiroEndpointConfigs_PreferredEndpoint/Prefer_cli_(alias_for_amazonq) (0.00s)
    --- PASS: TestGetKiroEndpointConfigs_PreferredEndpoint/Unknown_preference_-_no_reordering (0.00s)
    --- PASS: TestGetKiroEndpointConfigs_PreferredEndpoint/Empty_preference_-_no_reordering (0.00s)
=== RUN   TestGetKiroEndpointConfigs_PreferredEndpointFromAttributes
--- PASS: TestGetKiroEndpointConfigs_PreferredEndpointFromAttributes (0.00s)
=== RUN   TestGetKiroEndpointConfigs_MetadataTakesPrecedenceOverAttributes
--- PASS: TestGetKiroEndpointConfigs_MetadataTakesPrecedenceOverAttributes (0.00s)
=== RUN   TestGetAuthValue
=== RUN   TestGetAuthValue/From_metadata
=== RUN   TestGetAuthValue/From_attributes_(fallback)
=== RUN   TestGetAuthValue/Metadata_takes_precedence
=== RUN   TestGetAuthValue/Key_not_found
=== RUN   TestGetAuthValue/Nil_metadata
=== RUN   TestGetAuthValue/Both_nil
=== RUN   TestGetAuthValue/Value_is_trimmed_and_lowercased
=== RUN   TestGetAuthValue/Empty_string_value_in_metadata_-_falls_back_to_attributes
=== RUN   TestGetAuthValue/Non-string_value_in_metadata_-_falls_back_to_attributes
--- PASS: TestGetAuthValue (0.00s)
    --- PASS: TestGetAuthValue/From_metadata (0.00s)
    --- PASS: TestGetAuthValue/From_attributes_(fallback) (0.00s)
    --- PASS: TestGetAuthValue/Metadata_takes_precedence (0.00s)
    --- PASS: TestGetAuthValue/Key_not_found (0.00s)
    --- PASS: TestGetAuthValue/Nil_metadata (0.00s)
    --- PASS: TestGetAuthValue/Both_nil (0.00s)
    --- PASS: TestGetAuthValue/Value_is_trimmed_and_lowercased (0.00s)
    --- PASS: TestGetAuthValue/Empty_string_value_in_metadata_-_falls_back_to_attributes (0.00s)
    --- PASS: TestGetAuthValue/Non-string_value_in_metadata_-_falls_back_to_attributes (0.00s)
=== RUN   TestGetAccountKey
=== RUN   TestGetAccountKey/From_client_id
=== RUN   TestGetAccountKey/From_refresh_token_only
=== RUN   TestGetAccountKey/Nil_auth
=== RUN   TestGetAccountKey/Nil_metadata
=== RUN   TestGetAccountKey/Empty_metadata
--- PASS: TestGetAccountKey (0.00s)
    --- PASS: TestGetAccountKey/From_client_id (0.00s)
    --- PASS: TestGetAccountKey/From_refresh_token_only (0.00s)
    --- PASS: TestGetAccountKey/Nil_auth (0.00s)
    --- PASS: TestGetAccountKey/Nil_metadata (0.00s)
    --- PASS: TestGetAccountKey/Empty_metadata (0.00s)
=== RUN   TestEndpointAliases
--- PASS: TestEndpointAliases (0.00s)
=== RUN   TestOpenAICompatExecutorCompactPassthrough
--- PASS: TestOpenAICompatExecutorCompactPassthrough (0.00s)
=== RUN   TestQwenExecutorParseSuffix
=== RUN   TestQwenExecutorParseSuffix/no_suffix
=== RUN   TestQwenExecutorParseSuffix/with_level_suffix
=== RUN   TestQwenExecutorParseSuffix/with_budget_suffix
=== RUN   TestQwenExecutorParseSuffix/complex_model_name
--- PASS: TestQwenExecutorParseSuffix (0.00s)
    --- PASS: TestQwenExecutorParseSuffix/no_suffix (0.00s)
    --- PASS: TestQwenExecutorParseSuffix/with_level_suffix (0.00s)
    --- PASS: TestQwenExecutorParseSuffix/with_budget_suffix (0.00s)
    --- PASS: TestQwenExecutorParseSuffix/complex_model_name (0.00s)
=== RUN   TestParseOpenAIUsageChatCompletions
--- PASS: TestParseOpenAIUsageChatCompletions (0.00s)
=== RUN   TestParseOpenAIUsageResponses
--- PASS: TestParseOpenAIUsageResponses (0.00s)
=== RUN   TestCachedUserID_ReusesWithinTTL
--- PASS: TestCachedUserID_ReusesWithinTTL (0.00s)
=== RUN   TestCachedUserID_ExpiresAfterTTL
--- PASS: TestCachedUserID_ExpiresAfterTTL (0.00s)
=== RUN   TestCachedUserID_IsScopedByAPIKey
--- PASS: TestCachedUserID_IsScopedByAPIKey (0.00s)
=== RUN   TestCachedUserID_RenewsTTLOnHit
--- PASS: TestCachedUserID_RenewsTTLOnHit (0.00s)
=== CONT  TestGitHubCopilotNormalizeModel_StripsSuffix
=== RUN   TestGitHubCopilotNormalizeModel_StripsSuffix/suffix_stripped
=== PAUSE TestGitHubCopilotNormalizeModel_StripsSuffix/suffix_stripped
=== RUN   TestGitHubCopilotNormalizeModel_StripsSuffix/no_suffix_unchanged
=== PAUSE TestGitHubCopilotNormalizeModel_StripsSuffix/no_suffix_unchanged
=== RUN   TestGitHubCopilotNormalizeModel_StripsSuffix/different_suffix_stripped
=== CONT  TestDetectVisionContent_NoMessages
--- PASS: TestDetectVisionContent_NoMessages (0.00s)
=== CONT  TestNormalizeGitHubCopilotResponsesInput_MissingInputExtractedFromSystemAndMessages
=== PAUSE TestGitHubCopilotNormalizeModel_StripsSuffix/different_suffix_stripped
=== RUN   TestGitHubCopilotNormalizeModel_StripsSuffix/numeric_suffix_stripped
=== PAUSE TestGitHubCopilotNormalizeModel_StripsSuffix/numeric_suffix_stripped
=== CONT  TestNormalizeGitHubCopilotResponsesTools_InvalidToolChoiceDowngradeToAuto
=== CONT  TestNormalizeGitHubCopilotChatTools_InvalidToolChoiceDowngradeToAuto
--- PASS: TestNormalizeGitHubCopilotChatTools_InvalidToolChoiceDowngradeToAuto (0.00s)
=== CONT  TestNormalizeGitHubCopilotChatTools_KeepFunctionOnly
--- PASS: TestNormalizeGitHubCopilotChatTools_KeepFunctionOnly (0.00s)
=== CONT  TestUseGitHubCopilotResponsesEndpoint_DefaultChat
--- PASS: TestUseGitHubCopilotResponsesEndpoint_DefaultChat (0.00s)
=== CONT  TestUseGitHubCopilotResponsesEndpoint_CodexModel
--- PASS: TestUseGitHubCopilotResponsesEndpoint_CodexModel (0.00s)
=== CONT  TestUseGitHubCopilotResponsesEndpoint_OpenAIResponseSource
--- PASS: TestUseGitHubCopilotResponsesEndpoint_OpenAIResponseSource (0.00s)
=== CONT  TestApplyHeaders_XInitiator_AgentWithToolRole
--- PASS: TestApplyHeaders_XInitiator_AgentWithToolRole (0.00s)
=== CONT  TestDetectVisionContent_NoVision
--- PASS: TestDetectVisionContent_NoVision (0.00s)
=== CONT  TestDetectVisionContent_WithImageType
--- PASS: TestDetectVisionContent_WithImageType (0.00s)
=== CONT  TestDetectVisionContent_WithImageURL
--- PASS: TestDetectVisionContent_WithImageURL (0.00s)
=== CONT  TestApplyHeaders_GitHubAPIVersion
--- PASS: TestApplyHeaders_GitHubAPIVersion (0.00s)
=== CONT  TestApplyHeaders_XInitiator_UserOnly
--- PASS: TestApplyHeaders_XInitiator_UserOnly (0.00s)
=== CONT  TestApplyHeaders_XInitiator_AgentWithAssistantAndUserToolResult
--- PASS: TestApplyHeaders_XInitiator_AgentWithAssistantAndUserToolResult (0.00s)
=== CONT  TestTranslateGitHubCopilotResponsesStreamToClaude_TextLifecycle
--- PASS: TestTranslateGitHubCopilotResponsesStreamToClaude_TextLifecycle (0.00s)
=== CONT  TestTranslateGitHubCopilotResponsesNonStreamToClaude_ToolUseMapping
--- PASS: TestTranslateGitHubCopilotResponsesNonStreamToClaude_ToolUseMapping (0.00s)
=== CONT  TestGitHubCopilotNormalizeModel_StripsSuffix/suffix_stripped
=== CONT  TestGitHubCopilotNormalizeModel_StripsSuffix/numeric_suffix_stripped
=== CONT  TestGitHubCopilotNormalizeModel_StripsSuffix/different_suffix_stripped
=== CONT  TestGitHubCopilotNormalizeModel_StripsSuffix/no_suffix_unchanged
--- PASS: TestGitHubCopilotNormalizeModel_StripsSuffix (0.00s)
    --- PASS: TestGitHubCopilotNormalizeModel_StripsSuffix/suffix_stripped (0.00s)
    --- PASS: TestGitHubCopilotNormalizeModel_StripsSuffix/numeric_suffix_stripped (0.00s)
    --- PASS: TestGitHubCopilotNormalizeModel_StripsSuffix/different_suffix_stripped (0.00s)
    --- PASS: TestGitHubCopilotNormalizeModel_StripsSuffix/no_suffix_unchanged (0.00s)
=== CONT  TestNormalizeGitHubCopilotResponsesTools_FlattenToolChoiceFunctionObject
--- PASS: TestNormalizeGitHubCopilotResponsesTools_FlattenToolChoiceFunctionObject (0.00s)
=== CONT  TestNormalizeGitHubCopilotResponsesTools_ClaudeFormatTools
--- PASS: TestNormalizeGitHubCopilotResponsesTools_ClaudeFormatTools (0.00s)
=== CONT  TestNormalizeGitHubCopilotResponsesTools_FlattenFunctionTools
--- PASS: TestNormalizeGitHubCopilotResponsesTools_FlattenFunctionTools (0.00s)
=== CONT  TestNormalizeGitHubCopilotResponsesInput_NonStringInputStringified
--- PASS: TestNormalizeGitHubCopilotResponsesInput_NonStringInputStringified (0.00s)
=== CONT  TestTranslateGitHubCopilotResponsesNonStreamToClaude_TextMapping
--- PASS: TestTranslateGitHubCopilotResponsesNonStreamToClaude_TextMapping (0.00s)
--- PASS: TestNormalizeGitHubCopilotResponsesTools_InvalidToolChoiceDowngradeToAuto (0.00s)
--- PASS: TestNormalizeGitHubCopilotResponsesInput_MissingInputExtractedFromSystemAndMessages (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/runtime/executor	0.926s
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/runtime/geminicli	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/store	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/thinking	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/thinking/provider/antigravity	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/thinking/provider/claude	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/thinking/provider/codex	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/thinking/provider/gemini	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/thinking/provider/geminicli	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/thinking/provider/iflow	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/thinking/provider/kimi	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/thinking/provider/openai	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator	[no test files]
=== RUN   TestConvertClaudeRequestToAntigravity_BasicStructure
--- PASS: TestConvertClaudeRequestToAntigravity_BasicStructure (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_RoleMapping
--- PASS: TestConvertClaudeRequestToAntigravity_RoleMapping (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ThinkingBlocks
--- PASS: TestConvertClaudeRequestToAntigravity_ThinkingBlocks (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ThinkingBlockWithoutSignature
--- PASS: TestConvertClaudeRequestToAntigravity_ThinkingBlockWithoutSignature (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolDeclarations
    antigravity_claude_request_test.go:189: parametersJsonSchema exists (expected)
--- PASS: TestConvertClaudeRequestToAntigravity_ToolDeclarations (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolUse
--- PASS: TestConvertClaudeRequestToAntigravity_ToolUse (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolUse_WithSignature
--- PASS: TestConvertClaudeRequestToAntigravity_ToolUse_WithSignature (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ReorderThinking
--- PASS: TestConvertClaudeRequestToAntigravity_ReorderThinking (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolResult
--- PASS: TestConvertClaudeRequestToAntigravity_ToolResult (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ThinkingConfig
--- PASS: TestConvertClaudeRequestToAntigravity_ThinkingConfig (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ImageContent
--- PASS: TestConvertClaudeRequestToAntigravity_ImageContent (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_GenerationConfig
--- PASS: TestConvertClaudeRequestToAntigravity_GenerationConfig (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_TrailingUnsignedThinking_Removed
--- PASS: TestConvertClaudeRequestToAntigravity_TrailingUnsignedThinking_Removed (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_TrailingSignedThinking_Kept
--- PASS: TestConvertClaudeRequestToAntigravity_TrailingSignedThinking_Kept (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_MiddleUnsignedThinking_Removed
--- PASS: TestConvertClaudeRequestToAntigravity_MiddleUnsignedThinking_Removed (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolAndThinking_HintInjected
--- PASS: TestConvertClaudeRequestToAntigravity_ToolAndThinking_HintInjected (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolsOnly_NoHint
--- PASS: TestConvertClaudeRequestToAntigravity_ToolsOnly_NoHint (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ThinkingOnly_NoHint
--- PASS: TestConvertClaudeRequestToAntigravity_ThinkingOnly_NoHint (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolResultNoContent
--- PASS: TestConvertClaudeRequestToAntigravity_ToolResultNoContent (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolResultNullContent
--- PASS: TestConvertClaudeRequestToAntigravity_ToolResultNullContent (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolResultWithImage
--- PASS: TestConvertClaudeRequestToAntigravity_ToolResultWithImage (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolResultWithSingleImage
--- PASS: TestConvertClaudeRequestToAntigravity_ToolResultWithSingleImage (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolResultWithMultipleImagesAndTexts
--- PASS: TestConvertClaudeRequestToAntigravity_ToolResultWithMultipleImagesAndTexts (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolResultWithOnlyMultipleImages
--- PASS: TestConvertClaudeRequestToAntigravity_ToolResultWithOnlyMultipleImages (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolResultImageNotBase64
--- PASS: TestConvertClaudeRequestToAntigravity_ToolResultImageNotBase64 (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolResultImageMissingData
--- PASS: TestConvertClaudeRequestToAntigravity_ToolResultImageMissingData (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolResultImageMissingMediaType
--- PASS: TestConvertClaudeRequestToAntigravity_ToolResultImageMissingMediaType (0.00s)
=== RUN   TestConvertClaudeRequestToAntigravity_ToolAndThinking_NoExistingSystem
--- PASS: TestConvertClaudeRequestToAntigravity_ToolAndThinking_NoExistingSystem (0.00s)
=== RUN   TestConvertAntigravityResponseToClaude_ParamsInitialized
--- PASS: TestConvertAntigravityResponseToClaude_ParamsInitialized (0.00s)
=== RUN   TestConvertAntigravityResponseToClaude_ThinkingTextAccumulated
--- PASS: TestConvertAntigravityResponseToClaude_ThinkingTextAccumulated (0.00s)
=== RUN   TestConvertAntigravityResponseToClaude_SignatureCached
--- PASS: TestConvertAntigravityResponseToClaude_SignatureCached (0.00s)
=== RUN   TestConvertAntigravityResponseToClaude_MultipleThinkingBlocks
--- PASS: TestConvertAntigravityResponseToClaude_MultipleThinkingBlocks (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/antigravity/claude	0.888s
=== RUN   TestConvertGeminiRequestToAntigravity_PreserveValidSignature
--- PASS: TestConvertGeminiRequestToAntigravity_PreserveValidSignature (0.00s)
=== RUN   TestConvertGeminiRequestToAntigravity_AddSkipSentinelToFunctionCall
--- PASS: TestConvertGeminiRequestToAntigravity_AddSkipSentinelToFunctionCall (0.00s)
=== RUN   TestConvertGeminiRequestToAntigravity_ParallelFunctionCalls
--- PASS: TestConvertGeminiRequestToAntigravity_ParallelFunctionCalls (0.00s)
=== RUN   TestFixCLIToolResponse_PreservesFunctionResponseParts
--- PASS: TestFixCLIToolResponse_PreservesFunctionResponseParts (0.00s)
=== RUN   TestRestoreUsageMetadata
=== RUN   TestRestoreUsageMetadata/cpaUsageMetadata_renamed_to_usageMetadata
=== RUN   TestRestoreUsageMetadata/no_cpaUsageMetadata_unchanged
=== RUN   TestRestoreUsageMetadata/empty_input
--- PASS: TestRestoreUsageMetadata (0.00s)
    --- PASS: TestRestoreUsageMetadata/cpaUsageMetadata_renamed_to_usageMetadata (0.00s)
    --- PASS: TestRestoreUsageMetadata/no_cpaUsageMetadata_unchanged (0.00s)
    --- PASS: TestRestoreUsageMetadata/empty_input (0.00s)
=== RUN   TestConvertAntigravityResponseToGeminiNonStream
=== RUN   TestConvertAntigravityResponseToGeminiNonStream/cpaUsageMetadata_restored_in_response
=== RUN   TestConvertAntigravityResponseToGeminiNonStream/usageMetadata_preserved
--- PASS: TestConvertAntigravityResponseToGeminiNonStream (0.00s)
    --- PASS: TestConvertAntigravityResponseToGeminiNonStream/cpaUsageMetadata_restored_in_response (0.00s)
    --- PASS: TestConvertAntigravityResponseToGeminiNonStream/usageMetadata_preserved (0.00s)
=== RUN   TestConvertAntigravityResponseToGeminiStream
=== RUN   TestConvertAntigravityResponseToGeminiStream/cpaUsageMetadata_restored_in_streaming_response
--- PASS: TestConvertAntigravityResponseToGeminiStream (0.00s)
    --- PASS: TestConvertAntigravityResponseToGeminiStream/cpaUsageMetadata_restored_in_streaming_response (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/antigravity/gemini	1.111s
=== RUN   TestFinishReasonToolCallsNotOverwritten
--- PASS: TestFinishReasonToolCallsNotOverwritten (0.00s)
=== RUN   TestFinishReasonStopForNormalText
--- PASS: TestFinishReasonStopForNormalText (0.00s)
=== RUN   TestFinishReasonMaxTokens
--- PASS: TestFinishReasonMaxTokens (0.00s)
=== RUN   TestToolCallTakesPriorityOverMaxTokens
--- PASS: TestToolCallTakesPriorityOverMaxTokens (0.00s)
=== RUN   TestNoFinishReasonOnIntermediateChunks
--- PASS: TestNoFinishReasonOnIntermediateChunks (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/antigravity/openai/chat-completions	1.307s
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/antigravity/openai/responses	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/claude/gemini	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/claude/gemini-cli	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/claude/openai/chat-completions	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/claude/openai/responses	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/codex/claude	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/codex/gemini	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/codex/gemini-cli	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/codex/openai/chat-completions	[no test files]
=== RUN   TestConvertSystemRoleToDeveloper_BasicConversion
--- PASS: TestConvertSystemRoleToDeveloper_BasicConversion (0.00s)
=== RUN   TestConvertSystemRoleToDeveloper_MultipleSystemMessages
--- PASS: TestConvertSystemRoleToDeveloper_MultipleSystemMessages (0.00s)
=== RUN   TestConvertSystemRoleToDeveloper_NoSystemMessages
--- PASS: TestConvertSystemRoleToDeveloper_NoSystemMessages (0.00s)
=== RUN   TestConvertSystemRoleToDeveloper_EmptyInput
--- PASS: TestConvertSystemRoleToDeveloper_EmptyInput (0.00s)
=== RUN   TestConvertSystemRoleToDeveloper_NoInputField
--- PASS: TestConvertSystemRoleToDeveloper_NoInputField (0.00s)
=== RUN   TestConvertOpenAIResponsesRequestToCodex_OriginalIssue
--- PASS: TestConvertOpenAIResponsesRequestToCodex_OriginalIssue (0.00s)
=== RUN   TestConvertSystemRoleToDeveloper_AssistantRole
--- PASS: TestConvertSystemRoleToDeveloper_AssistantRole (0.00s)
=== RUN   TestUserFieldDeletion
--- PASS: TestUserFieldDeletion (0.00s)
=== RUN   TestContextManagementCompactionCompatibility
--- PASS: TestContextManagementCompactionCompatibility (0.00s)
=== RUN   TestTruncationRemovedForCodexCompatibility
--- PASS: TestTruncationRemovedForCodexCompatibility (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/codex/openai/responses	1.364s
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/gemini/claude	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/gemini/common	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/gemini/gemini	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/gemini/gemini-cli	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/gemini/openai/chat-completions	[no test files]
=== RUN   TestConvertGeminiResponseToOpenAIResponses_UnwrapAndAggregateText
--- PASS: TestConvertGeminiResponseToOpenAIResponses_UnwrapAndAggregateText (0.00s)
=== RUN   TestConvertGeminiResponseToOpenAIResponses_ReasoningEncryptedContent
--- PASS: TestConvertGeminiResponseToOpenAIResponses_ReasoningEncryptedContent (0.00s)
=== RUN   TestConvertGeminiResponseToOpenAIResponses_FunctionCallEventOrder
--- PASS: TestConvertGeminiResponseToOpenAIResponses_FunctionCallEventOrder (0.00s)
=== RUN   TestConvertGeminiResponseToOpenAIResponses_ResponseOutputOrdering
--- PASS: TestConvertGeminiResponseToOpenAIResponses_ResponseOutputOrdering (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/gemini/openai/responses	1.436s
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/gemini-cli/claude	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/gemini-cli/gemini	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/gemini-cli/openai/chat-completions	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/gemini-cli/openai/responses	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/kiro/claude	[no test files]
=== RUN   TestMergeAdjacentMessages_AssistantMergesCombinesContent
--- PASS: TestMergeAdjacentMessages_AssistantMergesCombinesContent (0.00s)
=== RUN   TestMergeAdjacentMessages_MultipleAssistantsResultInOne
--- PASS: TestMergeAdjacentMessages_MultipleAssistantsResultInOne (0.00s)
=== RUN   TestMergeAdjacentMessages_ToolMessagesRemainUnmerged
--- PASS: TestMergeAdjacentMessages_ToolMessagesRemainUnmerged (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/kiro/common	1.540s
=== RUN   TestToolResultsAttachedToCurrentMessage
    kiro_openai_request_test.go:51: History count: 2
--- PASS: TestToolResultsAttachedToCurrentMessage (0.00s)
=== RUN   TestToolResultsInHistoryUserMessage
    kiro_openai_request_test.go:118: History count: 4
    kiro_openai_request_test.go:124: History[0]: user message content="Hello"
    kiro_openai_request_test.go:137: History[1]: assistant message content="I'll read the file."
    kiro_openai_request_test.go:124: History[2]: user message content="Thanks for the file"
    kiro_openai_request_test.go:128:   Found 1 tool results
    kiro_openai_request_test.go:137: History[3]: assistant message content="You're welcome"
--- PASS: TestToolResultsInHistoryUserMessage (0.00s)
=== RUN   TestToolResultsWithMultipleToolCalls
    kiro_openai_request_test.go:195: History count: 2
    kiro_openai_request_test.go:196: CurrentMessage content: "--- SYSTEM PROMPT ---\n[Context: Current time is 2026-02-28 16:18:57 +03]\n--- END SYSTEM PROMPT ---\n\nWhat do they say?"
    kiro_openai_request_test.go:210: CurrentMessage has 2 tool results
--- PASS: TestToolResultsWithMultipleToolCalls (0.00s)
=== RUN   TestToolResultsAtEndOfConversation
--- PASS: TestToolResultsAtEndOfConversation (0.00s)
=== RUN   TestToolResultsFollowedByAssistant
    kiro_openai_request_test.go:333: History count: 4
    kiro_openai_request_test.go:339: History[0]: user message content="Read two files for me"
    kiro_openai_request_test.go:347: History[1]: assistant message content="I'll read both files."
    kiro_openai_request_test.go:339: History[2]: user message content="Tool results provided."
    kiro_openai_request_test.go:342:   Has 2 tool results
    kiro_openai_request_test.go:347: History[3]: assistant message content="I've read both files."
--- PASS: TestToolResultsFollowedByAssistant (0.00s)
=== RUN   TestAssistantEndsConversation
--- PASS: TestAssistantEndsConversation (0.00s)
=== RUN   TestFilterOrphanedToolResults_RemovesHistoryAndCurrentOrphans
time="2026-02-28T16:18:57+03:00" level=info msg="kiro-openai: dropped 1 orphaned tool_result(s) from currentMessage"
--- PASS: TestFilterOrphanedToolResults_RemovesHistoryAndCurrentOrphans (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/kiro/openai	1.547s
=== RUN   TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent
=== RUN   TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/AC1:_assistant_message_with_thinking_and_text
=== RUN   TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/AC2:_redacted_thinking_must_be_ignored
=== RUN   TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/AC3:_thinking-only_message_preserved_with_reasoning_content
=== RUN   TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/AC4:_thinking_in_user_role_must_be_ignored
=== RUN   TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/AC4:_thinking_in_system_role_must_be_ignored
=== RUN   TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/AC5:_empty_thinking_must_be_ignored
=== RUN   TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/AC5:_whitespace-only_thinking_must_be_ignored
=== RUN   TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/Multiple_thinking_parts_concatenated
=== RUN   TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/Mixed_thinking_and_redacted_thinking
--- PASS: TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent (0.00s)
    --- PASS: TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/AC1:_assistant_message_with_thinking_and_text (0.00s)
    --- PASS: TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/AC2:_redacted_thinking_must_be_ignored (0.00s)
    --- PASS: TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/AC3:_thinking-only_message_preserved_with_reasoning_content (0.00s)
    --- PASS: TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/AC4:_thinking_in_user_role_must_be_ignored (0.00s)
    --- PASS: TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/AC4:_thinking_in_system_role_must_be_ignored (0.00s)
    --- PASS: TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/AC5:_empty_thinking_must_be_ignored (0.00s)
    --- PASS: TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/AC5:_whitespace-only_thinking_must_be_ignored (0.00s)
    --- PASS: TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/Multiple_thinking_parts_concatenated (0.00s)
    --- PASS: TestConvertClaudeRequestToOpenAI_ThinkingToReasoningContent/Mixed_thinking_and_redacted_thinking (0.00s)
=== RUN   TestConvertClaudeRequestToOpenAI_ThinkingOnlyMessagePreserved
--- PASS: TestConvertClaudeRequestToOpenAI_ThinkingOnlyMessagePreserved (0.00s)
=== RUN   TestConvertClaudeRequestToOpenAI_SystemMessageScenarios
=== RUN   TestConvertClaudeRequestToOpenAI_SystemMessageScenarios/No_system_field
=== RUN   TestConvertClaudeRequestToOpenAI_SystemMessageScenarios/Empty_string_system_field
=== RUN   TestConvertClaudeRequestToOpenAI_SystemMessageScenarios/String_system_field
=== RUN   TestConvertClaudeRequestToOpenAI_SystemMessageScenarios/Array_system_field_with_text
=== RUN   TestConvertClaudeRequestToOpenAI_SystemMessageScenarios/Array_system_field_with_multiple_text_blocks
--- PASS: TestConvertClaudeRequestToOpenAI_SystemMessageScenarios (0.00s)
    --- PASS: TestConvertClaudeRequestToOpenAI_SystemMessageScenarios/No_system_field (0.00s)
    --- PASS: TestConvertClaudeRequestToOpenAI_SystemMessageScenarios/Empty_string_system_field (0.00s)
    --- PASS: TestConvertClaudeRequestToOpenAI_SystemMessageScenarios/String_system_field (0.00s)
    --- PASS: TestConvertClaudeRequestToOpenAI_SystemMessageScenarios/Array_system_field_with_text (0.00s)
    --- PASS: TestConvertClaudeRequestToOpenAI_SystemMessageScenarios/Array_system_field_with_multiple_text_blocks (0.00s)
=== RUN   TestConvertClaudeRequestToOpenAI_ToolResultOrderAndContent
--- PASS: TestConvertClaudeRequestToOpenAI_ToolResultOrderAndContent (0.00s)
=== RUN   TestConvertClaudeRequestToOpenAI_ToolResultObjectContent
--- PASS: TestConvertClaudeRequestToOpenAI_ToolResultObjectContent (0.00s)
=== RUN   TestConvertClaudeRequestToOpenAI_AssistantTextToolUseTextOrder
--- PASS: TestConvertClaudeRequestToOpenAI_AssistantTextToolUseTextOrder (0.00s)
=== RUN   TestConvertClaudeRequestToOpenAI_AssistantThinkingToolUseThinkingSplit
--- PASS: TestConvertClaudeRequestToOpenAI_AssistantThinkingToolUseThinkingSplit (0.00s)
=== RUN   TestConvertOpenAIResponseToClaude_StreamToolUseEmitted
--- PASS: TestConvertOpenAIResponseToClaude_StreamToolUseEmitted (0.00s)
=== RUN   TestConvertOpenAIResponseToClaudeNonStream_CanonicalizesToolName
--- PASS: TestConvertOpenAIResponseToClaudeNonStream_CanonicalizesToolName (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/openai/claude	1.551s
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/openai/gemini	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/openai/gemini-cli	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/openai/openai/chat-completions	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/openai/openai/responses	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/translator/translator	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/tui	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/usage	[no test files]
=== RUN   TestIsClaudeThinkingModel
=== RUN   TestIsClaudeThinkingModel/claude-sonnet-4-5-thinking
=== RUN   TestIsClaudeThinkingModel/claude-opus-4-5-thinking
=== RUN   TestIsClaudeThinkingModel/claude-opus-4-6-thinking
=== RUN   TestIsClaudeThinkingModel/Claude-Sonnet-Thinking_uppercase
=== RUN   TestIsClaudeThinkingModel/claude_thinking_mixed_case
=== RUN   TestIsClaudeThinkingModel/claude-sonnet-4-5_(no_thinking)
=== RUN   TestIsClaudeThinkingModel/claude-opus-4-5_(no_thinking)
=== RUN   TestIsClaudeThinkingModel/claude-3-5-sonnet
=== RUN   TestIsClaudeThinkingModel/gemini-3-pro-preview
=== RUN   TestIsClaudeThinkingModel/gemini-thinking_model
=== RUN   TestIsClaudeThinkingModel/gpt-4o
=== RUN   TestIsClaudeThinkingModel/empty_string
=== RUN   TestIsClaudeThinkingModel/thinking_without_claude
=== RUN   TestIsClaudeThinkingModel/claude_without_thinking
--- PASS: TestIsClaudeThinkingModel (0.00s)
    --- PASS: TestIsClaudeThinkingModel/claude-sonnet-4-5-thinking (0.00s)
    --- PASS: TestIsClaudeThinkingModel/claude-opus-4-5-thinking (0.00s)
    --- PASS: TestIsClaudeThinkingModel/claude-opus-4-6-thinking (0.00s)
    --- PASS: TestIsClaudeThinkingModel/Claude-Sonnet-Thinking_uppercase (0.00s)
    --- PASS: TestIsClaudeThinkingModel/claude_thinking_mixed_case (0.00s)
    --- PASS: TestIsClaudeThinkingModel/claude-sonnet-4-5_(no_thinking) (0.00s)
    --- PASS: TestIsClaudeThinkingModel/claude-opus-4-5_(no_thinking) (0.00s)
    --- PASS: TestIsClaudeThinkingModel/claude-3-5-sonnet (0.00s)
    --- PASS: TestIsClaudeThinkingModel/gemini-3-pro-preview (0.00s)
    --- PASS: TestIsClaudeThinkingModel/gemini-thinking_model (0.00s)
    --- PASS: TestIsClaudeThinkingModel/gpt-4o (0.00s)
    --- PASS: TestIsClaudeThinkingModel/empty_string (0.00s)
    --- PASS: TestIsClaudeThinkingModel/thinking_without_claude (0.00s)
    --- PASS: TestIsClaudeThinkingModel/claude_without_thinking (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_ConstToEnum
--- PASS: TestCleanJSONSchemaForAntigravity_ConstToEnum (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_TypeFlattening_Nullable
--- PASS: TestCleanJSONSchemaForAntigravity_TypeFlattening_Nullable (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_ConstraintsToDescription
--- PASS: TestCleanJSONSchemaForAntigravity_ConstraintsToDescription (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_AnyOfFlattening_SmartSelection
--- PASS: TestCleanJSONSchemaForAntigravity_AnyOfFlattening_SmartSelection (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_OneOfFlattening
--- PASS: TestCleanJSONSchemaForAntigravity_OneOfFlattening (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_AllOfMerging
--- PASS: TestCleanJSONSchemaForAntigravity_AllOfMerging (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_RefHandling
--- PASS: TestCleanJSONSchemaForAntigravity_RefHandling (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_RefHandling_DescriptionEscaping
--- PASS: TestCleanJSONSchemaForAntigravity_RefHandling_DescriptionEscaping (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_CyclicRefDefaults
--- PASS: TestCleanJSONSchemaForAntigravity_CyclicRefDefaults (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_RequiredCleanup
--- PASS: TestCleanJSONSchemaForAntigravity_RequiredCleanup (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_AllOfMerging_DotKeys
--- PASS: TestCleanJSONSchemaForAntigravity_AllOfMerging_DotKeys (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_PropertyNameCollision
--- PASS: TestCleanJSONSchemaForAntigravity_PropertyNameCollision (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_DotKeys
--- PASS: TestCleanJSONSchemaForAntigravity_DotKeys (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_AnyOfAlternativeHints
--- PASS: TestCleanJSONSchemaForAntigravity_AnyOfAlternativeHints (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_NullableHint
--- PASS: TestCleanJSONSchemaForAntigravity_NullableHint (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_TypeFlattening_Nullable_DotKey
--- PASS: TestCleanJSONSchemaForAntigravity_TypeFlattening_Nullable_DotKey (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_EnumHint
--- PASS: TestCleanJSONSchemaForAntigravity_EnumHint (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_AdditionalPropertiesHint
--- PASS: TestCleanJSONSchemaForAntigravity_AdditionalPropertiesHint (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_AnyOfFlattening_PreservesDescription
--- PASS: TestCleanJSONSchemaForAntigravity_AnyOfFlattening_PreservesDescription (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_SingleEnumNoHint
--- PASS: TestCleanJSONSchemaForAntigravity_SingleEnumNoHint (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_MultipleNonNullTypes
--- PASS: TestCleanJSONSchemaForAntigravity_MultipleNonNullTypes (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_EmptySchemaPlaceholder
--- PASS: TestCleanJSONSchemaForAntigravity_EmptySchemaPlaceholder (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_EmptyPropertiesPlaceholder
--- PASS: TestCleanJSONSchemaForAntigravity_EmptyPropertiesPlaceholder (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_NonEmptySchemaUnchanged
--- PASS: TestCleanJSONSchemaForAntigravity_NonEmptySchemaUnchanged (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_NestedEmptySchema
--- PASS: TestCleanJSONSchemaForAntigravity_NestedEmptySchema (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_EmptySchemaWithDescription
--- PASS: TestCleanJSONSchemaForAntigravity_EmptySchemaWithDescription (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_FormatFieldRemoval
--- PASS: TestCleanJSONSchemaForAntigravity_FormatFieldRemoval (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_FormatFieldNoDescription
--- PASS: TestCleanJSONSchemaForAntigravity_FormatFieldNoDescription (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_MultipleFormats
--- PASS: TestCleanJSONSchemaForAntigravity_MultipleFormats (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_NumericEnumToString
--- PASS: TestCleanJSONSchemaForAntigravity_NumericEnumToString (0.00s)
=== RUN   TestCleanJSONSchemaForAntigravity_BooleanEnumToString
--- PASS: TestCleanJSONSchemaForAntigravity_BooleanEnumToString (0.00s)
=== RUN   TestCleanJSONSchemaForGemini_RemovesGeminiUnsupportedMetadataFields
--- PASS: TestCleanJSONSchemaForGemini_RemovesGeminiUnsupportedMetadataFields (0.00s)
=== RUN   TestRemoveExtensionFields
=== RUN   TestRemoveExtensionFields/removes_x-_fields_at_root
=== RUN   TestRemoveExtensionFields/removes_x-_fields_in_nested_properties
=== RUN   TestRemoveExtensionFields/does_NOT_remove_properties_named_x-
=== RUN   TestRemoveExtensionFields/does_NOT_remove_$schema_and_other_meta_fields_(as_requested)
=== RUN   TestRemoveExtensionFields/handles_properties_named_$schema
=== RUN   TestRemoveExtensionFields/handles_escaping_in_paths
--- PASS: TestRemoveExtensionFields (0.00s)
    --- PASS: TestRemoveExtensionFields/removes_x-_fields_at_root (0.00s)
    --- PASS: TestRemoveExtensionFields/removes_x-_fields_in_nested_properties (0.00s)
    --- PASS: TestRemoveExtensionFields/does_NOT_remove_properties_named_x- (0.00s)
    --- PASS: TestRemoveExtensionFields/does_NOT_remove_$schema_and_other_meta_fields_(as_requested) (0.00s)
    --- PASS: TestRemoveExtensionFields/handles_properties_named_$schema (0.00s)
    --- PASS: TestRemoveExtensionFields/handles_escaping_in_paths (0.00s)
=== RUN   TestSanitizeFunctionName
=== RUN   TestSanitizeFunctionName/Normal
=== RUN   TestSanitizeFunctionName/With_Dots
=== RUN   TestSanitizeFunctionName/With_Colons
=== RUN   TestSanitizeFunctionName/With_Dashes
=== RUN   TestSanitizeFunctionName/Mixed_Allowed
=== RUN   TestSanitizeFunctionName/Invalid_Characters
=== RUN   TestSanitizeFunctionName/Spaces
=== RUN   TestSanitizeFunctionName/Non-ASCII
=== RUN   TestSanitizeFunctionName/Starts_with_digit
=== RUN   TestSanitizeFunctionName/Starts_with_dot
=== RUN   TestSanitizeFunctionName/Starts_with_colon
=== RUN   TestSanitizeFunctionName/Starts_with_dash
=== RUN   TestSanitizeFunctionName/Starts_with_invalid_char
=== RUN   TestSanitizeFunctionName/Exactly_64_chars
=== RUN   TestSanitizeFunctionName/Too_long_(65_chars)
=== RUN   TestSanitizeFunctionName/Very_long
=== RUN   TestSanitizeFunctionName/Starts_with_digit_(64_chars_total)
=== RUN   TestSanitizeFunctionName/Starts_with_invalid_char_(64_chars_total)
=== RUN   TestSanitizeFunctionName/Empty
=== RUN   TestSanitizeFunctionName/Single_character_invalid
=== RUN   TestSanitizeFunctionName/Single_character_valid
=== RUN   TestSanitizeFunctionName/Single_character_digit
=== RUN   TestSanitizeFunctionName/Single_character_underscore
--- PASS: TestSanitizeFunctionName (0.00s)
    --- PASS: TestSanitizeFunctionName/Normal (0.00s)
    --- PASS: TestSanitizeFunctionName/With_Dots (0.00s)
    --- PASS: TestSanitizeFunctionName/With_Colons (0.00s)
    --- PASS: TestSanitizeFunctionName/With_Dashes (0.00s)
    --- PASS: TestSanitizeFunctionName/Mixed_Allowed (0.00s)
    --- PASS: TestSanitizeFunctionName/Invalid_Characters (0.00s)
    --- PASS: TestSanitizeFunctionName/Spaces (0.00s)
    --- PASS: TestSanitizeFunctionName/Non-ASCII (0.00s)
    --- PASS: TestSanitizeFunctionName/Starts_with_digit (0.00s)
    --- PASS: TestSanitizeFunctionName/Starts_with_dot (0.00s)
    --- PASS: TestSanitizeFunctionName/Starts_with_colon (0.00s)
    --- PASS: TestSanitizeFunctionName/Starts_with_dash (0.00s)
    --- PASS: TestSanitizeFunctionName/Starts_with_invalid_char (0.00s)
    --- PASS: TestSanitizeFunctionName/Exactly_64_chars (0.00s)
    --- PASS: TestSanitizeFunctionName/Too_long_(65_chars) (0.00s)
    --- PASS: TestSanitizeFunctionName/Very_long (0.00s)
    --- PASS: TestSanitizeFunctionName/Starts_with_digit_(64_chars_total) (0.00s)
    --- PASS: TestSanitizeFunctionName/Starts_with_invalid_char_(64_chars_total) (0.00s)
    --- PASS: TestSanitizeFunctionName/Empty (0.00s)
    --- PASS: TestSanitizeFunctionName/Single_character_invalid (0.00s)
    --- PASS: TestSanitizeFunctionName/Single_character_valid (0.00s)
    --- PASS: TestSanitizeFunctionName/Single_character_digit (0.00s)
    --- PASS: TestSanitizeFunctionName/Single_character_underscore (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/util	1.579s
=== RUN   TestApplyAuthExcludedModelsMeta_APIKey
--- PASS: TestApplyAuthExcludedModelsMeta_APIKey (0.00s)
=== RUN   TestApplyAuthExcludedModelsMeta_OAuthProvider
--- PASS: TestApplyAuthExcludedModelsMeta_OAuthProvider (0.00s)
=== RUN   TestBuildAPIKeyClientsCounts
--- PASS: TestBuildAPIKeyClientsCounts (0.00s)
=== RUN   TestNormalizeAuthStripsTemporalFields
--- PASS: TestNormalizeAuthStripsTemporalFields (0.00s)
=== RUN   TestMatchProvider
--- PASS: TestMatchProvider (0.00s)
=== RUN   TestSnapshotCoreAuths_ConfigAndAuthFiles
--- PASS: TestSnapshotCoreAuths_ConfigAndAuthFiles (0.00s)
=== RUN   TestReloadConfigIfChanged_TriggersOnChangeAndSkipsUnchanged
time="2026-02-28T16:18:57+03:00" level=info msg="config file changed, reloading: /var/folders/43/l21szb1d12s7p4_7q0g025_00000gn/T/TestReloadConfigIfChanged_TriggersOnChangeAndSkipsUnchanged1608609368/001/config.yaml"
time="2026-02-28T16:18:57+03:00" level=info msg="config successfully reloaded, triggering client reload"
time="2026-02-28T16:18:57+03:00" level=info msg="full client load complete - 0 clients (0 auth files + 0 Gemini API keys + 0 Vertex API keys + 0 Claude API keys + 0 Codex keys + 0 OpenAI-compat)"
time="2026-02-28T16:18:57+03:00" level=info msg="config file changed, reloading: /var/folders/43/l21szb1d12s7p4_7q0g025_00000gn/T/TestReloadConfigIfChanged_TriggersOnChangeAndSkipsUnchanged1608609368/001/config.yaml"
time="2026-02-28T16:18:57+03:00" level=info msg="config successfully reloaded, triggering client reload"
time="2026-02-28T16:18:57+03:00" level=info msg="full client load complete - 0 clients (0 auth files + 0 Gemini API keys + 0 Vertex API keys + 0 Claude API keys + 0 Codex keys + 0 OpenAI-compat)"
--- PASS: TestReloadConfigIfChanged_TriggersOnChangeAndSkipsUnchanged (0.01s)
=== RUN   TestStartAndStopSuccess
time="2026-02-28T16:18:57+03:00" level=info msg="full client load complete - 0 clients (0 auth files + 0 Gemini API keys + 0 Vertex API keys + 0 Claude API keys + 0 Codex keys + 0 OpenAI-compat)"
--- PASS: TestStartAndStopSuccess (0.00s)
=== RUN   TestStartFailsWhenConfigMissing
time="2026-02-28T16:18:57+03:00" level=error msg="failed to watch config file /var/folders/43/l21szb1d12s7p4_7q0g025_00000gn/T/TestStartFailsWhenConfigMissing3422328800/001/missing-config.yaml: lstat /var/folders/43/l21szb1d12s7p4_7q0g025_00000gn/T/TestStartFailsWhenConfigMissing3422328800/001/missing-config.yaml: no such file or directory"
--- PASS: TestStartFailsWhenConfigMissing (0.00s)
=== RUN   TestDispatchRuntimeAuthUpdateEnqueuesAndUpdatesState
--- PASS: TestDispatchRuntimeAuthUpdateEnqueuesAndUpdatesState (0.00s)
=== RUN   TestAddOrUpdateClientSkipsUnchanged
--- PASS: TestAddOrUpdateClientSkipsUnchanged (0.00s)
=== RUN   TestAddOrUpdateClientTriggersReloadAndHash
--- PASS: TestAddOrUpdateClientTriggersReloadAndHash (0.00s)
=== RUN   TestRemoveClientRemovesHash
--- PASS: TestRemoveClientRemovesHash (0.00s)
=== RUN   TestShouldDebounceRemove
--- PASS: TestShouldDebounceRemove (0.00s)
=== RUN   TestAuthFileUnchangedUsesHash
--- PASS: TestAuthFileUnchangedUsesHash (0.00s)
=== RUN   TestAuthFileUnchangedEmptyAndMissing
--- PASS: TestAuthFileUnchangedEmptyAndMissing (0.00s)
=== RUN   TestReloadClientsCachesAuthHashes
time="2026-02-28T16:18:57+03:00" level=info msg="full client load complete - 1 clients (1 auth files + 0 Gemini API keys + 0 Vertex API keys + 0 Claude API keys + 0 Codex keys + 0 OpenAI-compat)"
--- PASS: TestReloadClientsCachesAuthHashes (0.00s)
=== RUN   TestReloadClientsLogsConfigDiffs
time="2026-02-28T16:18:57+03:00" level=info msg="full client load complete - 0 clients (0 auth files + 0 Gemini API keys + 0 Vertex API keys + 0 Claude API keys + 0 Codex keys + 0 OpenAI-compat)"
--- PASS: TestReloadClientsLogsConfigDiffs (0.00s)
=== RUN   TestReloadClientsHandlesNilConfig
time="2026-02-28T16:18:57+03:00" level=error msg="config is nil, cannot reload clients"
--- PASS: TestReloadClientsHandlesNilConfig (0.00s)
=== RUN   TestReloadClientsFiltersProvidersWithNilCurrentAuths
time="2026-02-28T16:18:57+03:00" level=info msg="full client load complete - 0 clients (0 auth files + 0 Gemini API keys + 0 Vertex API keys + 0 Claude API keys + 0 Codex keys + 0 OpenAI-compat)"
--- PASS: TestReloadClientsFiltersProvidersWithNilCurrentAuths (0.00s)
=== RUN   TestSetAuthUpdateQueueNilResetsDispatch
--- PASS: TestSetAuthUpdateQueueNilResetsDispatch (0.00s)
=== RUN   TestPersistAsyncEarlyReturns
--- PASS: TestPersistAsyncEarlyReturns (0.00s)
=== RUN   TestPersistAsyncErrorPaths
time="2026-02-28T16:18:57+03:00" level=error msg="failed to persist auth changes: persist auth error"
time="2026-02-28T16:18:57+03:00" level=error msg="failed to persist config change: persist config error"
--- PASS: TestPersistAsyncErrorPaths (0.03s)
=== RUN   TestStopConfigReloadTimerSafeWhenNil
--- PASS: TestStopConfigReloadTimerSafeWhenNil (0.00s)
=== RUN   TestHandleEventRemovesAuthFile
time="2026-02-28T16:18:57+03:00" level=info msg="auth file changed (REMOVE): remove.json, processing incrementally"
--- PASS: TestHandleEventRemovesAuthFile (0.05s)
=== RUN   TestDispatchAuthUpdatesFlushesQueue
--- PASS: TestDispatchAuthUpdatesFlushesQueue (0.00s)
=== RUN   TestDispatchLoopExitsOnContextDoneWhileSending
--- PASS: TestDispatchLoopExitsOnContextDoneWhileSending (0.03s)
=== RUN   TestProcessEventsHandlesEventErrorAndChannelClose
time="2026-02-28T16:18:57+03:00" level=error msg="file watcher error: watcher error"
--- PASS: TestProcessEventsHandlesEventErrorAndChannelClose (0.02s)
=== RUN   TestProcessEventsReturnsWhenErrorsChannelClosed
--- PASS: TestProcessEventsReturnsWhenErrorsChannelClosed (0.00s)
=== RUN   TestHandleEventIgnoresUnrelatedFiles
--- PASS: TestHandleEventIgnoresUnrelatedFiles (0.00s)
=== RUN   TestHandleEventConfigChangeSchedulesReload
time="2026-02-28T16:18:58+03:00" level=info msg="config file changed, reloading: /var/folders/43/l21szb1d12s7p4_7q0g025_00000gn/T/TestHandleEventConfigChangeSchedulesReload1834236332/001/config.yaml"
time="2026-02-28T16:18:58+03:00" level=info msg="config successfully reloaded, triggering client reload"
time="2026-02-28T16:18:58+03:00" level=info msg="full client load complete - 0 clients (0 auth files + 0 Gemini API keys + 0 Vertex API keys + 0 Claude API keys + 0 Codex keys + 0 OpenAI-compat)"
--- PASS: TestHandleEventConfigChangeSchedulesReload (0.40s)
=== RUN   TestHandleEventAuthWriteTriggersUpdate
time="2026-02-28T16:18:58+03:00" level=info msg="auth file changed (WRITE): a.json, processing incrementally"
--- PASS: TestHandleEventAuthWriteTriggersUpdate (0.00s)
=== RUN   TestHandleEventRemoveDebounceSkips
--- PASS: TestHandleEventRemoveDebounceSkips (0.00s)
=== RUN   TestHandleEventAtomicReplaceUnchangedSkips
--- PASS: TestHandleEventAtomicReplaceUnchangedSkips (0.05s)
=== RUN   TestHandleEventAtomicReplaceChangedTriggersUpdate
time="2026-02-28T16:18:58+03:00" level=info msg="auth file changed (RENAME): change.json, processing incrementally"
--- PASS: TestHandleEventAtomicReplaceChangedTriggersUpdate (0.05s)
=== RUN   TestHandleEventRemoveUnknownFileIgnored
--- PASS: TestHandleEventRemoveUnknownFileIgnored (0.05s)
=== RUN   TestHandleEventRemoveKnownFileDeletes
time="2026-02-28T16:18:58+03:00" level=info msg="auth file changed (REMOVE): known.json, processing incrementally"
--- PASS: TestHandleEventRemoveKnownFileDeletes (0.05s)
=== RUN   TestNormalizeAuthPathAndDebounceCleanup
--- PASS: TestNormalizeAuthPathAndDebounceCleanup (0.00s)
=== RUN   TestRefreshAuthStateDispatchesRuntimeAuths
--- PASS: TestRefreshAuthStateDispatchesRuntimeAuths (0.00s)
=== RUN   TestAddOrUpdateClientEdgeCases
time="2026-02-28T16:18:58+03:00" level=error msg="failed to read auth file missing.json: open /var/folders/43/l21szb1d12s7p4_7q0g025_00000gn/T/TestAddOrUpdateClientEdgeCases588202762/001/missing.json: no such file or directory"
time="2026-02-28T16:18:58+03:00" level=error msg="config is nil, cannot add or update client"
--- PASS: TestAddOrUpdateClientEdgeCases (0.00s)
=== RUN   TestLoadFileClientsWalkError
time="2026-02-28T16:18:58+03:00" level=error msg="error walking auth directory: open /var/folders/43/l21szb1d12s7p4_7q0g025_00000gn/T/TestLoadFileClientsWalkError439433618/001/0noaccess: permission denied"
--- PASS: TestLoadFileClientsWalkError (0.00s)
=== RUN   TestReloadConfigIfChangedHandlesMissingAndEmpty
time="2026-02-28T16:18:58+03:00" level=error msg="failed to read config file for hash check: open /var/folders/43/l21szb1d12s7p4_7q0g025_00000gn/T/TestReloadConfigIfChangedHandlesMissingAndEmpty3596109028/001/missing.yaml: no such file or directory"
--- PASS: TestReloadConfigIfChangedHandlesMissingAndEmpty (0.00s)
=== RUN   TestReloadConfigUsesMirroredAuthDir
time="2026-02-28T16:18:58+03:00" level=info msg="config successfully reloaded, triggering client reload"
time="2026-02-28T16:18:58+03:00" level=info msg="full client load complete - 0 clients (0 auth files + 0 Gemini API keys + 0 Vertex API keys + 0 Claude API keys + 0 Codex keys + 0 OpenAI-compat)"
--- PASS: TestReloadConfigUsesMirroredAuthDir (0.00s)
=== RUN   TestReloadConfigFiltersAffectedOAuthProviders
time="2026-02-28T16:18:58+03:00" level=info msg="config successfully reloaded, triggering client reload"
time="2026-02-28T16:18:58+03:00" level=info msg="full client load complete - 0 clients (0 auth files + 0 Gemini API keys + 0 Vertex API keys + 0 Claude API keys + 0 Codex keys + 0 OpenAI-compat)"
--- PASS: TestReloadConfigFiltersAffectedOAuthProviders (0.00s)
=== RUN   TestStartFailsWhenAuthDirMissing
time="2026-02-28T16:18:58+03:00" level=error msg="failed to watch auth directory /var/folders/43/l21szb1d12s7p4_7q0g025_00000gn/T/TestStartFailsWhenAuthDirMissing704782001/001/missing-auth: lstat /var/folders/43/l21szb1d12s7p4_7q0g025_00000gn/T/TestStartFailsWhenAuthDirMissing704782001/001/missing-auth: no such file or directory"
--- PASS: TestStartFailsWhenAuthDirMissing (0.00s)
=== RUN   TestDispatchRuntimeAuthUpdateReturnsFalseWithoutQueue
--- PASS: TestDispatchRuntimeAuthUpdateReturnsFalseWithoutQueue (0.00s)
=== RUN   TestNormalizeAuthNil
--- PASS: TestNormalizeAuthNil (0.00s)
=== RUN   TestNewWatcherDetectsPersisterAndAuthDir
--- PASS: TestNewWatcherDetectsPersisterAndAuthDir (0.00s)
=== RUN   TestPersistConfigAndAuthAsyncInvokePersister
--- PASS: TestPersistConfigAndAuthAsyncInvokePersister (0.03s)
=== RUN   TestScheduleConfigReloadDebounces
time="2026-02-28T16:18:58+03:00" level=info msg="config file changed, reloading: /var/folders/43/l21szb1d12s7p4_7q0g025_00000gn/T/TestScheduleConfigReloadDebounces2960795514/001/config.yaml"
time="2026-02-28T16:18:58+03:00" level=info msg="config successfully reloaded, triggering client reload"
time="2026-02-28T16:18:58+03:00" level=info msg="full client load complete - 0 clients (0 auth files + 0 Gemini API keys + 0 Vertex API keys + 0 Claude API keys + 0 Codex keys + 0 OpenAI-compat)"
--- PASS: TestScheduleConfigReloadDebounces (0.40s)
=== RUN   TestPrepareAuthUpdatesLockedForceAndDelete
--- PASS: TestPrepareAuthUpdatesLockedForceAndDelete (0.00s)
=== RUN   TestAuthEqualIgnoresTemporalFields
--- PASS: TestAuthEqualIgnoresTemporalFields (0.00s)
=== RUN   TestDispatchLoopExitsWhenQueueNilAndContextCanceled
--- PASS: TestDispatchLoopExitsWhenQueueNilAndContextCanceled (0.02s)
=== RUN   TestReloadClientsFiltersOAuthProvidersWithoutRescan
time="2026-02-28T16:18:59+03:00" level=info msg="full client load complete - 1 clients (1 auth files + 0 Gemini API keys + 0 Vertex API keys + 0 Claude API keys + 0 Codex keys + 0 OpenAI-compat)"
--- PASS: TestReloadClientsFiltersOAuthProvidersWithoutRescan (0.00s)
=== RUN   TestScheduleProcessEventsStopsOnContextDone
--- PASS: TestScheduleProcessEventsStopsOnContextDone (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/watcher	2.806s
=== RUN   TestBuildConfigChangeDetails
--- PASS: TestBuildConfigChangeDetails (0.00s)
=== RUN   TestBuildConfigChangeDetails_NoChanges
--- PASS: TestBuildConfigChangeDetails_NoChanges (0.00s)
=== RUN   TestBuildConfigChangeDetails_GeminiVertexHeadersAndForceMappings
--- PASS: TestBuildConfigChangeDetails_GeminiVertexHeadersAndForceMappings (0.00s)
=== RUN   TestBuildConfigChangeDetails_ModelPrefixes
--- PASS: TestBuildConfigChangeDetails_ModelPrefixes (0.00s)
=== RUN   TestBuildConfigChangeDetails_NilSafe
--- PASS: TestBuildConfigChangeDetails_NilSafe (0.00s)
=== RUN   TestBuildConfigChangeDetails_SecretsAndCounts
--- PASS: TestBuildConfigChangeDetails_SecretsAndCounts (0.00s)
=== RUN   TestBuildConfigChangeDetails_FlagsAndKeys
--- PASS: TestBuildConfigChangeDetails_FlagsAndKeys (0.00s)
=== RUN   TestBuildConfigChangeDetails_AllBranches
--- PASS: TestBuildConfigChangeDetails_AllBranches (0.00s)
=== RUN   TestFormatProxyURL
=== RUN   TestFormatProxyURL/empty
=== RUN   TestFormatProxyURL/invalid
=== RUN   TestFormatProxyURL/fullURLRedactsUserinfoAndPath
=== RUN   TestFormatProxyURL/socks5RedactsUserinfoAndPath
=== RUN   TestFormatProxyURL/socks5HostPort
=== RUN   TestFormatProxyURL/hostPortNoScheme
=== RUN   TestFormatProxyURL/relativePathRedacted
=== RUN   TestFormatProxyURL/schemeAndHost
--- PASS: TestFormatProxyURL (0.00s)
    --- PASS: TestFormatProxyURL/empty (0.00s)
    --- PASS: TestFormatProxyURL/invalid (0.00s)
    --- PASS: TestFormatProxyURL/fullURLRedactsUserinfoAndPath (0.00s)
    --- PASS: TestFormatProxyURL/socks5RedactsUserinfoAndPath (0.00s)
    --- PASS: TestFormatProxyURL/socks5HostPort (0.00s)
    --- PASS: TestFormatProxyURL/hostPortNoScheme (0.00s)
    --- PASS: TestFormatProxyURL/relativePathRedacted (0.00s)
    --- PASS: TestFormatProxyURL/schemeAndHost (0.00s)
=== RUN   TestBuildConfigChangeDetails_SecretAndUpstreamUpdates
--- PASS: TestBuildConfigChangeDetails_SecretAndUpstreamUpdates (0.00s)
=== RUN   TestBuildConfigChangeDetails_CountBranches
--- PASS: TestBuildConfigChangeDetails_CountBranches (0.00s)
=== RUN   TestTrimStrings
--- PASS: TestTrimStrings (0.00s)
=== RUN   TestComputeOpenAICompatModelsHash_Deterministic
--- PASS: TestComputeOpenAICompatModelsHash_Deterministic (0.00s)
=== RUN   TestComputeOpenAICompatModelsHash_NormalizesAndDedups
--- PASS: TestComputeOpenAICompatModelsHash_NormalizesAndDedups (0.00s)
=== RUN   TestComputeVertexCompatModelsHash_DifferentInputs
--- PASS: TestComputeVertexCompatModelsHash_DifferentInputs (0.00s)
=== RUN   TestComputeVertexCompatModelsHash_IgnoresBlankAndOrder
--- PASS: TestComputeVertexCompatModelsHash_IgnoresBlankAndOrder (0.00s)
=== RUN   TestComputeClaudeModelsHash_Empty
--- PASS: TestComputeClaudeModelsHash_Empty (0.00s)
=== RUN   TestComputeCodexModelsHash_Empty
--- PASS: TestComputeCodexModelsHash_Empty (0.00s)
=== RUN   TestComputeClaudeModelsHash_IgnoresBlankAndDedup
--- PASS: TestComputeClaudeModelsHash_IgnoresBlankAndDedup (0.00s)
=== RUN   TestComputeCodexModelsHash_IgnoresBlankAndDedup
--- PASS: TestComputeCodexModelsHash_IgnoresBlankAndDedup (0.00s)
=== RUN   TestComputeExcludedModelsHash_Normalizes
--- PASS: TestComputeExcludedModelsHash_Normalizes (0.00s)
=== RUN   TestComputeOpenAICompatModelsHash_Empty
--- PASS: TestComputeOpenAICompatModelsHash_Empty (0.00s)
=== RUN   TestComputeVertexCompatModelsHash_Empty
--- PASS: TestComputeVertexCompatModelsHash_Empty (0.00s)
=== RUN   TestComputeExcludedModelsHash_Empty
--- PASS: TestComputeExcludedModelsHash_Empty (0.00s)
=== RUN   TestComputeClaudeModelsHash_Deterministic
--- PASS: TestComputeClaudeModelsHash_Deterministic (0.00s)
=== RUN   TestComputeCodexModelsHash_Deterministic
--- PASS: TestComputeCodexModelsHash_Deterministic (0.00s)
=== RUN   TestSummarizeExcludedModels_NormalizesAndDedupes
--- PASS: TestSummarizeExcludedModels_NormalizesAndDedupes (0.00s)
=== RUN   TestDiffOAuthExcludedModelChanges
--- PASS: TestDiffOAuthExcludedModelChanges (0.00s)
=== RUN   TestSummarizeAmpModelMappings
--- PASS: TestSummarizeAmpModelMappings (0.00s)
=== RUN   TestSummarizeOAuthExcludedModels_NormalizesKeys
--- PASS: TestSummarizeOAuthExcludedModels_NormalizesKeys (0.00s)
=== RUN   TestSummarizeVertexModels
--- PASS: TestSummarizeVertexModels (0.00s)
=== RUN   TestDiffOpenAICompatibility
--- PASS: TestDiffOpenAICompatibility (0.00s)
=== RUN   TestDiffOpenAICompatibility_RemovedAndUnchanged
--- PASS: TestDiffOpenAICompatibility_RemovedAndUnchanged (0.00s)
=== RUN   TestOpenAICompatKeyFallbacks
--- PASS: TestOpenAICompatKeyFallbacks (0.00s)
=== RUN   TestOpenAICompatKey_UsesName
--- PASS: TestOpenAICompatKey_UsesName (0.00s)
=== RUN   TestOpenAICompatKey_SignatureFallbackWhenOnlyAPIKeys
--- PASS: TestOpenAICompatKey_SignatureFallbackWhenOnlyAPIKeys (0.00s)
=== RUN   TestOpenAICompatSignature_EmptyReturnsEmpty
--- PASS: TestOpenAICompatSignature_EmptyReturnsEmpty (0.00s)
=== RUN   TestOpenAICompatSignature_StableAndNormalized
--- PASS: TestOpenAICompatSignature_StableAndNormalized (0.00s)
=== RUN   TestCountOpenAIModelsSkipsBlanks
--- PASS: TestCountOpenAIModelsSkipsBlanks (0.00s)
=== RUN   TestOpenAICompatKeyUsesModelNameWhenAliasEmpty
--- PASS: TestOpenAICompatKeyUsesModelNameWhenAliasEmpty (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/watcher/diff	1.551s
=== RUN   TestNewConfigSynthesizer
--- PASS: TestNewConfigSynthesizer (0.00s)
=== RUN   TestConfigSynthesizer_Synthesize_NilContext
--- PASS: TestConfigSynthesizer_Synthesize_NilContext (0.00s)
=== RUN   TestConfigSynthesizer_Synthesize_NilConfig
--- PASS: TestConfigSynthesizer_Synthesize_NilConfig (0.00s)
=== RUN   TestConfigSynthesizer_GeminiKeys
=== RUN   TestConfigSynthesizer_GeminiKeys/single_gemini_key
=== RUN   TestConfigSynthesizer_GeminiKeys/gemini_key_with_base_url_and_proxy
=== RUN   TestConfigSynthesizer_GeminiKeys/gemini_key_with_headers
=== RUN   TestConfigSynthesizer_GeminiKeys/empty_api_key_skipped
=== RUN   TestConfigSynthesizer_GeminiKeys/multiple_gemini_keys
--- PASS: TestConfigSynthesizer_GeminiKeys (0.00s)
    --- PASS: TestConfigSynthesizer_GeminiKeys/single_gemini_key (0.00s)
    --- PASS: TestConfigSynthesizer_GeminiKeys/gemini_key_with_base_url_and_proxy (0.00s)
    --- PASS: TestConfigSynthesizer_GeminiKeys/gemini_key_with_headers (0.00s)
    --- PASS: TestConfigSynthesizer_GeminiKeys/empty_api_key_skipped (0.00s)
    --- PASS: TestConfigSynthesizer_GeminiKeys/multiple_gemini_keys (0.00s)
=== RUN   TestConfigSynthesizer_ClaudeKeys
--- PASS: TestConfigSynthesizer_ClaudeKeys (0.00s)
=== RUN   TestConfigSynthesizer_ClaudeKeys_SkipsEmptyAndHeaders
--- PASS: TestConfigSynthesizer_ClaudeKeys_SkipsEmptyAndHeaders (0.00s)
=== RUN   TestConfigSynthesizer_CodexKeys
--- PASS: TestConfigSynthesizer_CodexKeys (0.00s)
=== RUN   TestConfigSynthesizer_CodexKeys_SkipsEmptyAndHeaders
--- PASS: TestConfigSynthesizer_CodexKeys_SkipsEmptyAndHeaders (0.00s)
=== RUN   TestConfigSynthesizer_OpenAICompat
=== RUN   TestConfigSynthesizer_OpenAICompat/with_APIKeyEntries
=== RUN   TestConfigSynthesizer_OpenAICompat/empty_APIKeyEntries_included_(legacy)
=== RUN   TestConfigSynthesizer_OpenAICompat/without_APIKeyEntries_(fallback)
=== RUN   TestConfigSynthesizer_OpenAICompat/empty_name_defaults
--- PASS: TestConfigSynthesizer_OpenAICompat (0.00s)
    --- PASS: TestConfigSynthesizer_OpenAICompat/with_APIKeyEntries (0.00s)
    --- PASS: TestConfigSynthesizer_OpenAICompat/empty_APIKeyEntries_included_(legacy) (0.00s)
    --- PASS: TestConfigSynthesizer_OpenAICompat/without_APIKeyEntries_(fallback) (0.00s)
    --- PASS: TestConfigSynthesizer_OpenAICompat/empty_name_defaults (0.00s)
=== RUN   TestConfigSynthesizer_VertexCompat
--- PASS: TestConfigSynthesizer_VertexCompat (0.00s)
=== RUN   TestConfigSynthesizer_VertexCompat_SkipsEmptyAndHeaders
--- PASS: TestConfigSynthesizer_VertexCompat_SkipsEmptyAndHeaders (0.00s)
=== RUN   TestConfigSynthesizer_OpenAICompat_WithModelsHash
--- PASS: TestConfigSynthesizer_OpenAICompat_WithModelsHash (0.00s)
=== RUN   TestConfigSynthesizer_OpenAICompat_FallbackWithModels
--- PASS: TestConfigSynthesizer_OpenAICompat_FallbackWithModels (0.00s)
=== RUN   TestConfigSynthesizer_VertexCompat_WithModels
--- PASS: TestConfigSynthesizer_VertexCompat_WithModels (0.00s)
=== RUN   TestConfigSynthesizer_IDStability
--- PASS: TestConfigSynthesizer_IDStability (0.00s)
=== RUN   TestConfigSynthesizer_AllProviders
--- PASS: TestConfigSynthesizer_AllProviders (0.00s)
=== RUN   TestNewFileSynthesizer
--- PASS: TestNewFileSynthesizer (0.00s)
=== RUN   TestFileSynthesizer_Synthesize_NilContext
--- PASS: TestFileSynthesizer_Synthesize_NilContext (0.00s)
=== RUN   TestFileSynthesizer_Synthesize_EmptyAuthDir
--- PASS: TestFileSynthesizer_Synthesize_EmptyAuthDir (0.00s)
=== RUN   TestFileSynthesizer_Synthesize_NonExistentDir
--- PASS: TestFileSynthesizer_Synthesize_NonExistentDir (0.00s)
=== RUN   TestFileSynthesizer_Synthesize_ValidAuthFile
--- PASS: TestFileSynthesizer_Synthesize_ValidAuthFile (0.00s)
=== RUN   TestFileSynthesizer_Synthesize_GeminiProviderMapping
--- PASS: TestFileSynthesizer_Synthesize_GeminiProviderMapping (0.00s)
=== RUN   TestFileSynthesizer_Synthesize_SkipsInvalidFiles
--- PASS: TestFileSynthesizer_Synthesize_SkipsInvalidFiles (0.00s)
=== RUN   TestFileSynthesizer_Synthesize_SkipsDirectories
--- PASS: TestFileSynthesizer_Synthesize_SkipsDirectories (0.00s)
=== RUN   TestFileSynthesizer_Synthesize_RelativeID
--- PASS: TestFileSynthesizer_Synthesize_RelativeID (0.00s)
=== RUN   TestFileSynthesizer_Synthesize_PrefixValidation
=== RUN   TestFileSynthesizer_Synthesize_PrefixValidation/valid_prefix
=== RUN   TestFileSynthesizer_Synthesize_PrefixValidation/prefix_with_slashes_trimmed
=== RUN   TestFileSynthesizer_Synthesize_PrefixValidation/prefix_with_spaces_trimmed
=== RUN   TestFileSynthesizer_Synthesize_PrefixValidation/prefix_with_internal_slash_rejected
=== RUN   TestFileSynthesizer_Synthesize_PrefixValidation/empty_prefix
--- PASS: TestFileSynthesizer_Synthesize_PrefixValidation (0.00s)
    --- PASS: TestFileSynthesizer_Synthesize_PrefixValidation/valid_prefix (0.00s)
    --- PASS: TestFileSynthesizer_Synthesize_PrefixValidation/prefix_with_slashes_trimmed (0.00s)
    --- PASS: TestFileSynthesizer_Synthesize_PrefixValidation/prefix_with_spaces_trimmed (0.00s)
    --- PASS: TestFileSynthesizer_Synthesize_PrefixValidation/prefix_with_internal_slash_rejected (0.00s)
    --- PASS: TestFileSynthesizer_Synthesize_PrefixValidation/empty_prefix (0.00s)
=== RUN   TestFileSynthesizer_Synthesize_PriorityParsing
=== RUN   TestFileSynthesizer_Synthesize_PriorityParsing/string_with_spaces
=== RUN   TestFileSynthesizer_Synthesize_PriorityParsing/number
=== RUN   TestFileSynthesizer_Synthesize_PriorityParsing/invalid_string
--- PASS: TestFileSynthesizer_Synthesize_PriorityParsing (0.01s)
    --- PASS: TestFileSynthesizer_Synthesize_PriorityParsing/string_with_spaces (0.00s)
    --- PASS: TestFileSynthesizer_Synthesize_PriorityParsing/number (0.00s)
    --- PASS: TestFileSynthesizer_Synthesize_PriorityParsing/invalid_string (0.00s)
=== RUN   TestFileSynthesizer_Synthesize_OAuthExcludedModelsMerged
--- PASS: TestFileSynthesizer_Synthesize_OAuthExcludedModelsMerged (0.00s)
=== RUN   TestSynthesizeGeminiVirtualAuths_NilInputs
--- PASS: TestSynthesizeGeminiVirtualAuths_NilInputs (0.00s)
=== RUN   TestSynthesizeGeminiVirtualAuths_SingleProject
--- PASS: TestSynthesizeGeminiVirtualAuths_SingleProject (0.00s)
=== RUN   TestSynthesizeGeminiVirtualAuths_MultiProject
--- PASS: TestSynthesizeGeminiVirtualAuths_MultiProject (0.00s)
=== RUN   TestSynthesizeGeminiVirtualAuths_EmptyProviderAndLabel
--- PASS: TestSynthesizeGeminiVirtualAuths_EmptyProviderAndLabel (0.00s)
=== RUN   TestSynthesizeGeminiVirtualAuths_NilPrimaryAttributes
--- PASS: TestSynthesizeGeminiVirtualAuths_NilPrimaryAttributes (0.00s)
=== RUN   TestSplitGeminiProjectIDs
=== RUN   TestSplitGeminiProjectIDs/single_project
=== RUN   TestSplitGeminiProjectIDs/multiple_projects
=== RUN   TestSplitGeminiProjectIDs/with_duplicates
=== RUN   TestSplitGeminiProjectIDs/with_empty_parts
=== RUN   TestSplitGeminiProjectIDs/empty_project_id
=== RUN   TestSplitGeminiProjectIDs/no_project_id
=== RUN   TestSplitGeminiProjectIDs/whitespace_only
--- PASS: TestSplitGeminiProjectIDs (0.00s)
    --- PASS: TestSplitGeminiProjectIDs/single_project (0.00s)
    --- PASS: TestSplitGeminiProjectIDs/multiple_projects (0.00s)
    --- PASS: TestSplitGeminiProjectIDs/with_duplicates (0.00s)
    --- PASS: TestSplitGeminiProjectIDs/with_empty_parts (0.00s)
    --- PASS: TestSplitGeminiProjectIDs/empty_project_id (0.00s)
    --- PASS: TestSplitGeminiProjectIDs/no_project_id (0.00s)
    --- PASS: TestSplitGeminiProjectIDs/whitespace_only (0.00s)
=== RUN   TestFileSynthesizer_Synthesize_MultiProjectGemini
--- PASS: TestFileSynthesizer_Synthesize_MultiProjectGemini (0.00s)
=== RUN   TestBuildGeminiVirtualID
=== RUN   TestBuildGeminiVirtualID/basic
=== RUN   TestBuildGeminiVirtualID/with_slashes
=== RUN   TestBuildGeminiVirtualID/with_spaces
=== RUN   TestBuildGeminiVirtualID/empty_project
=== RUN   TestBuildGeminiVirtualID/whitespace_project
--- PASS: TestBuildGeminiVirtualID (0.00s)
    --- PASS: TestBuildGeminiVirtualID/basic (0.00s)
    --- PASS: TestBuildGeminiVirtualID/with_slashes (0.00s)
    --- PASS: TestBuildGeminiVirtualID/with_spaces (0.00s)
    --- PASS: TestBuildGeminiVirtualID/empty_project (0.00s)
    --- PASS: TestBuildGeminiVirtualID/whitespace_project (0.00s)
=== RUN   TestNewStableIDGenerator
--- PASS: TestNewStableIDGenerator (0.00s)
=== RUN   TestStableIDGenerator_Next
=== RUN   TestStableIDGenerator_Next/basic_gemini_apikey
=== RUN   TestStableIDGenerator_Next/claude_with_base_url
=== RUN   TestStableIDGenerator_Next/empty_parts
--- PASS: TestStableIDGenerator_Next (0.00s)
    --- PASS: TestStableIDGenerator_Next/basic_gemini_apikey (0.00s)
    --- PASS: TestStableIDGenerator_Next/claude_with_base_url (0.00s)
    --- PASS: TestStableIDGenerator_Next/empty_parts (0.00s)
=== RUN   TestStableIDGenerator_Stability
--- PASS: TestStableIDGenerator_Stability (0.00s)
=== RUN   TestStableIDGenerator_CollisionHandling
--- PASS: TestStableIDGenerator_CollisionHandling (0.00s)
=== RUN   TestStableIDGenerator_NilReceiver
--- PASS: TestStableIDGenerator_NilReceiver (0.00s)
=== RUN   TestApplyAuthExcludedModelsMeta
=== RUN   TestApplyAuthExcludedModelsMeta/apikey_with_excluded_models
=== RUN   TestApplyAuthExcludedModelsMeta/oauth_with_provider_excluded_models
=== RUN   TestApplyAuthExcludedModelsMeta/nil_auth
=== RUN   TestApplyAuthExcludedModelsMeta/nil_config
=== RUN   TestApplyAuthExcludedModelsMeta/nil_attributes_initialized
=== RUN   TestApplyAuthExcludedModelsMeta/apikey_with_duplicate_excluded_models
--- PASS: TestApplyAuthExcludedModelsMeta (0.00s)
    --- PASS: TestApplyAuthExcludedModelsMeta/apikey_with_excluded_models (0.00s)
    --- PASS: TestApplyAuthExcludedModelsMeta/oauth_with_provider_excluded_models (0.00s)
    --- PASS: TestApplyAuthExcludedModelsMeta/nil_auth (0.00s)
    --- PASS: TestApplyAuthExcludedModelsMeta/nil_config (0.00s)
    --- PASS: TestApplyAuthExcludedModelsMeta/nil_attributes_initialized (0.00s)
    --- PASS: TestApplyAuthExcludedModelsMeta/apikey_with_duplicate_excluded_models (0.00s)
=== RUN   TestApplyAuthExcludedModelsMeta_OAuthMergeWritesCombinedModels
--- PASS: TestApplyAuthExcludedModelsMeta_OAuthMergeWritesCombinedModels (0.00s)
=== RUN   TestAddConfigHeadersToAttrs
=== RUN   TestAddConfigHeadersToAttrs/basic_headers
=== RUN   TestAddConfigHeadersToAttrs/empty_headers
=== RUN   TestAddConfigHeadersToAttrs/nil_headers
=== RUN   TestAddConfigHeadersToAttrs/nil_attrs
=== RUN   TestAddConfigHeadersToAttrs/skip_empty_keys_and_values
--- PASS: TestAddConfigHeadersToAttrs (0.00s)
    --- PASS: TestAddConfigHeadersToAttrs/basic_headers (0.00s)
    --- PASS: TestAddConfigHeadersToAttrs/empty_headers (0.00s)
    --- PASS: TestAddConfigHeadersToAttrs/nil_headers (0.00s)
    --- PASS: TestAddConfigHeadersToAttrs/nil_attrs (0.00s)
    --- PASS: TestAddConfigHeadersToAttrs/skip_empty_keys_and_values (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/internal/watcher/synthesizer	1.607s
?   	github.com/router-for-me/CLIProxyAPI/v6/internal/wsrelay	[no test files]
=== RUN   TestManager_Authenticate
--- PASS: TestManager_Authenticate (0.00s)
=== RUN   TestManager_Providers
--- PASS: TestManager_Providers (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/sdk/access	1.650s
?   	github.com/router-for-me/CLIProxyAPI/v6/sdk/api	[no test files]
=== RUN   TestAppendAPIResponse_AppendsWithNewline
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

--- PASS: TestAppendAPIResponse_AppendsWithNewline (0.00s)
=== RUN   TestBuildErrorResponseBody_PreservesOpenAIEnvelopeJSON
--- PASS: TestBuildErrorResponseBody_PreservesOpenAIEnvelopeJSON (0.00s)
=== RUN   TestBuildErrorResponseBody_RewrapsJSONWithoutErrorField
--- PASS: TestBuildErrorResponseBody_RewrapsJSONWithoutErrorField (0.00s)
=== RUN   TestBuildErrorResponseBody_NotFoundAddsModelHint
--- PASS: TestBuildErrorResponseBody_NotFoundAddsModelHint (0.00s)
=== RUN   TestWriteErrorResponse_AddonHeadersDisabledByDefault
--- PASS: TestWriteErrorResponse_AddonHeadersDisabledByDefault (0.00s)
=== RUN   TestWriteErrorResponse_AddonHeadersEnabled
--- PASS: TestWriteErrorResponse_AddonHeadersEnabled (0.00s)
=== RUN   TestRequestExecutionMetadata_GeneratesIdempotencyKey
--- PASS: TestRequestExecutionMetadata_GeneratesIdempotencyKey (0.00s)
=== RUN   TestRequestExecutionMetadata_PreservesHeaderAndContextMetadata
--- PASS: TestRequestExecutionMetadata_PreservesHeaderAndContextMetadata (0.00s)
=== RUN   TestRequestExecutionMetadata_UsesProvidedIdempotencyKeyForRetries
--- PASS: TestRequestExecutionMetadata_UsesProvidedIdempotencyKeyForRetries (0.00s)
=== RUN   TestGetRequestDetails_PreservesSuffix
=== RUN   TestGetRequestDetails_PreservesSuffix/numeric_suffix_preserved
=== RUN   TestGetRequestDetails_PreservesSuffix/level_suffix_preserved
=== RUN   TestGetRequestDetails_PreservesSuffix/no_suffix_unchanged
=== RUN   TestGetRequestDetails_PreservesSuffix/unknown_model_with_suffix
=== RUN   TestGetRequestDetails_PreservesSuffix/auto_suffix_resolved
time="2026-02-28T16:18:58+03:00" level=info msg="Resolved 'auto' model to: gemini-2.5-pro"
=== RUN   TestGetRequestDetails_PreservesSuffix/special_suffix_none_preserved
=== RUN   TestGetRequestDetails_PreservesSuffix/special_suffix_auto_preserved
--- PASS: TestGetRequestDetails_PreservesSuffix (0.00s)
    --- PASS: TestGetRequestDetails_PreservesSuffix/numeric_suffix_preserved (0.00s)
    --- PASS: TestGetRequestDetails_PreservesSuffix/level_suffix_preserved (0.00s)
    --- PASS: TestGetRequestDetails_PreservesSuffix/no_suffix_unchanged (0.00s)
    --- PASS: TestGetRequestDetails_PreservesSuffix/unknown_model_with_suffix (0.00s)
    --- PASS: TestGetRequestDetails_PreservesSuffix/auto_suffix_resolved (0.00s)
    --- PASS: TestGetRequestDetails_PreservesSuffix/special_suffix_none_preserved (0.00s)
    --- PASS: TestGetRequestDetails_PreservesSuffix/special_suffix_auto_preserved (0.00s)
=== RUN   TestExecuteStreamWithAuthManager_RetriesBeforeFirstByte
--- PASS: TestExecuteStreamWithAuthManager_RetriesBeforeFirstByte (0.00s)
=== RUN   TestExecuteStreamWithAuthManager_HeaderPassthroughDisabledByDefault
--- PASS: TestExecuteStreamWithAuthManager_HeaderPassthroughDisabledByDefault (0.00s)
=== RUN   TestExecuteStreamWithAuthManager_DoesNotRetryAfterFirstByte
--- PASS: TestExecuteStreamWithAuthManager_DoesNotRetryAfterFirstByte (0.00s)
=== RUN   TestExecuteStreamWithAuthManager_PinnedAuthKeepsSameUpstream
--- PASS: TestExecuteStreamWithAuthManager_PinnedAuthKeepsSameUpstream (0.00s)
=== RUN   TestExecuteStreamWithAuthManager_SelectedAuthCallbackReceivesAuthID
--- PASS: TestExecuteStreamWithAuthManager_SelectedAuthCallbackReceivesAuthID (0.00s)
=== RUN   TestExecuteStreamWithAuthManager_ValidatesOpenAIResponsesStreamDataJSON
--- PASS: TestExecuteStreamWithAuthManager_ValidatesOpenAIResponsesStreamDataJSON (0.00s)
=== RUN   TestFilterUpstreamHeaders_RemovesConnectionScopedHeaders
--- PASS: TestFilterUpstreamHeaders_RemovesConnectionScopedHeaders (0.00s)
=== RUN   TestFilterUpstreamHeaders_ReturnsNilWhenAllHeadersBlocked
--- PASS: TestFilterUpstreamHeaders_ReturnsNilWhenAllHeadersBlocked (0.00s)
=== RUN   TestBuildOpenAIResponsesStreamErrorChunk
--- PASS: TestBuildOpenAIResponsesStreamErrorChunk (0.00s)
=== RUN   TestBuildOpenAIResponsesStreamErrorChunkExtractsHTTPErrorBody
--- PASS: TestBuildOpenAIResponsesStreamErrorChunkExtractsHTTPErrorBody (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/sdk/api/handlers	1.611s
=== RUN   TestSanitizeClaudeRequest_RemovesPlaceholderReasonOnlySchema
--- PASS: TestSanitizeClaudeRequest_RemovesPlaceholderReasonOnlySchema (0.00s)
=== RUN   TestSanitizeClaudeRequest_PreservesNonPlaceholderReasonSchema
--- PASS: TestSanitizeClaudeRequest_PreservesNonPlaceholderReasonSchema (0.00s)
=== RUN   TestSanitizeClaudeRequest_RemovesPlaceholderReasonWithOtherProperties
--- PASS: TestSanitizeClaudeRequest_RemovesPlaceholderReasonWithOtherProperties (0.00s)
=== RUN   TestSanitizeClaudeRequest_RemovesPlaceholderReasonFromCustomInputSchema
--- PASS: TestSanitizeClaudeRequest_RemovesPlaceholderReasonFromCustomInputSchema (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/sdk/api/handlers/claude	1.629s
?   	github.com/router-for-me/CLIProxyAPI/v6/sdk/api/handlers/gemini	[no test files]
=== RUN   TestConvertToOpenAIFormat_GeminiDefaultsToDataURL
=== PAUSE TestConvertToOpenAIFormat_GeminiDefaultsToDataURL
=== RUN   TestConvertToOpenAIFormat_GeminiB64JSONResponseFormat
=== PAUSE TestConvertToOpenAIFormat_GeminiB64JSONResponseFormat
=== RUN   TestConvertToProviderFormat_GeminiMapsSizeToAspectRatio
=== PAUSE TestConvertToProviderFormat_GeminiMapsSizeToAspectRatio
=== RUN   TestOpenAIResponsesCompactRejectsStream
--- PASS: TestOpenAIResponsesCompactRejectsStream (0.00s)
=== RUN   TestOpenAIResponsesCompactExecute
--- PASS: TestOpenAIResponsesCompactExecute (0.00s)
=== RUN   TestForwardResponsesStreamTerminalErrorUsesResponsesErrorChunk
--- PASS: TestForwardResponsesStreamTerminalErrorUsesResponsesErrorChunk (0.00s)
=== RUN   TestNormalizeResponsesWebsocketRequestCreate
--- PASS: TestNormalizeResponsesWebsocketRequestCreate (0.00s)
=== RUN   TestNormalizeResponsesWebsocketRequestCreateWithHistory
--- PASS: TestNormalizeResponsesWebsocketRequestCreateWithHistory (0.00s)
=== RUN   TestNormalizeResponsesWebsocketRequestWithPreviousResponseIDIncremental
--- PASS: TestNormalizeResponsesWebsocketRequestWithPreviousResponseIDIncremental (0.00s)
=== RUN   TestNormalizeResponsesWebsocketRequestWithPreviousResponseIDMergedWhenIncrementalDisabled
--- PASS: TestNormalizeResponsesWebsocketRequestWithPreviousResponseIDMergedWhenIncrementalDisabled (0.00s)
=== RUN   TestNormalizeResponsesWebsocketRequestAppend
--- PASS: TestNormalizeResponsesWebsocketRequestAppend (0.00s)
=== RUN   TestNormalizeResponsesWebsocketRequestAppendWithoutCreate
--- PASS: TestNormalizeResponsesWebsocketRequestAppendWithoutCreate (0.00s)
=== RUN   TestWebsocketJSONPayloadsFromChunk
--- PASS: TestWebsocketJSONPayloadsFromChunk (0.00s)
=== RUN   TestWebsocketJSONPayloadsFromPlainJSONChunk
--- PASS: TestWebsocketJSONPayloadsFromPlainJSONChunk (0.00s)
=== RUN   TestResponseCompletedOutputFromPayload
--- PASS: TestResponseCompletedOutputFromPayload (0.00s)
=== RUN   TestAppendWebsocketEvent
--- PASS: TestAppendWebsocketEvent (0.00s)
=== RUN   TestSetWebsocketRequestBody
--- PASS: TestSetWebsocketRequestBody (0.00s)
=== CONT  TestConvertToOpenAIFormat_GeminiDefaultsToDataURL
--- PASS: TestConvertToOpenAIFormat_GeminiDefaultsToDataURL (0.00s)
=== CONT  TestConvertToProviderFormat_GeminiMapsSizeToAspectRatio
=== CONT  TestConvertToOpenAIFormat_GeminiB64JSONResponseFormat
--- PASS: TestConvertToOpenAIFormat_GeminiB64JSONResponseFormat (0.00s)
--- PASS: TestConvertToProviderFormat_GeminiMapsSizeToAspectRatio (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/sdk/api/handlers/openai	1.597s
=== RUN   TestExtractAccessToken
=== PAUSE TestExtractAccessToken
=== CONT  TestExtractAccessToken
=== RUN   TestExtractAccessToken/antigravity_top-level_access_token
=== PAUSE TestExtractAccessToken/antigravity_top-level_access_token
=== RUN   TestExtractAccessToken/gemini_nested_token.access_token
=== PAUSE TestExtractAccessToken/gemini_nested_token.access_token
=== RUN   TestExtractAccessToken/top-level_takes_precedence_over_nested
=== PAUSE TestExtractAccessToken/top-level_takes_precedence_over_nested
=== RUN   TestExtractAccessToken/empty_metadata
=== PAUSE TestExtractAccessToken/empty_metadata
=== RUN   TestExtractAccessToken/whitespace-only_access_token
=== PAUSE TestExtractAccessToken/whitespace-only_access_token
=== RUN   TestExtractAccessToken/wrong_type_access_token
=== PAUSE TestExtractAccessToken/wrong_type_access_token
=== RUN   TestExtractAccessToken/token_is_not_a_map
=== PAUSE TestExtractAccessToken/token_is_not_a_map
=== RUN   TestExtractAccessToken/nested_whitespace-only
=== PAUSE TestExtractAccessToken/nested_whitespace-only
=== RUN   TestExtractAccessToken/fallback_to_nested_when_top-level_empty
=== PAUSE TestExtractAccessToken/fallback_to_nested_when_top-level_empty
=== CONT  TestExtractAccessToken/wrong_type_access_token
=== CONT  TestExtractAccessToken/antigravity_top-level_access_token
=== CONT  TestExtractAccessToken/fallback_to_nested_when_top-level_empty
=== CONT  TestExtractAccessToken/whitespace-only_access_token
=== CONT  TestExtractAccessToken/nested_whitespace-only
=== CONT  TestExtractAccessToken/token_is_not_a_map
=== CONT  TestExtractAccessToken/top-level_takes_precedence_over_nested
=== CONT  TestExtractAccessToken/gemini_nested_token.access_token
=== CONT  TestExtractAccessToken/empty_metadata
--- PASS: TestExtractAccessToken (0.00s)
    --- PASS: TestExtractAccessToken/antigravity_top-level_access_token (0.00s)
    --- PASS: TestExtractAccessToken/wrong_type_access_token (0.00s)
    --- PASS: TestExtractAccessToken/whitespace-only_access_token (0.00s)
    --- PASS: TestExtractAccessToken/nested_whitespace-only (0.00s)
    --- PASS: TestExtractAccessToken/fallback_to_nested_when_top-level_empty (0.00s)
    --- PASS: TestExtractAccessToken/token_is_not_a_map (0.00s)
    --- PASS: TestExtractAccessToken/top-level_takes_precedence_over_nested (0.00s)
    --- PASS: TestExtractAccessToken/gemini_nested_token.access_token (0.00s)
    --- PASS: TestExtractAccessToken/empty_metadata (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/sdk/auth	1.558s
=== RUN   TestBackfillAntigravityModels_RegistersMissingAuth
--- PASS: TestBackfillAntigravityModels_RegistersMissingAuth (0.00s)
=== RUN   TestBackfillAntigravityModels_RespectsExcludedModels
--- PASS: TestBackfillAntigravityModels_RespectsExcludedModels (0.00s)
=== RUN   TestEnsureExecutorsForAuth_CodexDoesNotReplaceInNormalMode
--- PASS: TestEnsureExecutorsForAuth_CodexDoesNotReplaceInNormalMode (0.00s)
=== RUN   TestEnsureExecutorsForAuthWithMode_CodexForceReplace
--- PASS: TestEnsureExecutorsForAuthWithMode_CodexForceReplace (0.00s)
=== RUN   TestRegisterModelsForAuth_UsesPreMergedExcludedModelsAttribute
--- PASS: TestRegisterModelsForAuth_UsesPreMergedExcludedModelsAttribute (0.00s)
=== RUN   TestApplyOAuthModelAlias_Rename
--- PASS: TestApplyOAuthModelAlias_Rename (0.00s)
=== RUN   TestApplyOAuthModelAlias_ForkAddsAlias
--- PASS: TestApplyOAuthModelAlias_ForkAddsAlias (0.00s)
=== RUN   TestApplyOAuthModelAlias_ForkAddsMultipleAliases
--- PASS: TestApplyOAuthModelAlias_ForkAddsMultipleAliases (0.00s)
=== RUN   TestApplyOAuthModelAlias_DefaultGitHubCopilotAliasViaSanitize
--- PASS: TestApplyOAuthModelAlias_DefaultGitHubCopilotAliasViaSanitize (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/sdk/cliproxy	1.286s
=== RUN   TestLookupAPIKeyUpstreamModel
=== RUN   TestLookupAPIKeyUpstreamModel/alias_with_suffix
=== RUN   TestLookupAPIKeyUpstreamModel/alias_without_suffix
=== RUN   TestLookupAPIKeyUpstreamModel/config_suffix_priority
=== RUN   TestLookupAPIKeyUpstreamModel/config_suffix_no_user_suffix
=== RUN   TestLookupAPIKeyUpstreamModel/uppercase_alias
=== RUN   TestLookupAPIKeyUpstreamModel/mixed_case_with_suffix
=== RUN   TestLookupAPIKeyUpstreamModel/upstream_name_direct
=== RUN   TestLookupAPIKeyUpstreamModel/upstream_name_with_suffix
=== RUN   TestLookupAPIKeyUpstreamModel/non-existent_auth
=== RUN   TestLookupAPIKeyUpstreamModel/unknown_alias
=== RUN   TestLookupAPIKeyUpstreamModel/empty_auth_ID
=== RUN   TestLookupAPIKeyUpstreamModel/empty_model
--- PASS: TestLookupAPIKeyUpstreamModel (0.00s)
    --- PASS: TestLookupAPIKeyUpstreamModel/alias_with_suffix (0.00s)
    --- PASS: TestLookupAPIKeyUpstreamModel/alias_without_suffix (0.00s)
    --- PASS: TestLookupAPIKeyUpstreamModel/config_suffix_priority (0.00s)
    --- PASS: TestLookupAPIKeyUpstreamModel/config_suffix_no_user_suffix (0.00s)
    --- PASS: TestLookupAPIKeyUpstreamModel/uppercase_alias (0.00s)
    --- PASS: TestLookupAPIKeyUpstreamModel/mixed_case_with_suffix (0.00s)
    --- PASS: TestLookupAPIKeyUpstreamModel/upstream_name_direct (0.00s)
    --- PASS: TestLookupAPIKeyUpstreamModel/upstream_name_with_suffix (0.00s)
    --- PASS: TestLookupAPIKeyUpstreamModel/non-existent_auth (0.00s)
    --- PASS: TestLookupAPIKeyUpstreamModel/unknown_alias (0.00s)
    --- PASS: TestLookupAPIKeyUpstreamModel/empty_auth_ID (0.00s)
    --- PASS: TestLookupAPIKeyUpstreamModel/empty_model (0.00s)
=== RUN   TestAPIKeyModelAlias_ConfigHotReload
--- PASS: TestAPIKeyModelAlias_ConfigHotReload (0.00s)
=== RUN   TestAPIKeyModelAlias_MultipleProviders
--- PASS: TestAPIKeyModelAlias_MultipleProviders (0.00s)
=== RUN   TestApplyAPIKeyModelAlias
=== RUN   TestApplyAPIKeyModelAlias/api_key_auth_with_alias
=== RUN   TestApplyAPIKeyModelAlias/oauth_auth_passthrough
--- PASS: TestApplyAPIKeyModelAlias (0.00s)
    --- PASS: TestApplyAPIKeyModelAlias/api_key_auth_with_alias (0.00s)
    --- PASS: TestApplyAPIKeyModelAlias/oauth_auth_passthrough (0.00s)
=== RUN   TestUpdateAggregatedAvailability_UnavailableWithoutNextRetryDoesNotBlockAuth
=== PAUSE TestUpdateAggregatedAvailability_UnavailableWithoutNextRetryDoesNotBlockAuth
=== RUN   TestUpdateAggregatedAvailability_FutureNextRetryBlocksAuth
=== PAUSE TestUpdateAggregatedAvailability_FutureNextRetryBlocksAuth
=== RUN   TestManagerRegisterExecutorClosesReplacedExecutionSessions
=== PAUSE TestManagerRegisterExecutorClosesReplacedExecutionSessions
=== RUN   TestManagerExecutorReturnsRegisteredExecutor
=== PAUSE TestManagerExecutorReturnsRegisteredExecutor
=== RUN   TestManager_ShouldRetryAfterError_RespectsAuthRequestRetryOverride
--- PASS: TestManager_ShouldRetryAfterError_RespectsAuthRequestRetryOverride (0.00s)
=== RUN   TestManager_MarkResult_RespectsAuthDisableCoolingOverride
--- PASS: TestManager_MarkResult_RespectsAuthDisableCoolingOverride (0.00s)
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation
=== RUN   TestOAuthModelAliasChannel_Kimi
=== PAUSE TestOAuthModelAliasChannel_Kimi
=== RUN   TestOAuthModelAliasChannel_GitHubCopilot
=== PAUSE TestOAuthModelAliasChannel_GitHubCopilot
=== RUN   TestOAuthModelAliasChannel_Kiro
=== PAUSE TestOAuthModelAliasChannel_Kiro
=== RUN   TestApplyOAuthModelAlias_SuffixPreservation
=== PAUSE TestApplyOAuthModelAlias_SuffixPreservation
=== RUN   TestWithSkipPersist_DisablesUpdatePersistence
--- PASS: TestWithSkipPersist_DisablesUpdatePersistence (0.00s)
=== RUN   TestWithSkipPersist_DisablesRegisterPersistence
--- PASS: TestWithSkipPersist_DisablesRegisterPersistence (0.00s)
=== RUN   TestFillFirstSelectorPick_Deterministic
=== PAUSE TestFillFirstSelectorPick_Deterministic
=== RUN   TestRoundRobinSelectorPick_CyclesDeterministic
=== PAUSE TestRoundRobinSelectorPick_CyclesDeterministic
=== RUN   TestRoundRobinSelectorPick_PriorityBuckets
=== PAUSE TestRoundRobinSelectorPick_PriorityBuckets
=== RUN   TestFillFirstSelectorPick_PriorityFallbackCooldown
=== PAUSE TestFillFirstSelectorPick_PriorityFallbackCooldown
=== RUN   TestRoundRobinSelectorPick_Concurrent
--- PASS: TestRoundRobinSelectorPick_Concurrent (0.00s)
=== RUN   TestSelectorPick_AllCooldownReturnsModelCooldownError
=== PAUSE TestSelectorPick_AllCooldownReturnsModelCooldownError
=== RUN   TestIsAuthBlockedForModel_UnavailableWithoutNextRetryIsNotBlocked
=== PAUSE TestIsAuthBlockedForModel_UnavailableWithoutNextRetryIsNotBlocked
=== RUN   TestFillFirstSelectorPick_ThinkingSuffixFallsBackToBaseModelState
=== PAUSE TestFillFirstSelectorPick_ThinkingSuffixFallsBackToBaseModelState
=== RUN   TestRoundRobinSelectorPick_ThinkingSuffixSharesCursor
=== PAUSE TestRoundRobinSelectorPick_ThinkingSuffixSharesCursor
=== RUN   TestRoundRobinSelectorPick_CursorKeyCap
=== PAUSE TestRoundRobinSelectorPick_CursorKeyCap
=== RUN   TestRoundRobinSelectorPick_GeminiCLICredentialGrouping
=== PAUSE TestRoundRobinSelectorPick_GeminiCLICredentialGrouping
=== RUN   TestRoundRobinSelectorPick_SingleParentFallsBackToFlat
=== PAUSE TestRoundRobinSelectorPick_SingleParentFallsBackToFlat
=== RUN   TestRoundRobinSelectorPick_MixedVirtualAndNonVirtualFallsBackToFlat
=== PAUSE TestRoundRobinSelectorPick_MixedVirtualAndNonVirtualFallsBackToFlat
=== RUN   TestToolPrefixDisabled
--- PASS: TestToolPrefixDisabled (0.00s)
=== CONT  TestUpdateAggregatedAvailability_UnavailableWithoutNextRetryDoesNotBlockAuth
--- PASS: TestUpdateAggregatedAvailability_UnavailableWithoutNextRetryDoesNotBlockAuth (0.00s)
=== CONT  TestRoundRobinSelectorPick_ThinkingSuffixSharesCursor
--- PASS: TestRoundRobinSelectorPick_ThinkingSuffixSharesCursor (0.00s)
=== CONT  TestOAuthModelAliasChannel_Kimi
=== CONT  TestManagerExecutorReturnsRegisteredExecutor
--- PASS: TestOAuthModelAliasChannel_Kimi (0.00s)
--- PASS: TestManagerExecutorReturnsRegisteredExecutor (0.00s)
=== CONT  TestManagerRegisterExecutorClosesReplacedExecutionSessions
--- PASS: TestManagerRegisterExecutorClosesReplacedExecutionSessions (0.00s)
=== CONT  TestIsAuthBlockedForModel_UnavailableWithoutNextRetryIsNotBlocked
=== CONT  TestRoundRobinSelectorPick_SingleParentFallsBackToFlat
=== CONT  TestSelectorPick_AllCooldownReturnsModelCooldownError
=== CONT  TestRoundRobinSelectorPick_GeminiCLICredentialGrouping
=== CONT  TestRoundRobinSelectorPick_CursorKeyCap
=== CONT  TestFillFirstSelectorPick_Deterministic
=== CONT  TestRoundRobinSelectorPick_CyclesDeterministic
=== CONT  TestApplyOAuthModelAlias_SuffixPreservation
=== CONT  TestOAuthModelAliasChannel_Kiro
=== CONT  TestFillFirstSelectorPick_PriorityFallbackCooldown
=== CONT  TestOAuthModelAliasChannel_GitHubCopilot
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/numeric_suffix_preserved
=== CONT  TestRoundRobinSelectorPick_PriorityBuckets
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/numeric_suffix_preserved
=== CONT  TestRoundRobinSelectorPick_MixedVirtualAndNonVirtualFallsBackToFlat
=== CONT  TestUpdateAggregatedAvailability_FutureNextRetryBlocksAuth
--- PASS: TestIsAuthBlockedForModel_UnavailableWithoutNextRetryIsNotBlocked (0.00s)
--- PASS: TestRoundRobinSelectorPick_SingleParentFallsBackToFlat (0.00s)
--- PASS: TestRoundRobinSelectorPick_GeminiCLICredentialGrouping (0.00s)
--- PASS: TestRoundRobinSelectorPick_CursorKeyCap (0.00s)
--- PASS: TestFillFirstSelectorPick_Deterministic (0.00s)
--- PASS: TestRoundRobinSelectorPick_CyclesDeterministic (0.00s)
=== CONT  TestFillFirstSelectorPick_ThinkingSuffixFallsBackToBaseModelState
=== RUN   TestSelectorPick_AllCooldownReturnsModelCooldownError/mixed_provider_redacts_provider_field
=== PAUSE TestSelectorPick_AllCooldownReturnsModelCooldownError/mixed_provider_redacts_provider_field
=== RUN   TestSelectorPick_AllCooldownReturnsModelCooldownError/non-mixed_provider_includes_provider_field
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/level_suffix_preserved
=== PAUSE TestSelectorPick_AllCooldownReturnsModelCooldownError/non-mixed_provider_includes_provider_field
=== CONT  TestSelectorPick_AllCooldownReturnsModelCooldownError/mixed_provider_redacts_provider_field
=== CONT  TestSelectorPick_AllCooldownReturnsModelCooldownError/non-mixed_provider_includes_provider_field
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/level_suffix_preserved
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/no_suffix_unchanged
--- PASS: TestOAuthModelAliasChannel_Kiro (0.00s)
--- PASS: TestFillFirstSelectorPick_PriorityFallbackCooldown (0.00s)
--- PASS: TestOAuthModelAliasChannel_GitHubCopilot (0.00s)
--- PASS: TestApplyOAuthModelAlias_SuffixPreservation (0.00s)
--- PASS: TestRoundRobinSelectorPick_PriorityBuckets (0.00s)
--- PASS: TestRoundRobinSelectorPick_MixedVirtualAndNonVirtualFallsBackToFlat (0.00s)
--- PASS: TestUpdateAggregatedAvailability_FutureNextRetryBlocksAuth (0.00s)
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/no_suffix_unchanged
--- PASS: TestFillFirstSelectorPick_ThinkingSuffixFallsBackToBaseModelState (0.00s)
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/kiro_alias_resolves
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/kiro_alias_resolves
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/config_suffix_takes_priority
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/config_suffix_takes_priority
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/auto_suffix_preserved
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/auto_suffix_preserved
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/none_suffix_preserved
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/none_suffix_preserved
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/github-copilot_suffix_preserved
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/github-copilot_suffix_preserved
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/github-copilot_no_suffix
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/github-copilot_no_suffix
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/kimi_suffix_preserved
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/kimi_suffix_preserved
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/case_insensitive_alias_lookup_with_suffix
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/case_insensitive_alias_lookup_with_suffix
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/no_alias_returns_empty
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/no_alias_returns_empty
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/wrong_channel_returns_empty
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/wrong_channel_returns_empty
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/empty_suffix_filtered_out
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/empty_suffix_filtered_out
=== RUN   TestResolveOAuthUpstreamModel_SuffixPreservation/incomplete_suffix_treated_as_no_suffix
=== PAUSE TestResolveOAuthUpstreamModel_SuffixPreservation/incomplete_suffix_treated_as_no_suffix
--- PASS: TestSelectorPick_AllCooldownReturnsModelCooldownError (0.00s)
    --- PASS: TestSelectorPick_AllCooldownReturnsModelCooldownError/mixed_provider_redacts_provider_field (0.00s)
    --- PASS: TestSelectorPick_AllCooldownReturnsModelCooldownError/non-mixed_provider_includes_provider_field (0.00s)
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/github-copilot_no_suffix
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/config_suffix_takes_priority
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/numeric_suffix_preserved
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/github-copilot_suffix_preserved
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/incomplete_suffix_treated_as_no_suffix
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/auto_suffix_preserved
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/none_suffix_preserved
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/kiro_alias_resolves
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/wrong_channel_returns_empty
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/no_alias_returns_empty
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/case_insensitive_alias_lookup_with_suffix
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/kimi_suffix_preserved
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/empty_suffix_filtered_out
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/level_suffix_preserved
=== CONT  TestResolveOAuthUpstreamModel_SuffixPreservation/no_suffix_unchanged
--- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/github-copilot_no_suffix (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/config_suffix_takes_priority (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/numeric_suffix_preserved (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/github-copilot_suffix_preserved (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/incomplete_suffix_treated_as_no_suffix (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/auto_suffix_preserved (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/none_suffix_preserved (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/kiro_alias_resolves (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/wrong_channel_returns_empty (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/no_alias_returns_empty (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/case_insensitive_alias_lookup_with_suffix (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/kimi_suffix_preserved (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/empty_suffix_filtered_out (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/level_suffix_preserved (0.00s)
    --- PASS: TestResolveOAuthUpstreamModel_SuffixPreservation/no_suffix_unchanged (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/sdk/cliproxy/auth	1.348s
?   	github.com/router-for-me/CLIProxyAPI/v6/sdk/cliproxy/executor	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/sdk/cliproxy/pipeline	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/sdk/cliproxy/usage	[no test files]
=== RUN   TestConfigWrappers
--- PASS: TestConfigWrappers (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/sdk/config	1.419s
?   	github.com/router-for-me/CLIProxyAPI/v6/sdk/logging	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/sdk/translator	[no test files]
?   	github.com/router-for-me/CLIProxyAPI/v6/sdk/translator/builtin	[no test files]
=== RUN   TestGetAmpCode
--- PASS: TestGetAmpCode (0.00s)
=== RUN   TestGetAmpUpstreamURL
--- PASS: TestGetAmpUpstreamURL (0.00s)
=== RUN   TestPutAmpUpstreamURL
--- PASS: TestPutAmpUpstreamURL (0.00s)
=== RUN   TestDeleteAmpUpstreamURL
--- PASS: TestDeleteAmpUpstreamURL (0.00s)
=== RUN   TestGetAmpUpstreamAPIKey
--- PASS: TestGetAmpUpstreamAPIKey (0.00s)
=== RUN   TestPutAmpUpstreamAPIKey
--- PASS: TestPutAmpUpstreamAPIKey (0.00s)
=== RUN   TestPutAmpUpstreamAPIKeys_PersistsAndReturns
--- PASS: TestPutAmpUpstreamAPIKeys_PersistsAndReturns (0.00s)
=== RUN   TestDeleteAmpUpstreamAPIKeys_ClearsAll
--- PASS: TestDeleteAmpUpstreamAPIKeys_ClearsAll (0.00s)
=== RUN   TestDeleteAmpUpstreamAPIKey
--- PASS: TestDeleteAmpUpstreamAPIKey (0.00s)
=== RUN   TestGetAmpRestrictManagementToLocalhost
--- PASS: TestGetAmpRestrictManagementToLocalhost (0.00s)
=== RUN   TestPutAmpRestrictManagementToLocalhost
--- PASS: TestPutAmpRestrictManagementToLocalhost (0.00s)
=== RUN   TestGetAmpModelMappings
--- PASS: TestGetAmpModelMappings (0.00s)
=== RUN   TestPutAmpModelMappings
--- PASS: TestPutAmpModelMappings (0.00s)
=== RUN   TestPatchAmpModelMappings
--- PASS: TestPatchAmpModelMappings (0.00s)
=== RUN   TestDeleteAmpModelMappings_Specific
--- PASS: TestDeleteAmpModelMappings_Specific (0.00s)
=== RUN   TestDeleteAmpModelMappings_All
--- PASS: TestDeleteAmpModelMappings_All (0.00s)
=== RUN   TestGetAmpForceModelMappings
--- PASS: TestGetAmpForceModelMappings (0.00s)
=== RUN   TestPutAmpForceModelMappings
--- PASS: TestPutAmpForceModelMappings (0.00s)
=== RUN   TestPutAmpModelMappings_VerifyState
--- PASS: TestPutAmpModelMappings_VerifyState (0.00s)
=== RUN   TestPatchAmpModelMappings_VerifyState
--- PASS: TestPatchAmpModelMappings_VerifyState (0.00s)
=== RUN   TestDeleteAmpModelMappings_VerifyState
--- PASS: TestDeleteAmpModelMappings_VerifyState (0.00s)
=== RUN   TestDeleteAmpModelMappings_NonExistent
--- PASS: TestDeleteAmpModelMappings_NonExistent (0.00s)
=== RUN   TestPutAmpModelMappings_Empty
--- PASS: TestPutAmpModelMappings_Empty (0.00s)
=== RUN   TestPutAmpUpstreamURL_VerifyState
--- PASS: TestPutAmpUpstreamURL_VerifyState (0.00s)
=== RUN   TestDeleteAmpUpstreamURL_VerifyState
--- PASS: TestDeleteAmpUpstreamURL_VerifyState (0.00s)
=== RUN   TestPutAmpUpstreamAPIKey_VerifyState
--- PASS: TestPutAmpUpstreamAPIKey_VerifyState (0.00s)
=== RUN   TestDeleteAmpUpstreamAPIKey_VerifyState
--- PASS: TestDeleteAmpUpstreamAPIKey_VerifyState (0.00s)
=== RUN   TestPutAmpRestrictManagementToLocalhost_VerifyState
--- PASS: TestPutAmpRestrictManagementToLocalhost_VerifyState (0.00s)
=== RUN   TestPutAmpForceModelMappings_VerifyState
--- PASS: TestPutAmpForceModelMappings_VerifyState (0.00s)
=== RUN   TestPutBoolField_EmptyObject
--- PASS: TestPutBoolField_EmptyObject (0.00s)
=== RUN   TestComplexMappingsWorkflow
--- PASS: TestComplexMappingsWorkflow (0.00s)
=== RUN   TestNilHandlerGetAmpCode
--- PASS: TestNilHandlerGetAmpCode (0.00s)
=== RUN   TestEmptyConfigGetAmpModelMappings
--- PASS: TestEmptyConfigGetAmpModelMappings (0.00s)
=== RUN   TestOpenAIToCodex_PreservesBuiltinTools
--- PASS: TestOpenAIToCodex_PreservesBuiltinTools (0.00s)
=== RUN   TestOpenAIResponsesToOpenAI_IgnoresBuiltinTools
--- PASS: TestOpenAIResponsesToOpenAI_IgnoresBuiltinTools (0.00s)
=== RUN   TestServerHealth
--- PASS: TestServerHealth (0.00s)
=== RUN   TestBinaryExists
    e2e_test.go:51: Binary not found in expected paths
--- SKIP: TestBinaryExists (0.00s)
=== RUN   TestConfigFile
--- PASS: TestConfigFile (0.00s)
=== RUN   TestOAuthLoginFlow
--- PASS: TestOAuthLoginFlow (0.00s)
=== RUN   TestKiloLoginBinary
    e2e_test.go:104: Binary not found
--- SKIP: TestKiloLoginBinary (0.00s)
=== RUN   TestResponsesToOpenAI_PassesBuiltinWebSearchTool
    openai_websearch_translation_test.go:17: web_search_preview pass-through not available in this fork
--- SKIP: TestResponsesToOpenAI_PassesBuiltinWebSearchTool (0.00s)
=== RUN   TestOpenAIToClaude_StreamAnnotationsAsCitations
    openai_websearch_translation_test.go:24: annotation-to-citation conversion not available in this fork
--- SKIP: TestOpenAIToClaude_StreamAnnotationsAsCitations (0.00s)
=== RUN   TestOpenAIToClaude_NonStreamAnnotationsAsCitations
    openai_websearch_translation_test.go:75: annotation-to-citation conversion not available in this fork
--- SKIP: TestOpenAIToClaude_NonStreamAnnotationsAsCitations (0.00s)
=== RUN   TestOpenAIToGemini_StreamAnnotationsAsGroundingMetadata
    openai_websearch_translation_test.go:121: annotation-to-groundingMetadata conversion not available in this fork
--- SKIP: TestOpenAIToGemini_StreamAnnotationsAsGroundingMetadata (0.00s)
=== RUN   TestOpenAIToGemini_NonStreamAnnotationsAsGroundingMetadata
    openai_websearch_translation_test.go:167: annotation-to-groundingMetadata conversion not available in this fork
--- SKIP: TestOpenAIToGemini_NonStreamAnnotationsAsGroundingMetadata (0.00s)
=== RUN   TestOpenAIToResponses_StreamAnnotationsPopulated
    openai_websearch_translation_test.go:206: annotation population in Responses format not available in this fork
--- SKIP: TestOpenAIToResponses_StreamAnnotationsPopulated (0.00s)
=== RUN   TestOpenAIToResponses_NonStreamAnnotationsPopulated
    openai_websearch_translation_test.go:270: annotation population in Responses format not available in this fork
--- SKIP: TestOpenAIToResponses_NonStreamAnnotationsPopulated (0.00s)
=== RUN   TestRooLoginFlag_WithFakeRoo
    roo_kilo_login_integration_test.go:10: -roo-login flag does not exist in current version
--- SKIP: TestRooLoginFlag_WithFakeRoo (0.00s)
=== RUN   TestKiloLoginFlag_WithFakeKilo
    roo_kilo_login_integration_test.go:14: Requires specific binary path setup
--- SKIP: TestKiloLoginFlag_WithFakeKilo (0.00s)
=== RUN   TestRooLoginFlag_WithoutRoo_ExitsNonZero
    roo_kilo_login_integration_test.go:18: -roo-login flag does not exist
--- SKIP: TestRooLoginFlag_WithoutRoo_ExitsNonZero (0.00s)
=== RUN   TestThinkingE2EMatrix_Suffix
=== RUN   TestThinkingE2EMatrix_Suffix/Case1_openai->codex_level-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case2_openai->codex_level-model(medium)
=== RUN   TestThinkingE2EMatrix_Suffix/Case3_openai->codex_level-model(xhigh)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="level \"xhigh\" not supported, valid levels: minimal, low, medium, high" model=level-model provider=codex
=== RUN   TestThinkingE2EMatrix_Suffix/Case4_openai->codex_level-model(none)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=level-model original_value=0 provider=codex
=== RUN   TestThinkingE2EMatrix_Suffix/Case5_openai->codex_level-model(auto)
=== RUN   TestThinkingE2EMatrix_Suffix/Case6_gemini->codex_level-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case7_gemini->codex_level-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case8_gemini->codex_level-model(64000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case9_gemini->codex_level-model(0)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=level-model original_value=0 provider=codex
=== RUN   TestThinkingE2EMatrix_Suffix/Case10_gemini->codex_level-model(-1)
=== RUN   TestThinkingE2EMatrix_Suffix/Case11_claude->openai_level-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case12_claude->openai_level-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case13_claude->openai_level-model(64000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case14_claude->openai_level-model(0)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=level-model original_value=0 provider=openai
=== RUN   TestThinkingE2EMatrix_Suffix/Case15_claude->openai_level-model(-1)
=== RUN   TestThinkingE2EMatrix_Suffix/Case16_gemini->openai_level-subset-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case17_claude->gemini_level-subset-model(1)
=== RUN   TestThinkingE2EMatrix_Suffix/Case18_openai->gemini_gemini-budget-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case19_openai->gemini_gemini-budget-model(medium)
=== RUN   TestThinkingE2EMatrix_Suffix/Case20_openai->gemini_gemini-budget-model(xhigh)
=== RUN   TestThinkingE2EMatrix_Suffix/Case21_openai->gemini_gemini-budget-model(none)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=128 max=20000 min=128 model=gemini-budget-model original_value=0 provider=gemini
=== RUN   TestThinkingE2EMatrix_Suffix/Case22_openai->gemini_gemini-budget-model(auto)
=== RUN   TestThinkingE2EMatrix_Suffix/Case23_claude->gemini_gemini-budget-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case24_claude->gemini_gemini-budget-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case25_claude->gemini_gemini-budget-model(64000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case26_claude->gemini_gemini-budget-model(0)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=128 max=20000 min=128 model=gemini-budget-model original_value=0 provider=gemini
=== RUN   TestThinkingE2EMatrix_Suffix/Case27_claude->gemini_gemini-budget-model(-1)
=== RUN   TestThinkingE2EMatrix_Suffix/Case28_openai->gemini_gemini-mixed-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case29_openai->gemini_gemini-mixed-model(high)
=== RUN   TestThinkingE2EMatrix_Suffix/Case30_openai->gemini_gemini-mixed-model(xhigh)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="level \"xhigh\" not supported, valid levels: low, high" model=gemini-mixed-model provider=gemini
=== RUN   TestThinkingE2EMatrix_Suffix/Case31_openai->gemini_gemini-mixed-model(none)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=128 max=32768 min=128 model=gemini-mixed-model original_value=0 provider=gemini
=== RUN   TestThinkingE2EMatrix_Suffix/Case32_openai->gemini_gemini-mixed-model(auto)
=== RUN   TestThinkingE2EMatrix_Suffix/Case33_claude->gemini_gemini-mixed-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case34_claude->gemini_gemini-mixed-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case35_claude->gemini_gemini-mixed-model(64000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case36_claude->gemini_gemini-mixed-model(0)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=128 max=32768 min=128 model=gemini-mixed-model original_value=0 provider=gemini
=== RUN   TestThinkingE2EMatrix_Suffix/Case37_claude->gemini_gemini-mixed-model(-1)
=== RUN   TestThinkingE2EMatrix_Suffix/Case38_openai->claude_claude-budget-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case39_openai->claude_claude-budget-model(medium)
=== RUN   TestThinkingE2EMatrix_Suffix/Case40_openai->claude_claude-budget-model(xhigh)
=== RUN   TestThinkingE2EMatrix_Suffix/Case41_openai->claude_claude-budget-model(none)
=== RUN   TestThinkingE2EMatrix_Suffix/Case42_openai->claude_claude-budget-model(auto)
=== RUN   TestThinkingE2EMatrix_Suffix/Case43_gemini->claude_claude-budget-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case44_gemini->claude_claude-budget-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case45_gemini->claude_claude-budget-model(200000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case46_gemini->claude_claude-budget-model(0)
=== RUN   TestThinkingE2EMatrix_Suffix/Case47_gemini->claude_claude-budget-model(-1)
=== RUN   TestThinkingE2EMatrix_Suffix/Case48_gemini->antigravity_antigravity-budget-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case49_gemini->antigravity_antigravity-budget-model(medium)
=== RUN   TestThinkingE2EMatrix_Suffix/Case50_gemini->antigravity_antigravity-budget-model(xhigh)
=== RUN   TestThinkingE2EMatrix_Suffix/Case51_gemini->antigravity_antigravity-budget-model(none)
=== RUN   TestThinkingE2EMatrix_Suffix/Case52_gemini->antigravity_antigravity-budget-model(auto)
=== RUN   TestThinkingE2EMatrix_Suffix/Case53_claude->antigravity_antigravity-budget-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case54_claude->antigravity_antigravity-budget-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case55_claude->antigravity_antigravity-budget-model(64000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case56_claude->antigravity_antigravity-budget-model(0)
=== RUN   TestThinkingE2EMatrix_Suffix/Case57_claude->antigravity_antigravity-budget-model(-1)
=== RUN   TestThinkingE2EMatrix_Suffix/Case58_gemini->openai_no-thinking-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case59_gemini->openai_no-thinking-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case60_gemini->openai_no-thinking-model(0)
=== RUN   TestThinkingE2EMatrix_Suffix/Case61_gemini->openai_no-thinking-model(-1)
=== RUN   TestThinkingE2EMatrix_Suffix/Case62_claude->openai_no-thinking-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case63_claude->openai_no-thinking-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case64_claude->openai_no-thinking-model(0)
=== RUN   TestThinkingE2EMatrix_Suffix/Case65_claude->openai_no-thinking-model(-1)
=== RUN   TestThinkingE2EMatrix_Suffix/Case66_gemini->openai_user-defined-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case67_gemini->openai_user-defined-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case68_gemini->openai_user-defined-model(64000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case69_gemini->openai_user-defined-model(0)
=== RUN   TestThinkingE2EMatrix_Suffix/Case70_gemini->openai_user-defined-model(-1)
=== RUN   TestThinkingE2EMatrix_Suffix/Case71_claude->codex_user-defined-model
=== RUN   TestThinkingE2EMatrix_Suffix/Case72_claude->codex_user-defined-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case73_claude->codex_user-defined-model(64000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case74_claude->codex_user-defined-model(0)
=== RUN   TestThinkingE2EMatrix_Suffix/Case75_claude->codex_user-defined-model(-1)
=== RUN   TestThinkingE2EMatrix_Suffix/Case76_openai->gemini_user-defined-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case77_openai->claude_user-defined-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case78_openai-response->gemini_user-defined-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case79_openai-response->claude_user-defined-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case80_openai->openai_level-model(high)
=== RUN   TestThinkingE2EMatrix_Suffix/Case81_openai->openai_level-model(xhigh)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="level \"xhigh\" not supported, valid levels: minimal, low, medium, high" model=level-model provider=openai
=== RUN   TestThinkingE2EMatrix_Suffix/Case82_openai-response->codex_level-model(high)
=== RUN   TestThinkingE2EMatrix_Suffix/Case83_openai-response->codex_level-model(xhigh)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="level \"xhigh\" not supported, valid levels: minimal, low, medium, high" model=level-model provider=codex
=== RUN   TestThinkingE2EMatrix_Suffix/Case84_gemini->gemini_gemini-budget-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case85_gemini->gemini_gemini-budget-model(64000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case86_claude->claude_claude-budget-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case87_claude->claude_claude-budget-model(200000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case88_gemini-cli->antigravity_antigravity-budget-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case89_gemini-cli->antigravity_antigravity-budget-model(64000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case90_openai->iflow_glm-test
=== RUN   TestThinkingE2EMatrix_Suffix/Case91_openai->iflow_glm-test(medium)
=== RUN   TestThinkingE2EMatrix_Suffix/Case92_openai->iflow_glm-test(auto)
=== RUN   TestThinkingE2EMatrix_Suffix/Case93_openai->iflow_glm-test(none)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=glm-test original_value=0 provider=iflow
=== RUN   TestThinkingE2EMatrix_Suffix/Case94_claude->iflow_glm-test
=== RUN   TestThinkingE2EMatrix_Suffix/Case95_claude->iflow_glm-test(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case96_claude->iflow_glm-test(-1)
=== RUN   TestThinkingE2EMatrix_Suffix/Case97_claude->iflow_glm-test(0)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=glm-test original_value=0 provider=iflow
=== RUN   TestThinkingE2EMatrix_Suffix/Case98_openai->iflow_minimax-test
=== RUN   TestThinkingE2EMatrix_Suffix/Case99_openai->iflow_minimax-test(medium)
=== RUN   TestThinkingE2EMatrix_Suffix/Case100_openai->iflow_minimax-test(auto)
=== RUN   TestThinkingE2EMatrix_Suffix/Case101_openai->iflow_minimax-test(none)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=minimax-test original_value=0 provider=iflow
=== RUN   TestThinkingE2EMatrix_Suffix/Case102_gemini->iflow_minimax-test
=== RUN   TestThinkingE2EMatrix_Suffix/Case103_gemini->iflow_minimax-test(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case104_gemini->iflow_minimax-test(-1)
=== RUN   TestThinkingE2EMatrix_Suffix/Case105_gemini->iflow_minimax-test(0)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=minimax-test original_value=0 provider=iflow
=== RUN   TestThinkingE2EMatrix_Suffix/Case106_gemini->antigravity_gemini-budget-model(64000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case107_gemini->gemini-cli_gemini-budget-model(64000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case108_gemini-cli->antigravity_gemini-budget-model(64000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case109_gemini-cli->gemini_gemini-budget-model(64000)
=== RUN   TestThinkingE2EMatrix_Suffix/Case110_gemini->antigravity_gemini-budget-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case111_gemini-cli->antigravity_gemini-budget-model(8192)
=== RUN   TestThinkingE2EMatrix_Suffix/Case112_openai->github-copilot_gpt-5(high)
=== RUN   TestThinkingE2EMatrix_Suffix/Case113_openai->github-copilot_gpt-5(none)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=gpt-5 original_value=0 provider=openai
=== RUN   TestThinkingE2EMatrix_Suffix/Case114_openai->github-copilot_gpt-5.1(none)
=== RUN   TestThinkingE2EMatrix_Suffix/Case115_openai->github-copilot_gpt-5.2(xhigh)
=== RUN   TestThinkingE2EMatrix_Suffix/Case116_openai->github-copilot_gpt-5(xhigh)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="level \"xhigh\" not supported, valid levels: low, medium, high" model=gpt-5 provider=openai
=== RUN   TestThinkingE2EMatrix_Suffix/Case117_claude->github-copilot_gpt-5.1(0)
=== RUN   TestThinkingE2EMatrix_Suffix/Case118_openai-response->github-copilot_gpt-5-codex(high)
=== RUN   TestThinkingE2EMatrix_Suffix/Case119_openai-response->github-copilot_gpt-5.2-codex(xhigh)
=== RUN   TestThinkingE2EMatrix_Suffix/Case120_openai-response->github-copilot_gpt-5.2-codex(none)
=== RUN   TestThinkingE2EMatrix_Suffix/Case121_openai-response->github-copilot_gpt-5-codex(none)
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=gpt-5-codex original_value=0 provider=codex
--- PASS: TestThinkingE2EMatrix_Suffix (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case1_openai->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case2_openai->codex_level-model(medium) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case3_openai->codex_level-model(xhigh) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case4_openai->codex_level-model(none) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case5_openai->codex_level-model(auto) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case6_gemini->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case7_gemini->codex_level-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case8_gemini->codex_level-model(64000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case9_gemini->codex_level-model(0) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case10_gemini->codex_level-model(-1) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case11_claude->openai_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case12_claude->openai_level-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case13_claude->openai_level-model(64000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case14_claude->openai_level-model(0) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case15_claude->openai_level-model(-1) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case16_gemini->openai_level-subset-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case17_claude->gemini_level-subset-model(1) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case18_openai->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case19_openai->gemini_gemini-budget-model(medium) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case20_openai->gemini_gemini-budget-model(xhigh) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case21_openai->gemini_gemini-budget-model(none) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case22_openai->gemini_gemini-budget-model(auto) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case23_claude->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case24_claude->gemini_gemini-budget-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case25_claude->gemini_gemini-budget-model(64000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case26_claude->gemini_gemini-budget-model(0) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case27_claude->gemini_gemini-budget-model(-1) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case28_openai->gemini_gemini-mixed-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case29_openai->gemini_gemini-mixed-model(high) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case30_openai->gemini_gemini-mixed-model(xhigh) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case31_openai->gemini_gemini-mixed-model(none) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case32_openai->gemini_gemini-mixed-model(auto) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case33_claude->gemini_gemini-mixed-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case34_claude->gemini_gemini-mixed-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case35_claude->gemini_gemini-mixed-model(64000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case36_claude->gemini_gemini-mixed-model(0) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case37_claude->gemini_gemini-mixed-model(-1) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case38_openai->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case39_openai->claude_claude-budget-model(medium) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case40_openai->claude_claude-budget-model(xhigh) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case41_openai->claude_claude-budget-model(none) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case42_openai->claude_claude-budget-model(auto) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case43_gemini->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case44_gemini->claude_claude-budget-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case45_gemini->claude_claude-budget-model(200000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case46_gemini->claude_claude-budget-model(0) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case47_gemini->claude_claude-budget-model(-1) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case48_gemini->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case49_gemini->antigravity_antigravity-budget-model(medium) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case50_gemini->antigravity_antigravity-budget-model(xhigh) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case51_gemini->antigravity_antigravity-budget-model(none) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case52_gemini->antigravity_antigravity-budget-model(auto) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case53_claude->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case54_claude->antigravity_antigravity-budget-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case55_claude->antigravity_antigravity-budget-model(64000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case56_claude->antigravity_antigravity-budget-model(0) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case57_claude->antigravity_antigravity-budget-model(-1) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case58_gemini->openai_no-thinking-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case59_gemini->openai_no-thinking-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case60_gemini->openai_no-thinking-model(0) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case61_gemini->openai_no-thinking-model(-1) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case62_claude->openai_no-thinking-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case63_claude->openai_no-thinking-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case64_claude->openai_no-thinking-model(0) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case65_claude->openai_no-thinking-model(-1) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case66_gemini->openai_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case67_gemini->openai_user-defined-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case68_gemini->openai_user-defined-model(64000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case69_gemini->openai_user-defined-model(0) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case70_gemini->openai_user-defined-model(-1) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case71_claude->codex_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case72_claude->codex_user-defined-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case73_claude->codex_user-defined-model(64000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case74_claude->codex_user-defined-model(0) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case75_claude->codex_user-defined-model(-1) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case76_openai->gemini_user-defined-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case77_openai->claude_user-defined-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case78_openai-response->gemini_user-defined-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case79_openai-response->claude_user-defined-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case80_openai->openai_level-model(high) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case81_openai->openai_level-model(xhigh) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case82_openai-response->codex_level-model(high) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case83_openai-response->codex_level-model(xhigh) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case84_gemini->gemini_gemini-budget-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case85_gemini->gemini_gemini-budget-model(64000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case86_claude->claude_claude-budget-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case87_claude->claude_claude-budget-model(200000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case88_gemini-cli->antigravity_antigravity-budget-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case89_gemini-cli->antigravity_antigravity-budget-model(64000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case90_openai->iflow_glm-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case91_openai->iflow_glm-test(medium) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case92_openai->iflow_glm-test(auto) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case93_openai->iflow_glm-test(none) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case94_claude->iflow_glm-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case95_claude->iflow_glm-test(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case96_claude->iflow_glm-test(-1) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case97_claude->iflow_glm-test(0) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case98_openai->iflow_minimax-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case99_openai->iflow_minimax-test(medium) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case100_openai->iflow_minimax-test(auto) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case101_openai->iflow_minimax-test(none) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case102_gemini->iflow_minimax-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case103_gemini->iflow_minimax-test(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case104_gemini->iflow_minimax-test(-1) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case105_gemini->iflow_minimax-test(0) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case106_gemini->antigravity_gemini-budget-model(64000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case107_gemini->gemini-cli_gemini-budget-model(64000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case108_gemini-cli->antigravity_gemini-budget-model(64000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case109_gemini-cli->gemini_gemini-budget-model(64000) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case110_gemini->antigravity_gemini-budget-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case111_gemini-cli->antigravity_gemini-budget-model(8192) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case112_openai->github-copilot_gpt-5(high) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case113_openai->github-copilot_gpt-5(none) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case114_openai->github-copilot_gpt-5.1(none) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case115_openai->github-copilot_gpt-5.2(xhigh) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case116_openai->github-copilot_gpt-5(xhigh) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case117_claude->github-copilot_gpt-5.1(0) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case118_openai-response->github-copilot_gpt-5-codex(high) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case119_openai-response->github-copilot_gpt-5.2-codex(xhigh) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case120_openai-response->github-copilot_gpt-5.2-codex(none) (0.00s)
    --- PASS: TestThinkingE2EMatrix_Suffix/Case121_openai-response->github-copilot_gpt-5-codex(none) (0.00s)
=== RUN   TestThinkingE2EMatrix_Body
=== RUN   TestThinkingE2EMatrix_Body/Case1_openai->codex_level-model
=== RUN   TestThinkingE2EMatrix_Body/Case2_openai->codex_level-model
=== RUN   TestThinkingE2EMatrix_Body/Case3_openai->codex_level-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="level \"xhigh\" not supported, valid levels: minimal, low, medium, high" model=level-model provider=codex
=== RUN   TestThinkingE2EMatrix_Body/Case4_openai->codex_level-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=level-model original_value=0 provider=codex
=== RUN   TestThinkingE2EMatrix_Body/Case5_openai->codex_level-model
=== RUN   TestThinkingE2EMatrix_Body/Case6_gemini->codex_level-model
=== RUN   TestThinkingE2EMatrix_Body/Case7_gemini->codex_level-model
=== RUN   TestThinkingE2EMatrix_Body/Case8_gemini->codex_level-model
=== RUN   TestThinkingE2EMatrix_Body/Case9_gemini->codex_level-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=level-model original_value=0 provider=codex
=== RUN   TestThinkingE2EMatrix_Body/Case10_gemini->codex_level-model
=== RUN   TestThinkingE2EMatrix_Body/Case11_claude->openai_level-model
=== RUN   TestThinkingE2EMatrix_Body/Case12_claude->openai_level-model
=== RUN   TestThinkingE2EMatrix_Body/Case13_claude->openai_level-model
=== RUN   TestThinkingE2EMatrix_Body/Case14_claude->openai_level-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=level-model original_value=0 provider=openai
=== RUN   TestThinkingE2EMatrix_Body/Case15_claude->openai_level-model
=== RUN   TestThinkingE2EMatrix_Body/Case16_gemini->openai_level-subset-model
=== RUN   TestThinkingE2EMatrix_Body/Case17_claude->gemini_level-subset-model
=== RUN   TestThinkingE2EMatrix_Body/Case18_openai->gemini_gemini-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case19_openai->gemini_gemini-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case20_openai->gemini_gemini-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case21_openai->gemini_gemini-budget-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=128 max=20000 min=128 model=gemini-budget-model original_value=0 provider=gemini
=== RUN   TestThinkingE2EMatrix_Body/Case22_openai->gemini_gemini-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case23_claude->gemini_gemini-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case24_claude->gemini_gemini-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case25_claude->gemini_gemini-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case26_claude->gemini_gemini-budget-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=128 max=20000 min=128 model=gemini-budget-model original_value=0 provider=gemini
=== RUN   TestThinkingE2EMatrix_Body/Case27_claude->gemini_gemini-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case28_openai->gemini_gemini-mixed-model
=== RUN   TestThinkingE2EMatrix_Body/Case29_openai->gemini_gemini-mixed-model
=== RUN   TestThinkingE2EMatrix_Body/Case30_openai->gemini_gemini-mixed-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="level \"xhigh\" not supported, valid levels: low, high" model=gemini-mixed-model provider=gemini
=== RUN   TestThinkingE2EMatrix_Body/Case31_openai->gemini_gemini-mixed-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=128 max=32768 min=128 model=gemini-mixed-model original_value=0 provider=gemini
=== RUN   TestThinkingE2EMatrix_Body/Case32_openai->gemini_gemini-mixed-model
=== RUN   TestThinkingE2EMatrix_Body/Case33_claude->gemini_gemini-mixed-model
=== RUN   TestThinkingE2EMatrix_Body/Case34_claude->gemini_gemini-mixed-model
=== RUN   TestThinkingE2EMatrix_Body/Case35_claude->gemini_gemini-mixed-model
=== RUN   TestThinkingE2EMatrix_Body/Case36_claude->gemini_gemini-mixed-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=128 max=32768 min=128 model=gemini-mixed-model original_value=0 provider=gemini
=== RUN   TestThinkingE2EMatrix_Body/Case37_claude->gemini_gemini-mixed-model
=== RUN   TestThinkingE2EMatrix_Body/Case38_openai->claude_claude-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case39_openai->claude_claude-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case40_openai->claude_claude-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case41_openai->claude_claude-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case42_openai->claude_claude-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case43_gemini->claude_claude-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case44_gemini->claude_claude-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case45_gemini->claude_claude-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case46_gemini->claude_claude-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case47_gemini->claude_claude-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case48_gemini->antigravity_antigravity-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case49_gemini->antigravity_antigravity-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case50_gemini->antigravity_antigravity-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case51_gemini->antigravity_antigravity-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case52_gemini->antigravity_antigravity-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case53_claude->antigravity_antigravity-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case54_claude->antigravity_antigravity-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case55_claude->antigravity_antigravity-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case56_claude->antigravity_antigravity-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case57_claude->antigravity_antigravity-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case58_gemini->openai_no-thinking-model
=== RUN   TestThinkingE2EMatrix_Body/Case59_gemini->openai_no-thinking-model
=== RUN   TestThinkingE2EMatrix_Body/Case60_gemini->openai_no-thinking-model
=== RUN   TestThinkingE2EMatrix_Body/Case61_gemini->openai_no-thinking-model
=== RUN   TestThinkingE2EMatrix_Body/Case62_claude->openai_no-thinking-model
=== RUN   TestThinkingE2EMatrix_Body/Case63_claude->openai_no-thinking-model
=== RUN   TestThinkingE2EMatrix_Body/Case64_claude->openai_no-thinking-model
=== RUN   TestThinkingE2EMatrix_Body/Case65_claude->openai_no-thinking-model
=== RUN   TestThinkingE2EMatrix_Body/Case66_gemini->openai_user-defined-model
=== RUN   TestThinkingE2EMatrix_Body/Case67_gemini->openai_user-defined-model
=== RUN   TestThinkingE2EMatrix_Body/Case68_gemini->openai_user-defined-model
=== RUN   TestThinkingE2EMatrix_Body/Case69_gemini->openai_user-defined-model
=== RUN   TestThinkingE2EMatrix_Body/Case70_gemini->openai_user-defined-model
=== RUN   TestThinkingE2EMatrix_Body/Case71_claude->codex_user-defined-model
=== RUN   TestThinkingE2EMatrix_Body/Case72_claude->codex_user-defined-model
=== RUN   TestThinkingE2EMatrix_Body/Case73_claude->codex_user-defined-model
=== RUN   TestThinkingE2EMatrix_Body/Case74_claude->codex_user-defined-model
=== RUN   TestThinkingE2EMatrix_Body/Case75_claude->codex_user-defined-model
=== RUN   TestThinkingE2EMatrix_Body/Case76_openai->gemini_user-defined-model
=== RUN   TestThinkingE2EMatrix_Body/Case77_openai->claude_user-defined-model
=== RUN   TestThinkingE2EMatrix_Body/Case78_openai-response->gemini_user-defined-model
=== RUN   TestThinkingE2EMatrix_Body/Case79_openai-response->claude_user-defined-model
=== RUN   TestThinkingE2EMatrix_Body/Case80_openai->openai_level-model
=== RUN   TestThinkingE2EMatrix_Body/Case81_openai->openai_level-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="level \"xhigh\" not supported, valid levels: minimal, low, medium, high" model=level-model provider=openai
=== RUN   TestThinkingE2EMatrix_Body/Case82_openai-response->codex_level-model
=== RUN   TestThinkingE2EMatrix_Body/Case83_openai-response->codex_level-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="level \"xhigh\" not supported, valid levels: minimal, low, medium, high" model=level-model provider=codex
=== RUN   TestThinkingE2EMatrix_Body/Case84_gemini->gemini_gemini-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case85_gemini->gemini_gemini-budget-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="budget 64000 out of range [128,20000]" model=gemini-budget-model provider=gemini
=== RUN   TestThinkingE2EMatrix_Body/Case86_claude->claude_claude-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case87_claude->claude_claude-budget-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="budget 200000 out of range [1024,128000]" model=claude-budget-model provider=claude
=== RUN   TestThinkingE2EMatrix_Body/Case88_gemini-cli->antigravity_antigravity-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case89_gemini-cli->antigravity_antigravity-budget-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="budget 64000 out of range [128,20000]" model=antigravity-budget-model provider=antigravity
=== RUN   TestThinkingE2EMatrix_Body/Case90_openai->iflow_glm-test
=== RUN   TestThinkingE2EMatrix_Body/Case91_openai->iflow_glm-test
=== RUN   TestThinkingE2EMatrix_Body/Case92_openai->iflow_glm-test
=== RUN   TestThinkingE2EMatrix_Body/Case93_openai->iflow_glm-test
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=glm-test original_value=0 provider=iflow
=== RUN   TestThinkingE2EMatrix_Body/Case94_claude->iflow_glm-test
=== RUN   TestThinkingE2EMatrix_Body/Case95_claude->iflow_glm-test
=== RUN   TestThinkingE2EMatrix_Body/Case96_claude->iflow_glm-test
=== RUN   TestThinkingE2EMatrix_Body/Case97_claude->iflow_glm-test
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=glm-test original_value=0 provider=iflow
=== RUN   TestThinkingE2EMatrix_Body/Case98_openai->iflow_minimax-test
=== RUN   TestThinkingE2EMatrix_Body/Case99_openai->iflow_minimax-test
=== RUN   TestThinkingE2EMatrix_Body/Case100_openai->iflow_minimax-test
=== RUN   TestThinkingE2EMatrix_Body/Case101_openai->iflow_minimax-test
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=minimax-test original_value=0 provider=iflow
=== RUN   TestThinkingE2EMatrix_Body/Case102_gemini->iflow_minimax-test
=== RUN   TestThinkingE2EMatrix_Body/Case103_gemini->iflow_minimax-test
=== RUN   TestThinkingE2EMatrix_Body/Case104_gemini->iflow_minimax-test
=== RUN   TestThinkingE2EMatrix_Body/Case105_gemini->iflow_minimax-test
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=minimax-test original_value=0 provider=iflow
=== RUN   TestThinkingE2EMatrix_Body/Case106_gemini->antigravity_gemini-budget-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="budget 64000 out of range [128,20000]" model=gemini-budget-model provider=antigravity
=== RUN   TestThinkingE2EMatrix_Body/Case107_gemini->gemini-cli_gemini-budget-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="budget 64000 out of range [128,20000]" model=gemini-budget-model provider=gemini-cli
=== RUN   TestThinkingE2EMatrix_Body/Case108_gemini-cli->antigravity_gemini-budget-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="budget 64000 out of range [128,20000]" model=gemini-budget-model provider=antigravity
=== RUN   TestThinkingE2EMatrix_Body/Case109_gemini-cli->gemini_gemini-budget-model
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="budget 64000 out of range [128,20000]" model=gemini-budget-model provider=gemini
=== RUN   TestThinkingE2EMatrix_Body/Case110_gemini->antigravity_gemini-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case111_gemini-cli->antigravity_gemini-budget-model
=== RUN   TestThinkingE2EMatrix_Body/Case112_openai->github-copilot_gpt-5
=== RUN   TestThinkingE2EMatrix_Body/Case113_openai->github-copilot_gpt-5
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=gpt-5 original_value=0 provider=openai
=== RUN   TestThinkingE2EMatrix_Body/Case114_openai->github-copilot_gpt-5.1
=== RUN   TestThinkingE2EMatrix_Body/Case115_openai->github-copilot_gpt-5.2
=== RUN   TestThinkingE2EMatrix_Body/Case116_openai->github-copilot_gpt-5
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: validation failed |" error="level \"xhigh\" not supported, valid levels: low, medium, high" model=gpt-5 provider=openai
=== RUN   TestThinkingE2EMatrix_Body/Case117_claude->github-copilot_gpt-5.1
=== RUN   TestThinkingE2EMatrix_Body/Case118_openai-response->github-copilot_gpt-5-codex
=== RUN   TestThinkingE2EMatrix_Body/Case119_openai-response->github-copilot_gpt-5.2-codex
=== RUN   TestThinkingE2EMatrix_Body/Case120_openai-response->github-copilot_gpt-5.2-codex
=== RUN   TestThinkingE2EMatrix_Body/Case121_openai-response->github-copilot_gpt-5-codex
time="2026-02-28T16:19:00+03:00" level=warning msg="thinking: budget zero not allowed |" clamped_to=0 max=0 min=0 model=gpt-5-codex original_value=0 provider=codex
--- PASS: TestThinkingE2EMatrix_Body (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case1_openai->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case2_openai->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case3_openai->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case4_openai->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case5_openai->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case6_gemini->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case7_gemini->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case8_gemini->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case9_gemini->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case10_gemini->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case11_claude->openai_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case12_claude->openai_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case13_claude->openai_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case14_claude->openai_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case15_claude->openai_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case16_gemini->openai_level-subset-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case17_claude->gemini_level-subset-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case18_openai->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case19_openai->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case20_openai->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case21_openai->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case22_openai->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case23_claude->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case24_claude->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case25_claude->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case26_claude->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case27_claude->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case28_openai->gemini_gemini-mixed-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case29_openai->gemini_gemini-mixed-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case30_openai->gemini_gemini-mixed-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case31_openai->gemini_gemini-mixed-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case32_openai->gemini_gemini-mixed-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case33_claude->gemini_gemini-mixed-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case34_claude->gemini_gemini-mixed-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case35_claude->gemini_gemini-mixed-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case36_claude->gemini_gemini-mixed-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case37_claude->gemini_gemini-mixed-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case38_openai->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case39_openai->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case40_openai->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case41_openai->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case42_openai->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case43_gemini->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case44_gemini->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case45_gemini->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case46_gemini->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case47_gemini->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case48_gemini->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case49_gemini->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case50_gemini->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case51_gemini->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case52_gemini->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case53_claude->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case54_claude->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case55_claude->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case56_claude->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case57_claude->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case58_gemini->openai_no-thinking-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case59_gemini->openai_no-thinking-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case60_gemini->openai_no-thinking-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case61_gemini->openai_no-thinking-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case62_claude->openai_no-thinking-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case63_claude->openai_no-thinking-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case64_claude->openai_no-thinking-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case65_claude->openai_no-thinking-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case66_gemini->openai_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case67_gemini->openai_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case68_gemini->openai_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case69_gemini->openai_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case70_gemini->openai_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case71_claude->codex_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case72_claude->codex_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case73_claude->codex_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case74_claude->codex_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case75_claude->codex_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case76_openai->gemini_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case77_openai->claude_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case78_openai-response->gemini_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case79_openai-response->claude_user-defined-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case80_openai->openai_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case81_openai->openai_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case82_openai-response->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case83_openai-response->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case84_gemini->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case85_gemini->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case86_claude->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case87_claude->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case88_gemini-cli->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case89_gemini-cli->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case90_openai->iflow_glm-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case91_openai->iflow_glm-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case92_openai->iflow_glm-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case93_openai->iflow_glm-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case94_claude->iflow_glm-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case95_claude->iflow_glm-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case96_claude->iflow_glm-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case97_claude->iflow_glm-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case98_openai->iflow_minimax-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case99_openai->iflow_minimax-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case100_openai->iflow_minimax-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case101_openai->iflow_minimax-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case102_gemini->iflow_minimax-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case103_gemini->iflow_minimax-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case104_gemini->iflow_minimax-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case105_gemini->iflow_minimax-test (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case106_gemini->antigravity_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case107_gemini->gemini-cli_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case108_gemini-cli->antigravity_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case109_gemini-cli->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case110_gemini->antigravity_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case111_gemini-cli->antigravity_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case112_openai->github-copilot_gpt-5 (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case113_openai->github-copilot_gpt-5 (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case114_openai->github-copilot_gpt-5.1 (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case115_openai->github-copilot_gpt-5.2 (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case116_openai->github-copilot_gpt-5 (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case117_claude->github-copilot_gpt-5.1 (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case118_openai-response->github-copilot_gpt-5-codex (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case119_openai-response->github-copilot_gpt-5.2-codex (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case120_openai-response->github-copilot_gpt-5.2-codex (0.00s)
    --- PASS: TestThinkingE2EMatrix_Body/Case121_openai-response->github-copilot_gpt-5-codex (0.00s)
=== RUN   TestThinkingE2EClaudeAdaptive_Body
=== RUN   TestThinkingE2EClaudeAdaptive_Body/CaseA1_claude->openai_level-model
=== RUN   TestThinkingE2EClaudeAdaptive_Body/CaseA2_claude->gemini_level-subset-model
=== RUN   TestThinkingE2EClaudeAdaptive_Body/CaseA3_claude->gemini_gemini-budget-model
=== RUN   TestThinkingE2EClaudeAdaptive_Body/CaseA4_claude->gemini_gemini-mixed-model
=== RUN   TestThinkingE2EClaudeAdaptive_Body/CaseA5_claude->claude_claude-budget-model
=== RUN   TestThinkingE2EClaudeAdaptive_Body/CaseA6_claude->antigravity_antigravity-budget-model
=== RUN   TestThinkingE2EClaudeAdaptive_Body/CaseA7_claude->iflow_glm-test
=== RUN   TestThinkingE2EClaudeAdaptive_Body/CaseA8_claude->iflow_minimax-test
=== RUN   TestThinkingE2EClaudeAdaptive_Body/CaseA9_claude->codex_level-model
=== RUN   TestThinkingE2EClaudeAdaptive_Body/CaseA10_claude->openai_no-thinking-model
--- PASS: TestThinkingE2EClaudeAdaptive_Body (0.00s)
    --- PASS: TestThinkingE2EClaudeAdaptive_Body/CaseA1_claude->openai_level-model (0.00s)
    --- PASS: TestThinkingE2EClaudeAdaptive_Body/CaseA2_claude->gemini_level-subset-model (0.00s)
    --- PASS: TestThinkingE2EClaudeAdaptive_Body/CaseA3_claude->gemini_gemini-budget-model (0.00s)
    --- PASS: TestThinkingE2EClaudeAdaptive_Body/CaseA4_claude->gemini_gemini-mixed-model (0.00s)
    --- PASS: TestThinkingE2EClaudeAdaptive_Body/CaseA5_claude->claude_claude-budget-model (0.00s)
    --- PASS: TestThinkingE2EClaudeAdaptive_Body/CaseA6_claude->antigravity_antigravity-budget-model (0.00s)
    --- PASS: TestThinkingE2EClaudeAdaptive_Body/CaseA7_claude->iflow_glm-test (0.00s)
    --- PASS: TestThinkingE2EClaudeAdaptive_Body/CaseA8_claude->iflow_minimax-test (0.00s)
    --- PASS: TestThinkingE2EClaudeAdaptive_Body/CaseA9_claude->codex_level-model (0.00s)
    --- PASS: TestThinkingE2EClaudeAdaptive_Body/CaseA10_claude->openai_no-thinking-model (0.00s)
PASS
ok  	github.com/router-for-me/CLIProxyAPI/v6/test	1.363s
